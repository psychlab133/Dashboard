/// Copyright Erik Weitnauer 2015.
gmath.ui.version="0.3.1";gmath.ui.gm_version="0.9.1";gmath.ui=gmath.ui||{};gmath.ui.Path=function(){var e=function(e,t){this.container=d3.select(e);this.element=null;t=t||{};this.id=t.id||gmath.uid();this.oid=t.oid;this.points=t.points||[];this.color=t.color||"black";this.width=t.width||1;this.type=t.type;this.init()};e.prototype.toJSON=function(){return{id:this.id,type:"Path",points:this.points,color:this.color,width:this.width}};e.line=typeof d3==="undefined"||typeof d3.svg==="undefined"?null:d3.svg.line();e.prototype.init=function(){var e=null;if(this.oid)e="#"+this.oid;this.element=this.container.insert("path",e).attr("id",this.id).style("fill","none").style("stroke-linecap","round").style("stroke-linejoin","round");return this.update()};e.prototype.update=function(){this.element.attr("d",e.line(this.points)+(this.points.length===1?"Z":"")).style("stroke",this.color).style("stroke-width",this.width);return this};e.prototype.remove=function(){this.element.remove();return this};e.prototype.setContainer=function(e){if(arguments.length===0)return this.container;this.container=e;return this};e.prototype.renderOnto=function(e){var t=this.element,n=this.container;this.container=e;this.element=e.select("#"+this.id);if(this.element.empty())this.init();else this.update();this.container=n;this.element=t};return e}();gm_erase_paths=function(){function e(e,t,n){n=n||20;var i=[];var o=function(e){var o=t[0][0];var a=t[0][1];var s=0;var l=0;if(e.length===1){if(!r(e[0][0],e[0][1],o,a,n)){i.push(e);return}}var p;while(s<e.length-1){var h=e[s];var c=e[s+1];var f=r(h[0],h[1],o,a,n);var m=r(c[0],c[1],o,a,n);if(f&&m){s++;l=s}else if(f&&!m){var g=u(h[0],h[1],c[0],c[1],o,a,n);if(g){e[s]=g;l=s}else{s++}}else if(!f&&m){var g=u(c[0],c[1],h[0],h[1],o,a,n);if(g){p=e.slice(l,s+1);p.push(g);i.push(p)}s++;l=s}else{var y=d(h[0],h[1],c[0],c[1],o,a,n);if(y){p=e.slice(l,s+1);if(p[p.length-1][0]!==y[0][0]||p[p.length-1][1]!==y[0][1]){p.push(y[0])}if(p.length>1)i.push(p);e[s]=y[1];if(e[s+1]&&e[s+1][0]==y[1][0]&&e[s+1][1]==y[1][1])s++;l=s}else{s++}}}if(l!==s){p=e.slice(l,e.length);if(p){i.push(p)}}};var s=function(e,o){if(e.path){n=n+e.width/2;var e=e.path}var a=t[o];var s=t[o+1];var o=0;var r=0;if(e.length===1){var l=p(e[0][0],e[0][1],a[0],a[1],s[0],s[1],n);if(l.indexOf(1)===-1){i.push(e);return}}var h;while(o<e.length-1){var u=e[o];var d=e[o+1];var l=p(u[0],u[1],a[0],a[1],s[0],s[1],n);var c=p(d[0],d[1],a[0],a[1],s[0],s[1],n);if(l.indexOf(1)!==-1&&c.indexOf(1)!==-1){o++;r=o}else if(l.indexOf(1)!==-1&&c.indexOf(1)===-1){var g=f(u[0],u[1],l,d[0],d[1],a[0],a[1],s[0],s[1],n);if(g){e[o]=g;r=o}else{o++}}else if(l.indexOf(1)===-1&&c.indexOf(1)!==-1){var g=f(d[0],d[1],c,u[0],u[1],a[0],a[1],s[0],s[1],n);if(g){h=e.slice(r,o+1);h.push(g);i.push(h);o++;r=o}else{o++}}else{var y=m(u[0],u[1],d[0],d[1],a[0],a[1],s[0],s[1],n);if(y){h=e.slice(r,o+1);if(h[h.length-1][0]!==y[0][0]||h[h.length-1][1]!==y[0][1]){h.push(y[0])}if(h.length>1)i.push(h);e[o]=y[1];if(e[o+1]&&e[o+1][0]==y[1][0]&&e[o+1][1]==y[1][1])o++;r=o}else{o++}}}if(r!==o){h=e.slice(r,e.length);if(h){i.push(h)}}};t=a({path:t});if(t.length===1){for(var l=0;l<e.length;l++){o(e[l])}e=i}else{for(var h=0;h<t.length-1;h++){for(var l=0;l<e.length;l++){s(e[l],h)}e=i;i=[]}}for(var c=0;c<e.length;c++){for(var g=0;g<e[c].length;g++){e[c][g][0]=Math.round(e[c][g][0]);e[c][g][1]=Math.round(e[c][g][1])}}return e}function t(e){if(e.path){var e=e.path}document.write("[");for(var t=0;t<e.length-1;t++){document.write("["+e[t][0]+","+e[t][1]+"],")}document.write("["+e[t][0]+","+e[t][1]+"]");document.write("]")}function n(e){document.write("[");for(var n=0;n<e.length-1;n++){t(e[n]);document.write(",<br />")}t(e[n]);document.write("]")}function i(e,t){if(e.path){var e=e.path}var n="";n+="[";for(var i=0;i<e.length-1;i++){n+="["+e[i][0]+","+e[i][1]+"],"}n+="["+e[i][0]+","+e[i][1]+"]";n+="]";if(t){console.log(n)}else{return n}}function o(e){log="";log+="[";for(var t=0;t<e.length-1;t++){log+=i(e[t],0);log+=","}log+=i(e[t],0);log+="]";console.log(log)}function a(e){if(e.path){var e=e.path}var t=[];if(e.length===1){t=e}else{pClean=0;while(pClean<e.length-1){if(e[pClean][0]!==e[pClean+1][0]||e[pClean][1]!==e[pClean+1][1]){t.push(e[pClean])}pClean++}if(e.length!==0&&t.length===0){t.push(e[0])}if(e[e.length-1][0]!==e[t.length-1][0]||e[e.length-1][1]!==e[t.length-1][1]){t.push(e[pClean])}}return t}function s(e,t,n,i){return Math.sqrt(Math.pow(n-e,2)+Math.pow(i-t,2))}function r(e,t,n,i,o){var a=s(e,t,n,i);if(a<o)return 1;else return 0}function l(e,t,n,i,o,a,s){var r=[o-n,a-i];var l=[e-n,t-i];var p=[-r[1],r[0]];var h=Math.sqrt(Math.pow(p[0],2)+Math.pow(p[1],2));var u=[p[0]/h,p[1]/h];var d=Math.sqrt(Math.pow(r[0],2)+Math.pow(r[1],2));var c=[r[0]/d,r[1]/d];var f=l[0]*c[0]+l[1]*c[1];if(f<=0||f>=d)return 0;var m=l[0]*u[0]+l[1]*u[1];if(m>=s||m<=-s)return 0;return 1}function p(e,t,n,i,o,a,s){var p=[];p.push(r(e,t,n,i,s));p.push(r(e,t,o,a,s));p.push(l(e,t,n,i,o,a,s));return p}function h(e,t,n,i,o){var a=[n-e,i-t];var s=[-a[1],a[0]];var r=Math.sqrt(Math.pow(s[0],2)+Math.pow(s[1],2));var l=[s[0]/r,s[1]/r];var p=[e+o*l[0],t+o*l[1]];var h=[e-o*l[0],t-o*l[1]];var u=[n-o*l[0],i-o*l[1]];var d=[n+o*l[0],i+o*l[1]];return[p,h,u,d]}function u(e,t,n,i,o,a,s){var r=[o-e,a-t];var l=[n-e,i-t];var p=Math.sqrt(Math.pow(l[0],2)+Math.pow(l[1],2));var h=[l[0]/p,l[1]/p];var u=r[0]*h[0]+r[1]*h[1];var d=[e+u*h[0],t+u*h[1]];var c=Math.sqrt(Math.pow(o-d[0],2)+Math.pow(a-d[1],2));var f;if(c===0){f=s}else{var f=Math.sqrt(Math.pow(s,2)-Math.pow(c,2))}var m=[e+u*h[0]+f*h[0],t+u*h[1]+f*h[1]];if(m[0]===e&&m[1]===t)return null;return m}function d(e,t,n,i,o,a,s){var r=[o-e,a-t];var l=[n-e,i-t];var p=[-l[1],l[0]];var h=Math.sqrt(Math.pow(p[0],2)+Math.pow(p[1],2));var u=[p[0]/h,p[1]/h];var d=r[0]*u[0]+r[1]*u[1];var c=b([e,t],[n,i],[o,a]);var f=g([c[0]-o,c[1]-a]);if(f>=s)return null;var m=Math.sqrt(Math.pow(s,2)-Math.pow(d,2));var y=[o-d*u[0],a-d*u[1]];var v=Math.sqrt(Math.pow(l[0],2)+Math.pow(l[1],2));var x=[l[0]/v,l[1]/v];var w=[[y[0]-x[0]*m,y[1]-x[1]*m],[y[0]+x[0]*m,y[1]+x[1]*m]];if(w[0][0]===e&&w[0][1]===t)return null;return w}function c(e,t,n,i,o,a,s,r){var l,p,h,u;l=n-e;p=i-t;h=s-o;u=r-a;var d,c;if(-h*p+l*u===0)return null;d=(-p*(e-o)+l*(t-a))/(-h*p+l*u);c=(h*(t-a)-u*(e-o))/(-h*p+l*u);if(d>=0&&d<=1&&c>=0&&c<=1){var f=e+c*l;var m=t+c*p;return[f,m]}return null}function f(e,t,n,i,o,a,r,l,p,f){var m=h(a,r,l,p,f);var g=[];if(n[0]&&!n[1]){g.push(u(e,t,i,o,a,r,f));g.push(c(e,t,i,o,m[0][0],m[0][1],m[3][0],m[3][1]));g.push(c(e,t,i,o,m[1][0],m[1][1],m[2][0],m[2][1]));var y=d(e,t,i,o,l,p,f);if(y)g.push(y[0],y[1])}else if(!n[0]&&n[1]){g.push(u(e,t,i,o,l,p,f));g.push(c(e,t,i,o,m[0][0],m[0][1],m[3][0],m[3][1]));g.push(c(e,t,i,o,m[1][0],m[1][1],m[2][0],m[2][1]));var y=d(e,t,i,o,a,r,f);if(y)g.push(y[0],y[1])}else if(n[0]&&n[1]){g.push(u(e,t,i,o,a,r,f));g.push(c(e,t,i,o,m[0][0],m[0][1],m[3][0],m[3][1]));g.push(c(e,t,i,o,m[1][0],m[1][1],m[2][0],m[2][1]));g.push(u(e,t,i,o,l,p,f))}else{var y=d(e,t,i,o,l,p,f);var b=d(e,t,i,o,a,r,f);if(y)g.push(y[0],y[1]);if(b)g.push(b[0],b[1]);g.push(c(e,t,i,o,m[0][0],m[0][1],m[3][0],m[3][1]));g.push(c(e,t,i,o,m[1][0],m[1][1],m[2][0],m[2][1]))}var v=[e,t];for(var x=0;x<g.length;x++){if(g[x]){if(s(g[x][0],g[x][1],i,o)<s(v[0],v[1],i,o)){v=g[x]}}}if(v[0]===e&&v[1]===t)return null;return v}function m(e,t,n,i,o,a,r,l,p){var u=h(o,a,r,l,p);var f=[];var m=d(e,t,n,i,o,a,p);if(m)f.push(m[0],m[1]);m=d(e,t,n,i,r,l,p);if(m)f.push(m[0],m[1]);f.push(c(e,t,n,i,u[0][0],u[0][1],u[3][0],u[3][1]));f.push(c(e,t,n,i,u[1][0],u[1][1],u[2][0],u[2][1]));var g=[n,i];var y=[e,t];for(var b=0;b<f.length;b++){if(f[b]){if(s(f[b][0],f[b][1],e,t)<s(g[0],g[1],e,t)){g=f[b]}}}for(var v=0;v<f.length;v++){if(f[v]){if(s(f[v][0],f[v][1],n,i)<s(y[0],y[1],n,i)){y=f[v]}}}if(g[0]===n&&g[1]===i||y[0]===e&&y[1]===t)return null;else return[g,y]}var g=function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])};var y=1e-6;var b=function(e,t,n){var i=[t[0]-e[0],t[1]-e[1]],o=g(i);if(o<y)return e;var a=[n[0]-e[0],n[1]-e[1]];var s=(i[0]*a[0]+i[1]*a[1])/o;if(s<0)return e;if(s>o)return t;return[e[0]+i[0]*s/o,e[1]+i[1]*s/o]};if(typeof exports!="undefined"){exports.erase=e}return e}();gm_hwr_request=function(){var e=function(e){var t={type:"stroke",x:[],y:[]};e.points.forEach(function(e){t.x.push(e[0]);t.y.push(e[1])});return t};var t=function(t,n){url="http://dlandy.psych.indiana.edu:7031/server.js";var i={components:t.map(e),resultTypes:["LATEX"]};var o={apiKey:"c26d2755-1fda-4033-b136-4af042f3f9db",equationInput:JSON.stringify(i)};var a=$.post(url,o.equationInput);a.done(function(e){var t=e.replace(/\\/g,"\\\\");t=JSON.parse(t);n(null,t.JSON)})};return t}();gmath.ui=gmath.ui||{};gmath.ui.holdUI=function(){var e=function(e,t){this.container=d3.select("body");this.controller=e;this.view=t;this.element=null;this.pos=[0,0];this.visible=false;this.buttons=[];this.button_els=null;this.colors=d3.scale.category10();this.button_rads=null;this.inner_radius=20;this.outer_radius=80;this.init();var n=this;showHoldUI=function(e){n.setPos([500,500]);n.setVisible(e)}};e.prototype.setPos=function(e){this.pos=e;this.element.style({left:e[0]-this.outer_radius+"px",top:e[1]-this.outer_radius+"px"})};e.prototype.setVisible=function(e){this.visible=e;this.element.style("display",e?null:"none");if(this.visible){var t=this.g.node().getBBox();this.element.style({width:t.width,height:t.height})}};e.prototype.init=function(){var e=this,t={stroke:"black","stroke-width":1,"stroke-linecap":"round",fill:"none"};if(gmath.array.includes(this.controller.hold_menu_options(),"derivation")){this.buttons.push({action:function(t){e.controller.inputDL(t,"holdUI")},icon:function(e){var t=e.append("g").attr("transform","translate(0,10)").append("g");var n=new gmath.AlgebraModel("f_x",{});var i=new gmath.AlgebraView(n,t,{font_size:"35",inactive_color:"black",interactive:false});i.init();return t},color:e.colors(0)})}if(gmath.array.includes(this.controller.hold_menu_options(),"graph")){this.buttons.push({action:function(t){var n={pos:{x:t[0],y:t[1]}};e.view.createGraph(n)},icon:function(e){var n=e.append("g").attr("transform","translate(2,0)").style("cursor","pointer");var i=n.append("g").style("opacity",.5).style("shape-rendering","crispedges");i.append("line").attr({x1:-15,y1:0,x2:15,y2:0}).style(t);i.append("line").attr({x1:0,y1:-15,x2:0,y2:15}).style(t);i.append("rect").attr({x:-15,y:-15,width:30,height:30}).style(t);n.append("line").attr({x1:-15,y1:8,x2:15,y2:-8}).style(t).style("stroke-width",1.5);return n},color:e.colors(1)})}if(gmath.array.includes(this.controller.hold_menu_options(),"textbox")){this.buttons.push({action:function(t){var n={pos:{x:t[0],y:t[1]}};e.view.createTextBox(n)},icon:function(e){var n=e.append("g");var i=n.append("g").style("opacity",.5);i.append("text").text("Aa").attr({x:0,y:10}).style("text-anchor","middle").style("font-size","30px").style(t).style("stroke","none").style("fill","black").style("pointer-events","none");return n},color:e.colors(2)})}this.button_rads=Math.PI*2/this.buttons.length;var n=this.button_rads,i=this.inner_radius,o=this.outer_radius;this.element=this.container.append("svg").style("overflow","visible").style("display","none").style("position","absolute");this.g=this.element.append("g").attr("transform","translate("+this.outer_radius+","+this.outer_radius+")");var a=this.element.append("defs"),s=a.append("filter").attr("id","dropShadow_holdUI");s.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",3);s.append("feOffset").attr("dx",0).attr("dy",4).attr("result","offsetblur");s.append("feComponentTransfer").append("feFuncA").attr("type","linear").attr("slope",.25);var r=s.append("feMerge");r.append("feMergeNode");r.append("feMergeNode").attr("in","SourceGraphic");this.element.attr("filter","url(#dropShadow_holdUI)");this.button_els=this.g.selectAll(".holdUI").data(this.buttons);this.button_els.enter().append("g").classed("holdUI",true).append("path").attr("d",function(e,t){var a=Math.cos(n*t)*i,s=-Math.sin(n*t)*i,r=Math.cos(n*t)*o,l=-Math.sin(n*t)*o,p=Math.cos(n*(t+1))*o,h=-Math.sin(n*(t+1))*o,u=Math.cos(n*(t+1))*i,d=-Math.sin(n*(t+1))*i;return"M"+a+","+s+"L"+r+","+l+"A"+o+","+o+" 0 0,0 "+p+","+h+"L"+u+","+d+"A"+i+","+i+" 0 0,1 "+a+","+s+"Z"}).style("fill",function(e){return e.color}).style("opacity",.8).style("cursor","pointer");this.button_els.each(function(e,t){var a=d3.select(this),s=e.icon(a);s.attr("transform",function(){var e=Math.cos(n*(t+.5))*(i+(o-i)/2),a=-Math.sin(n*(t+.5))*(i+(o-i)/2);return"translate("+e+", "+a+")"})})};e.prototype.detectHit=function(e){var t=this,n=this.button_rads,i=this.inner_radius,o=this.outer_radius,a=-1;this.button_els.each(function(s,r){var l=Math.sqrt(Math.pow(e[0]-t.pos[0],2)+Math.pow(e[1]-t.pos[1],2)),p=Math.atan2(-e[1]+t.pos[1],e[0]-t.pos[0]);if(p<0)p+=Math.PI*2;if(l>i&&l<o&&p>n*r&&p<n*(r+1))a=r});return a};e.prototype.highlight=function(e){var t=this.detectHit(e);this.button_els.each(function(e,n){var i=d3.select(this).select("path");if(t===n)i.transition().duration(30).style("fill",d3.rgb(e.color).brighter(.6));else i.transition().duration(30).style("fill",e.color)})};e.prototype.performAction=function(e,t){var n=this.detectHit(e);this.button_els.each(function(e,i){if(i===n)e.action(t)})};return e}();gmath.ui=gmath.ui||{};gmath.ui.CanvasController=function(){var e=function(e){var t=d3.dispatch("scroll","start_hwr","stop_hwr","undone","redone","hold","touch","drag","release","font_size","keyboard","entered_term","start-of-interaction","end-of-interaction","undoable-action");var n=gmath.uid(),i=e,o=null,a=[],s=-1,r=null,l=false,p=null,h=false,u=true,d,c=1500,f=null,m=i.paths().length,g=2,y=50,b=null,v="black",x=null,w=null,_=0,A=null,k=null,q=false,E=null,C=false,S=true,T=true,B="hold",I=["derivation","textbox","graph"],M=null,z=800,L=false,G=true;var F=function(){e.on("create."+n,function(e){if(e.target_type==="derivation"||e.target_type==="graph"||e.target_type==="textbox"||e.target_type==="image"){e.target.events.on("start-of-interaction."+n,function(e){i.setActive();t["start-of-interaction"](e)});e.target.events.on("end-of-interaction."+n,function(e){t["end-of-interaction"](e)});if(e.target_type==="derivation"){e.target.events.on("auto_undo."+n,function(e){setTimeout(function(){pe(e)},1)})}}});w=transform_behavior().allow_rotate(false).allow_scale(false).one_finger_drag(false).on("transform",function(){i.scroll(-d3.event.transform.translate[1])});if(T&&!E&&i.container()){E=new gmath.ui.holdUI(F,i)}Y(e.background_event_layer(),K());Y(e.foreground_event_layer(),ee());e.on("mode."+n,R);d3.select(document).on("keydown."+n,D.bind(this,null));window.addEventListener("beforeunload",function(e){if(!G||!L)return;var t="You have not saved your work. Are you sure you want to leave the page?";(e||window.event).returnValue=t;return t});if(S&&typeof gmath.ui.Keyboard!=="undefined"&&typeof $!=="undefined"){p=gmath.ui.Keyboard();p.width(z).position("center")()}i.container().on("dragover",function(){d3.event.preventDefault()}).on("drop",de);return this};function D(e){var t=e||d3.event;if(t.keyCode===27){if(M){F.cancelInsertElementOnNextClick()}else{i.setActive();i.setActive(null,false)}}}F.askConfirmationOnClosing=function(e){if(arguments.length===0)return G;G=e;return this};F.insertElementOnNextClick=function(e,t,n){F.simulateStartOfInteraction();i.foreground_event_layer_visible(true);M={type:e,options:t||{},callback:n};i.foreground_event_layer().style("cursor","copy")};F.cancelInsertElementOnNextClick=function(e){if(!M)return;M=null;if(i.getMode()!=="draw"&&i.getMode()!=="erase"){i.foreground_event_layer_visible(false)}i.foreground_event_layer().style("cursor","auto");if(e)F.simulateEndOfInteraction()};var P=function(e){var t=false;M.options.pos=e;switch(M.type){case"derivation":if(M.options.eq){i.createDL(M.options);t=true}else{F.inputDL([e.x,e.y],"toolbar")}break;case"textbox":i.createTextBox(M.options);t=true;break;case"graph":i.createGraph({pos:e});t=true;break;case"ggb":j(e);t=true;break;case"ggb-table":O(e);t=true;break;case"table":i.createElement("table",{pos:e});t=true;break;default:console.warn("unknown element type",M.type)}if(M.callback)M.callback(e);F.cancelInsertElementOnNextClick(t)};var j=function(e){var t=600,n=400;var o=i.createElement("ggb-element",{pos:{x:e.x-t/2,y:e.y-n/2},size:{width:t,height:n}});i.createElement("ggb-panel",{ggbElement:o,pos:{x:e.x+t/2,y:e.y-n/2},size:{width:75,height:n},min_size:{width:75,height:50}})};var O=function(e){var t=600,n=600;var o=i.createElement("ggb-element",{pos:{x:e.x-t/2,y:e.y-n/2},size:{width:t,height:n},ggb_params:{showMenuBar:false,showAlgebraInput:false,showToolBar:true,customToolBar:"0|40",showResetIcon:false,enableLabelDrags:false,enableShiftDragZoom:false,enableRightClick:false,errorDialogsActive:false,useBrowserForJS:true,preventFocus:false,language:"en"},ggb_base64:"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"});o.events.on("ggb_init",function(){o.ggbApplet.setCoordSystem(-10,10,-10,10);i.elements().forEach(function(e){if(e.type=="table")e.setGraph(o)})})};function R(e){if(e.mode==="arrange")i.setActive(null);if(e.mode==="draw"||e.mode==="erase"){i.foreground_event_layer_visible(true);i.setActive(null)}else{i.foreground_event_layer_visible(false)}}F.id=n;F.logger=function(e){o=e;o.events.on("interaction."+n,this.addInteractionSummaryToTimeline.bind(this))};F.model=function(){if(arguments.length===0)return i};F.use_keyboard=function(e){if(arguments.length===0)return S;S=e;return this};F.keyboard_max_width=function(e){if(arguments.length===0)return z;z=e;return this};F.use_hold_menu=function(e){if(arguments.length===0)return T;if(Array.isArray(e)){F.hold_menu_options(e.filter(function(e){return I.indexOf(e)!==-1}))}T=Array.isArray(e)?true:e;if(T&&!E&&i.container()){E=new gmath.ui.holdUI(F,i)}return this};F.hold_menu_options=function(e){if(arguments.length===0)return I;I=e};F.color=function(e){if(arguments.length===0)return v;v=e;return this};F.markerRadius=function(e){if(arguments.length===0)return g;g=e;return this};F.eraserRadius=function(e){if(arguments.length===0)return y;y=e;return this};F.hwr_delay=function(e){if(arguments.length===0)return c;c=e;return this};F.hwr=function(e){if(!arguments.length)return u;if(u===e)return F;u=e;m=i.paths.length;if(!u)F.cancelHWR();return F};F.drawing=function(e){if(!arguments.length)return d;d=e;return this};F.scheduleHWR=function(){if(!f){f=setTimeout(F.performHWR,c);t.start_hwr()}};F.cancelHWR=function(e){if(!e)m=i.paths.length;if(f){clearTimeout(f);f=null;t.stop_hwr()}};F.performHWR=function(){f=null;t.stop_hwr();if(m>i.paths().length-1)return;var e=i.paths().slice(m),n=false,o=[];gm_hwr_request(e,function(t,a){if(t)console.log(t);var s=e[0].points[0];try{n=i.createDL({pos:{x:s[0],y:s[1]},eq:a})}catch(r){return}var l=function(e){try{i.removePath(e);o.push(e)}catch(t){return}};for(var p=0;p<e.length;p++){l(e[p])}m=i.paths().length});m=i.paths().length};F.font_smaller=function(){var e=parseInt(DerivationList.defaultOptions.font_size);if(e/1.2>12)this.set_font_size(e/1.2)};F.font_larger=function(){var e=parseInt(DerivationList.defaultOptions.font_size);if(e*1.2<160)this.set_font_size(e*1.2)};F.set_font_size=function(e){DerivationList.defaultOptions.font_size=e;i.dls().forEach(function(t){t.setFontSize(e)});t.font_size(new V(e))};var U=function(e){return i.createPath({points:[[e[0],e[1]-_]],color:i.setMode()==="draw"?v:"white",width:i.setMode()==="draw"?2*g:2*y})};var Q=function(e){this.type="hold";this.subType=e.subType;this.performee=n;this.performee_type="CanvasController";this.time=Date.now();this.finger={pos:[e.finger.pos[0],e.finger.pos[1]]};this.fingers=e.fingers.map(function(e){return{pos:[e.pos[0],e.pos[1]]}})};var Z=function(e){this.type="touch";this.subType=e.subType;this.performee=n;this.performee_type="CanvasController";this.time=Date.now();this.finger={pos:[e.finger.pos[0],e.finger.pos[1]],pos0:[e.finger.pos0[0],e.finger.pos0[1]]};this.fingers=e.fingers.map(function(e){return{pos:[e.pos[0],e.pos[1]]}})};var W=function(e){this.type="drag";this.subType=e.subType;this.performee=n;this.performee_type="CanvasController";this.time=Date.now();this.finger={pos:[e.finger.pos[0],e.finger.pos[1]]};this.fingers=e.fingers.map(function(e){return{pos:[e.pos[0],e.pos[1]]}})};var H=function(e){this.type="release";this.subType=e.subType;this.performee=n;this.performee_type="CanvasController";this.time=Date.now();this.finger={pos:[e.finger.pos[0],e.finger.pos[1]]};this.fingers=e.fingers.map(function(e){return{pos:[e.pos[0],e.pos[1]]}})};var V=function(e){this.type="fontSize";this.performee=n;this.performee_type="CanvasController";this.time=Date.now();this.font_size=e};var N=function(e){this.type="enteredTerm";this.performee=n;this.performee_type="CanvasController";this.time=Date.now();this.eq=e.eq;this.dl_id=e.id;this.options=gmath.deepCopy(e)};var X=function(e){this.type="enteredGraph";this.performee=n;this.performee_type="CanvasController";this.time=Date.now();this.graph_id=e};var J=function(){this.type="keyboard";this.performee=n;this.performee_type="CanvasController";this.time=Date.now()};function Y(e,t){e.call(t);t.frame(e.node())}function K(){if(B==="hold"){var e=mtouch_events().on("touch",te.bind(this,null)).on("hold",ne.bind(this,null)).on("drag",ie.bind(this,null)).on("tap",function(){i.setActive(null)}).on("release",oe.bind(this,null)).hold_max_dist(5).hold_time(500).call(w)}else if(B==="tap"){var e=mtouch_events().on("tap",function(){if(!T)return;if(E.visible)oe();else{ne();E.element.attr("pointer-events","none")}}).hold_max_dist(5).hold_time(500).call(w)}return e}function ee(){var e=mtouch_events().on("touch",ae.bind(this,null)).on("drag",se.bind(this,null)).on("release",re.bind(this,null)).hold_max_dist(5).hold_time(500);return e}var te=function(e){if(!T||q)return;var i=e||d3.event;if(!e&&d3.event){t["start-of-interaction"]({type:"start-of-interaction",source:{type:"CanvasController",id:n},time:Date.now()});t.touch(new Z(gmath.extend(d3.event,{subType:"menu"})))}if(i.fingers.length>1){q=true}};F.menu_touch=te;var ne=function(e){if(!T||q||S&&p.visible())return;var n=e||d3.event;if(!e&&d3.event){t.hold(new Q(gmath.extend(d3.event,{subType:"menu"})))}i.setActive();menu_pos=n.finger.pos.slice();E.setPos(n.finger.pos_client.slice());E.setVisible(true)};F.menu_hold=ne;var ie=function(e){if(!T||q)return;var n=e||d3.event;if(!e&&d3.event){t.drag(new W(gmath.extend(d3.event,{subType:"menu"})))}if(E.visible){E.highlight(n.finger.pos_client.slice())}};F.menu_drag=ie;var oe=function(e){var i=e||d3.event;if(!e&&d3.event){t.release(new H(gmath.extend(d3.event,{subType:"menu"})))}if(q){if(i.fingers.length===0)q=false;return}if(E&&E.visible){E.performAction(i.finger.pos_client.slice(),menu_pos);E.setVisible(false)}if(!e&&d3.event&&(!p||!p.visible())){t["end-of-interaction"]({type:"end-of-interaction",source:{type:"CanvasController",id:n},time:Date.now()})}};F.menu_release=oe;var ae=function(e){if(M||A)return;var o=e||d3.event;if(!e&&d3.event){t["start-of-interaction"]({type:"start-of-interaction",source:{type:"CanvasController",id:n},time:Date.now()});t.touch(new Z(gmath.extend(d3.event,{subType:"draw"})))}if(o.fingers.length>1){q=true}if(!d||q)return;console.log(A);var a=o.finger.pos0.slice();a[1]-=_;F.cancelHWR(true);A=U(o.finger.pos0);if(i.setMode()==="erase"){b=i.paths_container().append("circle").attr({cx:a[0],cy:a[1],r:y}).style({stroke:"silver",fill:"white"})}};F.draw_touch=ae;var se=function(e){if(M)return;var n=e||d3.event;if(!e&&d3.event){t.drag(new W(gmath.extend(d3.event,{subType:"draw"})))}if(!A||q||!d)return;var o=n.finger.pos.slice();o[1]-=_;A.points.push(o);i.updatePath(A);if(i.setMode()==="erase")b.attr({cx:o[0],cy:o[1]})};F.draw_drag=se;var re=function(e){var o=e||d3.event;if(M){P({x:o.finger.pos[0],y:o.finger.pos[1]});return}if(q){if(o.fingers.length===0)q=false;return}if(!A||o.fingers.length>0)return;if(i.setMode()==="draw"){if(u&&(!p||!p.visible()))F.scheduleHWR()}else if(i.setMode()==="erase"){b.remove();le()}A=null;if(!e&&d3.event){t.release(new H(gmath.extend(d3.event,{subType:"draw"})));t["end-of-interaction"]({type:"end-of-interaction",source:{type:"CanvasController",id:n},time:Date.now()})}};F.draw_release=re;var le=function(){var e=i.paths().slice(),t=e[e.length-1],n=[],o=[],a=[];e.forEach(function(e,s){if(e===t)return;var r=y+e.width/2;var l=gm_erase_paths([e.points],t.points,r);if(l.length===0){o.push(e);i.removePath(e)}else{a.push({path:e,points_before:e.points.slice(),points_after:l[0].slice()});e.points=l[0];i.updatePath(e);for(var p=1;p<l.length;p++){var h=i.createPath({points:l[p],color:e.color,width:e.width,oid:e.id});n.push(h)}}});i.removePath(t);eraseModification={removed:o,modified:a,added:n}};F.addInteractionSummaryToTimeline=function(e){L=true;if(e.length===1&&e[0].subtype==="save")L=false;var n=Timeline.entry(e,i);if(n){if(n.type==="erase"){n.modification=eraseModification;eraseModification=null}s++;a[s]=n;a.length=s+1;t["undoable-action"](n.type)}};F.reset=function(){o.listen(false);i.reset();a=[];s=-1;r=null;l=false;w.transform({translate:[0,0]});A=null;k=null;q=false;L=false;o.listen(true)};F.undo=function(){if(s===-1)return false;o.listen(false);var e=a[s];s--;e.undo(i,this);o.listen(true);return true};F.redo=function(){if(a.length<=s+1)return false;o.listen(false);s++;var e=a[s];e.redo(i,this);o.listen(true);return true};function pe(e){a.pop();s--}F.clearInteractionTimeline=function(){s=-1;a=[]};F.clear_undo_queue=function(){throw"(CanvasController) Deprecated method `clear_undo_queue` called."};F.inputDL=function(e,n){if(h)return;t.keyboard(new J);F.cancelHWR(true);k={pos:{x:e[0],y:e[1]-_},v_align:"center",h_align:"equals"};p.caption(null).latex("").on("done",function(e){he(e,n)}).on("cancel",ue).visible(true)};var he=function(e,o){if(!k)return;if(e===""){p.visible(false);return}k.eq=e;k.id=gmath.uid();
t.entered_term(new N(k));var a;var s=false;try{a=i.createDL(k,null,o);k=null}catch(r){console.log(r);p.warning("Could not parse expression.");return}p.visible(false);t["end-of-interaction"]({type:"end-of-interaction",source:{type:"CanvasController",id:n},time:Date.now()})};var ue=function(){p.visible(false);t["end-of-interaction"]({type:"end-of-interaction",source:{type:"CanvasController",id:n},time:Date.now()})};F.disableKeyboard=function(e){h=e};F.simulateStartOfInteraction=function(){t["start-of-interaction"]({type:"start-of-interaction",source:{type:"CanvasController",id:n},time:Date.now()})};F.simulateEndOfInteraction=function(){t["end-of-interaction"]({type:"end-of-interaction",source:{type:"CanvasController",id:n},time:Date.now()})};function de(){var e=d3.event;e.preventDefault();var o=d3.mouse(this);var a=ce(e.dataTransfer)||fe(e.dataTransfer);if(!a){console.log("could not parse drop data",e);var s={drop_evt:e,pos:{x:o[0],y:o[1]}};var r=i.createImage(s,"drag-n-drop");return}if(a.slice(0,4)==="http"){var s={drop_evt:e,pos:{x:o[0],y:o[1]}};var r=i.createImage(s,"drag-n-drop")}else{a=a.replace(/\\end{alignat}/g,"");a=a.replace(/\&\\\,/g,"");a=a.replace(/\\\,/g,"");a=a.replace(/\&/g,"");a=a.replace(/\\begin{alignat}{[0-9]*}/g,"");a=a.replace(/\\\;/g,"");a=a.replace(/[.,\s\\]+$/,"");var l=a.split("\\\\");if(a.length===0)return;try{t["start-of-interaction"]({type:"start-of-interaction",source:{type:"CanvasController",id:n},time:Date.now()});i.createDLs(l,{pos:{x:o[0],y:o[1]}},null,"drag-n-drop");t["end-of-interaction"]({type:"end-of-interaction",source:{type:"CanvasController",id:n},time:Date.now()})}catch(p){console.log("Could not parse equation!",p);var s={drop_evt:e,pos:{x:o[0],y:o[1]}};var r=i.createImage(s,"drag-n-drop")}}}function ce(e){var t=e.getData("text/html");var n=document.createElement("div");var i=d3.select(n).html(t).select("img");return i.size()===1?i.attr("alt"):null}function fe(e){return e.getData("text/plain")}return d3.rebind(F,t,"on")};return e}();gmath.ui=gmath.ui||{};gmath.ui.CanvasModelView=function(){var e=function(){var e=d3.dispatch("create","update","remove","reset","mode"),t=null,n,i,o,a,s,r,l,p,h,u=[],d=[],c=[],f=[],m=["edit","inspect","arrange","draw","erase"],g=0;function y(e){e.dl.draw_mappings_for_nodes([e.node])}var b=function(e){t=e;i=t.append("div").style({position:"absolute",left:0,right:0,top:0,bottom:0});p=i.append("div").style({position:"absolute",left:0,right:0,top:0,bottom:0});n=i.append("svg").classed("gm-canvas-svg",true).style({position:"absolute",width:"100%",height:"100%"}).style("pointer-events","none");s=n.append("g").attr("id","g_graphs");a=n.append("g").attr("id","g_paths");g_imgs=n.append("g").attr("id","g_imgs");r=n.append("g").attr("id","g_textboxes");o=n.append("g").attr("id","g_dls");h=t.append("div").style({position:"absolute",left:0,right:0,top:0,bottom:0}).style({display:"none","pointer-events":"all"});return this};b.reset=function(){for(var e=u.length-1;e>=0;e--)this.removeElement(u[e]);for(var e=d.length-1;e>=0;e--)this.removePath(d[e]);f=[];this.scroll(0)};b.setActive=function(e,t){if(arguments.length<2)t=true;if(e)e.setActive(t);u.forEach(function(t){if(t!==e){t.setActive(false);if(!e&&(t.type==="table"||t.type==="textbox")){t.unselect()}}})};b.focusOnDL=function(e){e.events.on("end-of-interaction."+this.id,e.initPosition.bind(e,true))};b.createDL=function(t,n,i){var o=new DerivationList(b,this.getContainer("derivation").node(),t,function(e){a(e);if(n)n(e)});function a(t){if(u.indexOf(t)!==-1)return;t.setMode(m[g]);t.events.on("inspect_node",y);u.push(t);d3.selectAll(".derivation-list").data(b.dls());var n={type:"create",target_type:"derivation",target:t};if(i)n.method=i;e.create(n)}a(o);return o};function v(e){if(e==="canvas-element")return gmath.CanvasElementClass;if(e==="image")return gmath.ui.CanvasImage;if(e==="textbox")return gmath.ui.TextBox;if(e==="graph")return gmath.ui.Graph;if(e==="derivation")return gmath.DerivationList;if(e==="ggb-panel")return gmath.ui.GeoGebraPanel;if(e==="ggb-element")return gmath.ui.GeoGebraCanvasElement;if(e==="table")return gmath.ui.Table;throw'unkown element type "'+e+'"'}b.getContainer=function(e){if(e==="canvas-element")return i;if(e==="image")return i;if(e==="textbox")return i;if(e==="graph")return s;if(e==="derivation")return i;if(e==="ggb-panel")return i;if(e==="ggb-element")return i;if(e==="table")return i;throw'unkown element type "'+e+'"'};b.createElement=function(t,n,i,o){var a=b.getContainer(t);var s=v(t);var r=new s(b,a.node(),n,function(e){l(e);if(o)o(e)});function l(n){if(u.indexOf(n)!==-1)return;n.setMode(m[g]);u.push(n);e.create({type:"create",target_type:t,target:n,method:i})}l(r);return r};b.createImage=function(t,n){var i=new gmath.ui.CanvasImage(b,this.getContainer("image").node(),t);u.push(i);e.create({type:"create",target_type:"image",target:i,method:n});return i};b.createTextBox=function(e,t,n){return b.createElement("textbox",e,n,t)};b.addElement=function(t){if(t in u)throw"element is already part of this canvas";x(f,t);t.canvas_model=b;t.initElement(b.getContainer(t.type).node());t.setMode(m[g]);u.push(t);e.create({type:"create",target_type:t.type,target:t});return b};b.addDL=function(t){x(f,t);if(u.indexOf(t)!==-1)throw"dl is already in this model";t.canvas_model=b;t.initElement(this.getContainer("derivation").node());t.setMode(m[g]);t.events.on("inspect_node",y);b.setActive(t);u.push(t);d3.selectAll(".derivation-list").data(b.dls());e.create({type:"create",target_type:"derivation",target:t});return t};b.addImage=function(t){x(f,t);t.canvas_model=b;t.initElement(g_imgs.node());t.setMode(m[g]);u.push(t);e.create({type:"create",target_type:"image",target:t})};b.addTextBox=function(t){x(f,image);t.canvas_model=b;t.initElement(r.node());t.setMode(m[g]);u.push(t);e.create({type:"create",target_type:"textbox",target:t});return t};b.createDLs=function(e,t,n,i){var o=0;a();function a(s){if(o===e.length){if(n)n()}else{if(s)t.pos[1]+=s.dims.height;var r=gmath.deepCopy(t);r.eq=e[o++];b.createDL(r,a,i)}}};b.isInFreeVisibleSpace=function(e,t){var n=this.viewport();if(e.y<n.y||e.y+e.height>n.y+n.height)return false;return this.getIntersectingElements(e,t).length===0};b.getIntersectingElements=function(e,t){return u.filter(function(n){if(t===n)return false;return gmath.HitTester.overlaps(e,n.getBBox())})};b.moveToFreeSpace=function(e,t){var n=e.getBBox(),i=this.viewport(),o={x:i.x,y:i.y,width:n.width,height:n.height},a;while(o.y+o.height<i.y+i.height){while(o.x+o.width<i.x+i.width){a=this.getIntersectingElements(o,e);if(a.length===0){e.translateElement(o,t);return true}else{var s=d3.max(a,function(e){return e.pos.x+e.size.width});o.x=s+1}}o.x=i.x;o.y=o.y+i.height/20}return false};b.createPath=function(t,n){var i=new gmath.ui.Path(a.node(),t);d.push(i);var o={type:"create",target_type:"path",target:i};if(n)o.method=n;e.create(o);return i};b.removePath=function(t){x(d,t);t.remove();e.remove({type:"remove",target_type:"path",target:t})};b.addPath=function(t){if(d.indexOf(t)!==-1)throw"path is already in this model";t.setContainer(a);t.init();d.push(t);e.create({type:"create",target_type:"path",target:t});return t};b.updatePath=function(t){t.update();e.update({target_type:"path",target:t})};b.createGraph=function(t){t.view=b;var n=new gmath.ui.Graph(s.node(),t);c.push(n);e.create({type:"create",target_type:"graph",target:n});return n};b.removeGraph=function(t){x(c,t);t.remove();e.remove({type:"remove",target_type:"graph",target:t})};b.removeElement=function(t){x(u,t);f.push(t);var n=t.removeElement();e.remove({type:"remove",target_type:t.type,target:t});return n};var x=function(e,t){if(e.length===0)return false;var n=e.indexOf(t);if(n===-1)return false;e.splice(n,1);return true};b.elements=function(){return u};b.dls=function(){return b.getElementsOfType("derivation")};b.graphs=function(){return c};b.textboxes=function(){return b.getElementsOfType("textbox")};b.images=function(){return b.getElementsOfType("image")};b.getElementsOfType=function(e){return u.filter(function(t){return t.type===e})};b.getElementByID=function(e){for(var t=0;t<u.length;t++)if(u[t].id===e)return u[t];for(var t=0;t<d.length;t++)if(d[t].id===e)return d[t]};b.getDeletedElementByID=function(e){for(var t=0;t<f.length;t++)if(f[t].id===e)return f[t]};b.paths=function(t){if(!arguments.length)return d;for(var n=0;n<d.length;n++)d[n].remove();d=t.slice();for(var n=0;n<d.length;n++){d[n].setContainer(a);d[n].init()}e.reset({target_type:"path",target:d.slice()})};b.scroll=function(e){if(arguments.length===0)return t.node().parentNode.scrollTop;t.node().parentNode.scrollTop=e;return this};b.container=function(){return t};b.background_event_layer=function(e){return p};b.foreground_event_layer=function(e){return h};b.foreground_event_layer_visible=function(e){if(!arguments.length)return h.style("display");h.style("display",e?null:"none")};b.dls_container=function(e){if(!arguments.length)return o;o=e;return this};b.paths_container=function(e){if(!arguments.length)return a;a=e;return this};b.graphs_container=function(e){if(!arguments.length)return s;s=e;return this};b.textboxes_container=function(e){if(!arguments.length)return r;r=e;return this};b.size=function(){var e=t.node();return{width:e.clientWidth,height:e.clientHeight}};b.viewport=function(){var e=t.node().parentNode;return{x:0,width:e.clientWidth,y:e.scrollTop,height:e.clientHeight}};b.getMode=function(){return m[g]};b.setMode=function(t){if(arguments.length===0)return m[g];g=m.indexOf(t);u.forEach(function(e){e.setMode(t)});e.mode({type:"mode",mode:t});return this};return d3.rebind(b,e,"on")};return e}();gmath.ui=gmath.ui||{};gmath.ui.resource_path="../shared/";gmath.ui.CanvasFactory=function(){var e=function(t,n,i){this.id=gmath.uid();this.container=d3.select(t);n=n||{};this.options=gmath.object.merged(gmath.deepCopy(!n.minimal?e.defaultOptions:e.minimalOptions),n);if(gmath.log_ga&&this.options.disable_ga_tracking)gmath.log_ga.enabled(false);var o;if(this.options.parse_url_options){o=gmath.getURLParameter("options");try{if(o)o=JSON.parse(o)}catch(a){console.error("Error parsing url options: ",a)}}if(o)gmath.extend(this.options,o);this.events=d3.dispatch("button");this.model=gmath.ui.CanvasModelView();this.controller=gmath.ui.CanvasController(this.model).drawing(this.options.drawing).hwr(this.options.hwr).use_keyboard(this.options.use_keyboard).use_hold_menu(this.options.use_hold_menu).keyboard_max_width(this.options.keyboard_max_width).askConfirmationOnClosing(this.options.ask_confirmation_on_closing);this.init();if(this.options.overflow_visible){this.scroll_div.style("overflow","visible");this.content_div.style("overflow","visible")}if(i&&this.options.savefile_server){this.remove();var s=this.getOptionsForFileLoading();if(o)gmath.extend(s,o);gmath.CanvasSaver.loadSaveFile(this.container.node(),this.options.savefile_server+"/api/saves/canvas_save_files",i,s)}this.logger=new DataLogger(this,this.options.log_mouse_trajectories);this.controller.logger(this.logger);if(this.options.parse_url_query_params&&!(i&&this.options.savefile_server)){this.parseURLQueryParams()}};gmath.ui.CanvasFactoryClass=e;e.prototype.serialize=function(){return JSON.stringify(this.model.dls().concat(this.model.graphs()))};e.prototype.init=function(){this.outer_div=this.container.append("div").classed("flex-container-columns",true).style({width:this.options.width,height:this.options.height});this.options.toolbar_container=this.options.toolbar_container?d3.select(this.options.toolbar_container):this.outer_div;if(this.options.use_toolbar)this.initToolbar();this.scroll_div=this.options.toolbar_pos==="top"?this.outer_div.append("div"):this.outer_div.insert("div","div.btn-toolbar");this.scroll_div.classed("gm-canvas",true).style("width",this.options.width).style("flex",1).style("-webkit-flex",1).style("position","relative").style("overflow-y",this.options.vertical_scroll?"scroll":"hidden");this.content_div=this.scroll_div.append("div").style("width","100%").style("min-height",this.options.vertical_scroll?"200%":"100%").style("position","absolute").call(this.model);this.controller();if(this.options.vertical_scroll){this.scroll_div.on("scroll",this.adjustCanvasSize.bind(this));this.adjustCanvasSize(true)}if(this.options.identification_interval!==false){this.id_modal=new IdentificationModal(this.options.identification_interval);this.id_modal.events.on("identified",this.onUserIdentification.bind(this));this.id_modal.show();this.controller.on("start-of-interaction",this.id_modal.resetTimer.bind(this.id_modal))}};e.prototype.onUserIdentification=function(e){this.logger.logCustomInteraction("user-id",{user_id:e.id,user_type:e.type})};e.prototype.initToolbar=function(){var e=this;this.tools=this.options.toolbar_container.append("div").attr({"class":"btn-toolbar",role:"toolbar"}).style(this.options.toolbar_on_style);if(this.options.minimal){this.tools.on("mouseenter",function(){if(e.toolFadeoutTimer)clearTimeout(e.toolFadeoutTimer)}).on("mouseleave",this.switchToolbarState.bind(this))}if(this.options.drawing){this.options.mode_btns.splice(3,0,{type:"radio",group:"draw",state:false,label:"draw",icon:"glyphicon glyphicon-pencil"},{type:"radio",group:"draw",state:false,label:"erase",icon:"glyphicon glyphicon-erase"})}if(this.options.mode_btns)this.appendButtonGroup(this.options.mode_btns,this.onButton);if(this.options.reset_btn)this.appendButtonGroup([this.options.reset_btn],this.onButton);if(this.options.undo_btn||this.options.redo_btn){var t=[];if(this.options.undo_btn)t.push(this.options.undo_btn);if(this.options.redo_btn)t.push(this.options.redo_btn);this.appendButtonGroup(t,this.onButton)}if(this.options.font_smaller_btn&&this.options.font_larger_btn){var n=[];n.push(this.options.font_smaller_btn);n.push(this.options.font_larger_btn);this.appendButtonGroup(n,this.onButton)}if(this.options.feedback&&this.options.feedback_btn){this.appendButtonGroup([this.options.feedback_btn],this.onButton)}if(this.options.insert_btn)gmath.ui.addInsertButton(this);if(this.options.homework_btn)gmath.ui.addHomeworkButton(this);if(this.options.formula_btn)gmath.ui.addMacroButton(this);var i=[];if(this.options.saving_and_loading){if(this.options.save_btn)i.push(this.options.save_btn);if(this.options.load_btn)i.push(this.options.load_btn)}if(this.options.share_btn)i.push(this.options.share_btn);if(i.length)this.appendButtonGroup(i,this.onButton);if(this.options.help_btn)gmath.ui.addHelpButton(this);if(this.options.minimal){this.tools.classed("btn-toolbar-minimal",true);var o=this.tools.append("div").attr("class","btn-group pull-right").style({"line-height":"26px","margin-left":"40px"});o.append("span").text("powered by").style({"font-style":"italic","font-family":"sans-serif",color:"#909090","font-weight":300,"font-size":"13px"});var a=o.append("a").style({"text-decoration":"none"}).attr({href:"http://graspablemath.com",target:"_blank"});a.append("img").attr({alt:"GM",src:this.options.logo_src}).style({"vertical-align":"-0.3em",height:"1.7em","margin-left":"0.8em","margin-right":"0.2em","font-size":"13px"})}if(this.options.minimal&&this.options.static_toolbar)this.switchToolbarState(true)};e.prototype.showHint=function(e,t,n){var i=this.model;if(!n)n={};if(i.dls().length>0&&!this.options.always_show_initial_hint)return;var o={pos:{x:-1e3,y:-1e3},size:{width:n.width||220,height:0},text:e,closable:true,uneditable:true,static_bg:true,text_align:"center",dont_log_events:true,font_size:n.font_size||16,resizable:false};var a=i.createTextBox(o,function(e){var t=i.viewport();e.translateElement({x:n.x||t.x+t.width/2-e.size.width/2,y:n.y||t.y+t.height/2-e.size.height/2})});if(t){i.on("create.gm-inital-hint",function(){if(i.textboxes().indexOf(a)>=0)a.fade();i.on("create.gm-initial-hint",null)})}};e.prototype.parseURLQueryParams=function(){var e=gmath.getURLParameter("eq");if(e){e=e.split(";");this.controller.simulateStartOfInteraction();for(var t=0;t<e.length;t++){this.model.createDL({eq:e[t],pos:{x:200+350*t,y:100}},null,"URL")}this.controller.simulateEndOfInteraction()}};e.prototype.adjustCanvasSize=function(e){var t=this.scroll_div.node().getBoundingClientRect().height;var n=this.content_div.node().getBoundingClientRect().height;var i=this.scroll_div.property("scrollTop");if(!this.scroll_top)this.scroll_top=i;if(e){var o=Math.round(n/t);this.content_div.style("height",t*o+"px")}if(i>this.scroll_top){if(n-i<t){var o=Math.round(n/t)+1;this.content_div.style("height",t*o+"px")}}else if(i<this.scroll_top){if(n-i>=2*t&&this.noObjectsHiddenBelowView(i)){var o=Math.round(n/t)-1;this.content_div.style("height",t*o+"px")}}this.scroll_top=i};e.prototype.noObjectsHiddenBelowView=function(e){var t=[];t=this.model.dls().concat(this.model.graphs()).concat(this.model.textboxes()).concat(this.model.paths());if(t.length===0)return true;for(var n=0;n<t.length;n++){var i=t[n];if(i.pos){if(Array.isArray(i.pos)&&i.pos[1]>e)return false;else if(i.pos.y>e)return false}else if(i.points&&i.points[0][1]>e)return false}return true};e.prototype.switchToolbarState=function(e,t){var n=this;if(e){n.turnOnToolbar()}else{if(t)n.turnOffToolbar();else{n.toolFadeoutTimer=setTimeout(function(){n.turnOffToolbar()},n.options.toolFadeoutDelay)}}};e.prototype.turnOnToolbar=function(){if(this.toolFadeoutTimer){clearTimeout(this.toolFadeoutTimer);this.toolFadeoutTimer=null}this.tools.style(this.options.toolbar_on_style);this.toolbarOn=true};e.prototype.turnOffToolbar=function(){if(this.toolFadeoutTimer){clearTimeout(this.toolFadeoutTimer);this.toolFadeoutTimer=null}this.tools.style(this.options.toolbar_off_style);this.toolbarOn=false};e.prototype.resize=function(e){this.options.width=e.width;this.options.height=e.height;this.scroll_div.style({width:this.options.width,height:this.options.height});if(this.tools)this.tools.style({width:this.options.width})};e.prototype.onButton=function(e){if(this.id_modal)this.id_modal.resetTimer();var t={mode:this.model.setMode()==="inspect"?"scrub":this.model.setMode(),font_size:DerivationList.defaultOptions.font_size};this.updateButton(e);if(e.label==="clear all"){if(this.logger.canvas_logger.containsPendingEvents(this.logger.canvas_logger.interactionSequence)){this.logger.canvas_logger.submitCurrentSequence()}if(gmath.log_ga)gmath.log_ga.trackEvent(this.options.gm_app_name,"button press","reset",1);if(confirm("Really clear the canvas?")){this.controller.reset()}}if(e.label==="undo"){if(this.logger.canvas_logger.containsPendingEvents(this.logger.canvas_logger.interactionSequence)){this.logger.canvas_logger.submitCurrentSequence()}this.controller.undo();if(gmath.log_ga)gmath.log_ga.trackEvent(this.options.gm_app_name,"button press","undo",1)}if(e.label==="redo"){if(this.logger.canvas_logger.containsPendingEvents(this.logger.canvas_logger.interactionSequence)){this.logger.canvas_logger.submitCurrentSequence()}if(gmath.log_ga)gmath.log_ga.trackEvent(this.options.gm_app_name,"button press","redo",1);this.controller.redo()}if(e.label==="HWR"){if(gmath.log_ga)gmath.log_ga.trackEvent(this.options.gm_app_name,"button press","hwr",1);this.controller.hwr(e.state)}if(e.label==="transform"){if(gmath.log_ga)gmath.log_ga.trackEvent(this.options.gm_app_name,"button press","transform",1);this.model.setMode("edit")}if(e.label==="scrub"){if(gmath.log_ga)gmath.log_ga.trackEvent(this.options.gm_app_name,"button press","scrub",1);this.model.setMode("inspect")}if(e.label==="arrange"){if(gmath.log_ga)gmath.log_ga.trackEvent(this.options.gm_app_name,"button press","arrange",1);this.model.setMode("arrange")}if(e.label==="draw"){if(gmath.log_ga)gmath.log_ga.trackEvent(this.options.gm_app_name,"button press","draw",1);this.model.setMode("draw")}if(e.label==="erase"){if(gmath.log_ga)gmath.log_ga.trackEvent(this.options.gm_app_name,"button press","erase",1);this.model.setMode("erase")}if(e.label==="help"){if(gmath.log_ga)gmath.log_ga.trackEvent(this.options.gm_app_name,"button press","help",1);this.help()}if(e.label==="feedback"){if(gmath.log_ga)gmath.log_ga.trackEvent(this.options.gm_app_name,"button press","feedback",1);this.sendFeedback()}if(e.label==="fullscreen"&&e.state===true){if(gmath.log_ga)gmath.log_ga.trackEvent(this.options.gm_app_name,"button press","start fullscreen",1);this.launchFullScreen()}if(e.label==="fullscreen"&&e.state===false){if(gmath.log_ga)gmath.log_ga.trackEvent(this.options.gm_app_name,"button press","stop fullscreen",1);this.cancelFullScreen()}if(!(e.label==="HWR"&&e.state===true)&&this.options.hwr===true){if(gmath.log_ga)gmath.log_ga.trackEvent(this.options.gm_app_name,"button press","cancel HWR",1);this.controller.cancelHWR()}if(e.label==="larger"){if(gmath.log_ga)gmath.log_ga.trackEvent(this.options.gm_app_name,"button press","font larger",1);this.controller.font_larger()}if(e.label==="smaller"){if(gmath.log_ga)gmath.log_ga.trackEvent(this.options.gm_app_name,"button press","font smaller",1);this.controller.font_smaller()}if(e.label==="save"){gmath.CanvasSaver.save(this);if(gmath.log_ga)gmath.log_ga.trackEvent(this.options.gm_app_name,"button press","save",1)}if(e.label==="load"){this.remove();gmath.CanvasSaver.load(this.container.node(),null,this.getOptionsForFileLoading());if(gmath.log_ga)gmath.log_ga.trackEvent(this.options.gm_app_name,"button press","load",1)}if(e.label==="share"&&!this.publishing){this.publishConfirmation();if(gmath.log_ga)gmath.log_ga.trackEvent(this.options.gm_app_name,"button press","share",1)}var n={button:{label:e.label,state:e.state,type:e.type},old_state:t,time:Date.now()};if(n.button.label==="larger"||n.button.label==="smaller")n.button.font_size=DerivationList.defaultOptions.font_size;this.events.button(n)};e.prototype.getOptionsForFileLoading=function(){return{parse_url_query_params:false,disable_ga_tracking:this.options.disable_ga_tracking,gm_app_name:this.options.gm_app_name,savefile_server:this.options.savefile_server,log_mouse_trajectories:this.options.log_mouse_trajectories}};e.prototype.showSaveError=function(e){var t=d3.select("#publish-share-panel"),n=t.select("div");n.classed("alert-danger",true);t.classed("panel-default",false).classed("panel-danger",true);var i=this;n.selectAll("p").remove();n.append("p").html("Sorry, we could not share the canvas.</br>Reason: "+e);if(e.indexOf("too big")===-1){n.append("p").text("Please save your work locally and try again later. Make sure you are connected to the internet!")}else{n.append("p").text("We currently don't support uploading this much data. Please save your work locally instead.")}n.append("button").property("type","button").classed("btn btn-default",true).text("Ok").on("click",function(){t.remove();i.publishing=false})};e.prototype.publishConfirmation=function(){this.publishing=true;var e=this;var t=this.scroll_div.append("div").classed("panel panel-default",true).attr("id","publish-share-panel").style({width:"500px",position:"absolute",right:"20px",top:"20px"});var n=t.append("div").classed("panel-body",true);n.append("h3").text("Share your math!");n.append("p").text('Click the "Publish" button to save your work on the Graspable Math server.'+"  We'll give you a key so you or anyone else can get a copy.");n.append("button").property("type","button").classed("btn btn-default",true).classed("pull-right",true).text("Cancel").on("click",function(){t.remove();e.publishing=false});n.append("button").property("type","button").classed("btn btn-primary",true).text("Publish").on("click",function(){n.remove();n=t.append("div").classed("panel-body",true);n.append("p").text("Working...");gmath.CanvasSaver.share(e.options.savefile_server+"/saves/canvas_save_files",e,function(t,n){if(t)e.showSaveError(t.reason);else e.noSaveError(n)})})};e.prototype.noSaveError=function(e){var t=d3.select("#publish-share-panel"),n=t.select("div");var i=this;n.selectAll("p").remove();n.append("h3").text("Here is your link:");var o=location.origin+location.pathname+"?load="+e;n.append("div").classed("share_link",true).append("input").attr({type:"text"}).on("click",function(){this.select();this.setSelectionRange(0,this.value.length)}).on("input",function(){this.value=o;this.select();this.setSelectionRange(0,this.value.length)}).node().value=o;n.append("p").text("Keep this link for yourself or share it with others. It will always "+"point to the canvas as it is right now. Click the share button again if you "+"want to create a new link to an updated version.");n.append("p").text("To embed the saved GM canvas into your own webpage, put the following snippet into"+" the body of your html file.");var a='<script type="text/javascript">url = parent.document.URL; document.write(\'<iframe style="border: none" src=\\\''+o+'&options={"saving_and_loading": false, "drawing": false, "formula_btn": false, "vertical_scroll": false}&parent_url=\'+url+\'\\\' width=100% height=500px></iframe>\');</script>';n.append("div").classed("share_link",true).append("input").attr({type:"text"}).on("click",function(){this.select();this.setSelectionRange(0,this.value.length)}).on("input",function(){this.value=a;this.select();this.setSelectionRange(0,this.value.length)}).node().value=a;n.append("div").classed("emailTo");n.append("p").text("Enter your email address and we'll email you the share link!");var s=n.append("div").classed("input-group",true);s.append("input").attr({type:"email","class":"form-control",id:"toEmail"}).attr({placeholder:"your@email.com"});s.append("span").classed("input-group-btn",true).append("button").attr({type:"button","class":"btn btn-default",id:"send_btn"}).text("Send Email!").on("click",r);function r(){var e=$("#toEmail").val();var t=/\S+@\S+\.\S+/.test(e);s.classed("has-error",!t);if(!t)return;n.select("#send_btn").text("Sending...").attr("disabled",true).style("pointer-events","none");var i={};i.toEmail=e;var r="Here is your link:\n\r";r+=o;r+="\n\r Keep this link for yourself or share it with others. It will always point to the canvas as it is right now. Click the share button again if you want to create a new link to an updated version.To embed the saved GM canvas into your own webpage, put the following snippet into the body of your html file.  \n\r";r+=a;i.subject="Graspable Math Save Link";i.body=r;var l=new XMLHttpRequest;l.onreadystatechange=function(){if(l.readyState===4&&l.status===200){n.select("#send_btn").text("Sent.")}};l.open("POST","https://graspablemath.com:7010/send_email_to",true);l.setRequestHeader("Content-Type","application/json");l.send(JSON.stringify(i))}n.append("hr");n.append("button").property("type","button").classed("btn btn-primary",true).text("Done").on("click",function(){t.remove();i.publishing=false})};e.prototype.launchFullScreen=function(e){e=e||document.body;if(e.requestFullscreen)e.requestFullscreen();else if(e.mozRequestFullScreen)e.mozRequestFullScreen();else if(e.webkitRequestFullscreen)e.webkitRequestFullscreen();else if(e.msRequestFullscreen)e.msRequestFullscreen()};e.prototype.help=function(){var e=window.open("http://graspablemath.com/unstable/tutorial/index.html","_blank");e.focus()};e.prototype.sendFeedback=function(){var e=window.open("mailto:contact@graspablemath.com","_blank");e.focus()};e.prototype.cancelFullScreen=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.msExitFullscreen)document.msExitFullscreen()};e.prototype.updateButton=function(e){if(!this.tools)return;this.tools.select("button#"+e.label).datum(e).each(function(e){if(e.type==="toggle"){e.state=!e.state;d3.select(this).classed("active",e.state)}else if(e.type==="radio"){var t=this;d3.select(this.parentNode).selectAll("button").each(function(e){e.state=t===this}).classed("active",function(e){return e.state})}})};e.prototype.appendButtonElement=function(e,t){var n=this;var i=e.append("button").attr("id",function(e){return e.label}).attr({type:"button","class":"btn btn-default"}).classed("btn-xs",n.options.btn_size==="xs").classed("btn-sm",n.options.btn_size==="sm").classed("active",function(e){return e.state}).style("min-width","4em");i.filter(function(e){return e.type==="dropdown"}).classed("toggle-dropdown",true).attr("data-toggle","dropdown").attr("aria-haspopup","true").attr("aria-expanded","false");if(t)i.call(mtouch_events().on("touch",t.bind(this)));if(this.options.display_icons){var o=i.filter(function(e){return e.icon});o.append("i").attr("class",function(e){return e.icon}).style({color:"#555","font-size":"1.2em","line-height":"1.7em"}).style("padding-left",function(e){return e.type==="dropdown"?"0.25em":null}).style("transform",function(e){return e.flip==="x"?"rotateX(180deg)":e.flip==="y"?"rotateY(180deg)":e.flip==="xy"?"rotateZ(180deg)":null});var a=o.filter(function(e){return e.type==="dropdown"});a.append("span").html("&nbsp;");a.append("span").classed("caret",true);o.append("br")}if(this.options.display_labels){i.append("span").text(function(e){return e.label}).style("color","#555");if(!this.options.display_icons){var a=i.filter(function(e){return e.type==="dropdown"});a.append("span").html("&nbsp;");a.append("span").classed("caret",true)}}};e.prototype.appendButtonGroup=function(e,t,n){if(!this.tools)throw"Can't add buttons if toolbar is disabled.";var i=n?this.tools.insert("div","*"):this.tools.append("div");i.attr({"class":"btn-group",role:e[0].group}).classed("pull-right",e[0].pull_right);var o=i.selectAll("button").data(e);o.enter().call(this.appendButtonElement.bind(this),t);if(e.length===1&&e[0].type==="dropdown"){var a=e[0].html_fn(i.node(),e[0]);d3.select(a).attr("aria-labelledby",e[0].label).classed("dropdown-menu",true)}return i};e.prototype.remove=function(){if(this.tools)this.tools.remove();this.outer_div.remove()};e.minimalOptions={width:"100%",height:"100%",vertical_scroll:false,toolbar_pos:"top",static_toolbar:true,undo_btn:{type:"push",label:"undo",icon:"glyphicon glyphicon-chevron-left"},redo_btn:{type:"push",label:"redo",icon:"glyphicon glyphicon-chevron-right"},use_keyboard:false,use_hold_menu:false,drawing:false,display_icons:true,display_labels:false,btn_size:"xs",toolbar_on_style:{display:"inline-block",position:"absolute","margin-top":"-35px",padding:"5px","padding-right":"10px",background:"rgba(255, 255, 255, 0.901961)","border-radius":"3px"},toolbar_off_style:{display:"none"},toolFadeoutDelay:500,logo_src:"../shared/imgs/gm-logo.png",overflow_visible:true};e.defaultOptions={width:"100%",height:"100%",vertical_scroll:true,parse_url_query_params:false,parse_url_options:true,toolbar_pos:"top",undo_btn:{type:"push",label:"undo",icon:"glyphicon glyphicon-chevron-left"},redo_btn:{type:"push",label:"redo",icon:"glyphicon glyphicon-chevron-right"},reset_btn:{type:"push",label:"clear all",icon:"glyphicon glyphicon-refresh"},font_smaller_btn:{type:"push",label:"smaller",icon:"glyphicon glyphicon-text-size",flip:"y"},font_larger_btn:{type:"push",label:"larger",icon:"glyphicon glyphicon-text-size"},formula_btn:true,help_btn:{type:"push",label:"help",pull_right:true,icon:"glyphicon glyphicon-question-sign"},hwr_btn:{type:"toggle",label:"HWR",pull_right:true,state:true,icon:"glyphicon glyphicon-font"},fullscreen_btn:{type:"toggle",label:"fullscreen",pull_right:true,state:false,icon:"glyphicon glyphicon-resize-full"},homework_btn:false,hwr:false,feedback_btn:{type:"push",label:"feedback",pull_right:true,icon:"glyphicon glyphicon-envelope"},feedback:false,disable_ga_tracking:false,gm_app_name:"canvas factory",use_keyboard:true,use_hold_menu:true,drawing:true,display_icons:true,display_labels:true,btn_size:"sm",mode_btns:[{type:"radio",group:"mode",state:true,label:"transform",icon:"glyphicon glyphicon-random"},{type:"radio",group:"mode",state:false,label:"scrub",icon:"glyphicon glyphicon-wrench"},{type:"radio",group:"mode",state:false,label:"arrange",icon:"glyphicon glyphicon-move"}],use_toolbar:true,toolbar_on_style:{"margin-bottom":"10px"},toolbar_off_style:{display:"none"},toolFadeoutDelay:0,save_btn:{type:"push",label:"save",pull_right:true,icon:"glyphicon glyphicon-save"
},load_btn:{type:"push",label:"load",pull_right:true,icon:"glyphicon glyphicon-open"},formulas_btn:true,insert_btn:true,savefile_server:"http://127.0.0.1:7010",share_btn:{type:"push",label:"share",pull_right:true,icon:"glyphicon glyphicon-send"},saving_and_loading:false,log_mouse_trajectories:false,keyboard_max_width:800,ask_confirmation_on_closing:true,identification_interval:false};return e}();var GeoGebraCanvasElement=function(e,t,n,i){n=gmath.object.merged(GeoGebraCanvasElement.defaultOptions,n);CanvasElement.call(this,e,t,n);this.type="ggb-element";this.events=gmath.extend(this.events,d3.dispatch("ggb_add","ggb_remove","ggb_update","ggb_rename","ggb_click","ggb_init"));this.ggb_objs=[];this.adding_ggb_object_for_row=undefined;this.dont_update=undefined;this.links=[];this.initOptions(n);this.ggbApplet=null;this.init(i)};gmath.inherit(CanvasElement,GeoGebraCanvasElement);gmath.ui.GeoGebraCanvasElement=GeoGebraCanvasElement;GeoGebraCanvasElement.defaultOptions={type:"GeoGebraCanvasElement",resizable:{x:true,y:true},min_size:{width:300,height:300},edit_mode_drag_box_width:-20,ggb_params:{showMenuBar:false,showAlgebraInput:false,showToolBar:true,showResetIcon:false,enableLabelDrags:false,enableShiftDragZoom:false,enableRightClick:true,errorDialogsActive:false,useBrowserForJS:true,preventFocus:false,language:"en"},ggb_base64:"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",ggb_views:{is3D:0,AV:0,SV:0,CV:0,EV2:0,CP:0,PC:0,DA:0,FI:0,PV:0,macro:0}};GeoGebraCanvasElement.prototype.initOptions=function(e){e=e||{};var t=gmath.deepCopy(GeoGebraCanvasElement.defaultOptions);var n=gmath.object.extendExisting(t,e);this.options=gmath.extend(this.options,n)};GeoGebraCanvasElement.prototype.init=function(e){this.div=this.element_div.append("div").attr("id","ggbApplet"+this.id);var t=function(){var e=gmath.object.merged(this.options.ggb_params,{width:this.size.width,height:this.size.height,id:this.id});if(this.options.ggb_base64)e.ggbBase64=this.options.ggb_base64;this.ggbLoader=new GGBApplet(e,"5.0",this.options.ggb_views);this.ggbLoader.inject("ggbApplet"+this.id)};var n=window.ggbOnInit;window.ggbOnInit=function(t){if(t!==this.id){n(t);return}if(this.options.ggbBase64)this.ggbApplet.setBase64(this.options.ggbBase64);this.ggbApplet=this.ggbLoader.getAppletObject();this.ggbApplet.registerUpdateListener(this.events.ggb_update.bind(this));this.ggbApplet.registerAddListener(this.events.ggb_add.bind(this));this.ggbApplet.registerRemoveListener(this.events.ggb_remove.bind(this));this.ggbApplet.registerRenameListener(this.events.ggb_rename.bind(this));this.ggbApplet.registerClickListener(this.events.ggb_click.bind(this));setTimeout(function(){this.div.selectAll("*").style("box-sizing","content-box","important");this.subTypeResize();if(e)e(this)}.bind(this),1);this.events.ggb_init(this);app=this.ggbApplet}.bind(this);if(window.GGBApplet)t.call(this);else gmath.loadScripts(["https://tube.geogebra.org/scripts/deployggb.js"],t.bind(this))};GeoGebraCanvasElement.prototype.subTypeResize=function(){this.ggbApplet.setWidth(this.size.width);this.ggbApplet.setHeight(this.size.height)};GeoGebraCanvasElement.prototype.toJSON=function(){return{type:"GeoGebraCanvasElement",id:this.id,pos:gmath.deepCopy(this.pos),size:gmath.deepCopy(this.size),ggb_base64:this.ggbApplet.getBase64()}};gmath.ui.GeoGebraPanel=function(){var e=function(t,n,i,o){i=gmath.object.merged(e.defaultOptions,i);CanvasElement.call(this,t,n,i);this.type="ggb-panel";this.ggb_objs=[];this.adding_ggb_object_for_row=undefined;this.dont_update=undefined;this.links=[];this.initOptions(i);this.ggbElement=i.ggbElement;this.ggbElement.ggbPanel=this;if(this.ggbElement.ggbApplet)this.init();else this.ggbElement.events.on("ggb_init",this.init.bind(this))};gmath.inherit(CanvasElement,e);e.defaultOptions={type:"GeoGebraPanel",size:{width:100,height:500},resizable:{x:false,y:false},font_size:15,bg_edit_style:{border:"1px solid silver","background-color":"#eee"},bg_edit_active_style:{"background-color":"#eee"},bg_arrange_style:{"background-color":"#eee"},bg_arrange_active_style:{"background-color":"#eee"},show_definitions:false,draggable:false};e.prototype.initOptions=function(t){t=t||{};var n=gmath.deepCopy(e.defaultOptions);var i=gmath.object.extendExisting(n,t);this.options=gmath.extend(this.options,i)};e.prototype.init=function(){this.ggbApplet=this.ggbElement.ggbApplet;this.div=this.element_div.append("div").style({height:"100%",padding:"5px","overflow-y":"auto","overflow-x":"hidden"}).classed("ggb-panel",true);this.ggbElement.events.on("move."+this.id,this.moveAttached.bind(this));this.ggbElement.events.on("resize."+this.id,this.resizeAttached.bind(this));this.ggbElement.events.on("ggb_add."+this.id,this.ggbAddListener.bind(this));this.ggbElement.events.on("ggb_update."+this.id,this.ggbUpdateListener.bind(this));this.ggbElement.events.on("ggb_remove."+this.id,this.ggbRemoveListener.bind(this));this.ggbElement.events.on("ggb_rename."+this.id,this.ggbRenameListener.bind(this));this.ggbElement.events.on("ggb_click."+this.id,this.ggbClickListener.bind(this));this.updateAllGGBObjects();this.update()};e.prototype.moveAttached=function(e){this.translateElement({x:e.pos.x+this.ggbElement.size.width-1,y:e.pos.y},e.animated)};e.prototype.resizeAttached=function(e){this.translateElement({x:this.ggbElement.pos.x+e.size.width-1,y:this.ggbElement.pos.y});this.resizeElement({width:this.size.width,height:e.size.height})};e.prototype.ggbUpdateListener=function(e){this.updateGGBObject(e);if(this.options.show_definitions)this.update()};e.prototype.ggbClickListener=function(e){};e.prototype.setGGBHighlight=function(e,t){var n=this.getGGBObject(e);if(!n||n.highlighted===t)return;if(t){n.color=this.ggbApplet.getColor(e);this.ggbApplet.setColor(e,255,0,0)}else{var i=d3.rgb(n.color);this.ggbApplet.setColor(e,i.r,i.g,i.b)}n.highlighted=t};e.prototype.setCanvasHighlight=function(e,t){this.setCanvasHighlightByLink(e,t)};e.prototype.setCanvasHighlightByName=function(e,t){this.canvas_model.dls().forEach(function(n){n.rows.forEach(function(n){var i=false;n.model.for_each(function(n){if(n.is_group("var")&&!n.fixed&&n.value===e){if(n.selected!==t)i=true;n.selected=t}});if(i){n.view.renderer.set_style(n.view.model.children);n.view.update_style(true)}})})};e.prototype.setCanvasHighlightByLink=function(e,t){this.links.forEach(function(n){if(n.ggb_obj&&n.ggb_obj.name===e){var i=n.row.dl.getVisibleRowOn(n.row);i.model.children[0].selected=t;i.view.renderer.set_style(i.view.model.children);i.view.update_style(true)}})};e.prototype.ggbAddListener=function(e){this.updateGGBObject(e);this.update()};e.prototype.ggbRemoveListener=function(e){var t=gmath.findIndex(this.ggb_objs,function(t){return e===t.name});if(t!==-1){this.ggb_objs.splice(t,1);this.update();t=gmath.findIndex(this.links,function(t){return e===t.ggb_obj.name});if(t!==-1){this.links[t].unlink();this.links.splice(t,1)}}};e.prototype.ggbRenameListener=function(e,t){var n=gmath.findIndex(this.ggb_objs,function(t){return e===t.name});if(n===-1){this.updateGGBObject(t);this.update()}else{this.ggb_objs[n].name=t;this.renameVariableOnCanvas(e,t);this.update()}};e.prototype.renameVariableOnCanvas=function(e,t){var n=t.split("_");this.canvas_model.dls().forEach(function(t){t.rows.forEach(function(t){var i=false;t.model.for_each(function(t){if(t.is_group("var")&&!t.fixed&&t.value===e){i=true;t.set_value(n[0],n[1])}});if(i)t.view.update_all()})})};e.prototype.createLink=function(e,n){this.links.push(new t(e,n,this))};e.prototype.updateGGBObject=function(e){var t=this.getGGBObject(e);if(!t){t={name:e,type:this.ggbApplet.getObjectType(e),idx:this.ggbApplet.getObjectNumber(e)};this.ggb_objs.push(t);if(t.type==="point")this.ggbApplet.setLabelVisible(e,true)}t.def_str=this.ggbApplet.getDefinitionString(e);t.independent=this.ggbApplet.isIndependent(e);t.movable=this.ggbApplet.isMoveable(e);t.visible=this.ggbApplet.getVisible(e);if(t.type==="point"){t.x=this.ggbApplet.getXcoord(e);t.y=this.ggbApplet.getYcoord(e)}t.cmd_str=this.ggbApplet.getCommandString(e);var n=false;var i=this.ggbApplet.getValueString(e);if(i!==t.value_str){t.value_str=i;n=true}try{var o=this.ggbApplet.getValue(e);if(o!==t.value){t.value=o;n=true}}catch(a){}if(n&&this.dont_update!==e){this.links.forEach(function(t){t.onGGBChange(e)})}return t};e.prototype.updateAllGGBObjects=function(){var e=this.ggbApplet.getAllObjectNames();e.forEach(this.updateGGBObject.bind(this))};e.prototype.getGGBObject=function(e){return gmath.find(this.ggb_objs,function(t){return t.name===e})};e.prototype.nestByType=function(e){return d3.nest().key(function(e){return e.type}).sortKeys(d3.ascending).sortValues(function(e,t){return e.idx-t.idx}).entries(e)};e.prototype.dropDLRow=function(e){var t;if(t=this.matchSILine(e.model)){var n=this.ggbApplet.evalCommandGetLabels("Point[yAxis]");this.ggbApplet.setCoords(n,0,t.b_val);var i=this.ggbApplet.evalCommandGetLabels("(1,"+(t.b_val+t.m_val)+")");var o=this.ggbApplet.evalCommandGetLabels("Line["+[n,i]+"]");this.links.push(new GM_GGB_SI_Line_Link(this.getGGBObject(n),this.getGGBObject(i),this.getGGBObject(o),e,this))}else{var a=this.ggbApplet.evalCommandGetLabels(e.model.to_ascii());this.ggbApplet.setLabelVisible(a,true);if(e.model.options.locked){this.ggbApplet.setFixed(a,true);this.ggbApplet.setColor(a,68,68,68);this.ggbApplet.setPointSize(a,3)}this.createLink(this.getGGBObject(a),e)}};e.prototype.matchSILine=function(e){var t=e.match("y=±{m:\\NUM}*{x:x}±{?b:\\NUM}","y={?x:x}±{?b:\\NUM}");if(t)return{m_val:t.m?t.m.get_signed_value():t.x?1:0,b_val:t.b?t.b.get_signed_value():0,m_node:t.m,b_node:t.b};t=e.match("y=-x±{?b:\\NUM}");if(t)return{m_val:-1,b_val:t.b?t.b.get_signed_value():0,b_node:t.b};return false};e.prototype.matchSegment=function(e){return e.match("\\VAR = ±{val:\\NUM}")};e.prototype.matchPoint=function(e){return e.match("\\VAR = (±{x:\\NUM},±{y:\\NUM})","(±{x:\\NUM},±{y:\\NUM})")};e.prototype.matchPointString=function(e){if(!this.__pt_rx)this.__pt_rx=new RegExp(".*= ?\\(([^(),]*),([^(),]*)\\)");return e.match(this.__pt_rx)};e.prototype.dropGGBObject=function(e){var t=e.value_str.substring(e.value_str.indexOf(":")+1),n=this.canvas_model,i=this;var o=n.createDL({eq:t,pos:{x:-1e3,y:"top"}},function(e){if(!n.moveToFreeSpace(e))e.translateElement({x:i.size.width+i.pos.x,y:i.pos.y})});o.getLastModel().setLocked(!e.movable);this.createLink(e,o.getLastRow())};e.prototype.update=function(){var e=this;var t=this.div.selectAll("div.type").data(this.nestByType(this.ggb_objs));var n=t.enter().append("div").classed("type",true);n.append("p");t.exit().remove();t.select("p").text(function(e){return e.key+"s"});var i=t.selectAll("p.object").data(function(e){return e.values});i.enter().append("p").classed("object",true).style("cursor","pointer").on("click",function(t){e.dropGGBObject(t);e.setGGBHighlight(t.name,true);e.setCanvasHighlight(t.name,true)}).on("mouseenter",function(t){e.setGGBHighlight(t.name,true);e.setCanvasHighlight(t.name,true)}).on("mouseleave",function(t){e.setGGBHighlight(t.name,false);e.setCanvasHighlight(t.name,false)});i.exit().remove();i.text(function(t){return e.show_definitions?t.value_str:t.name})};e.prototype.toJSON=function(){return{type:"GeoGebraPanel",id:this.id,pos:gmath.deepCopy(this.pos),size:gmath.deepCopy(this.size),ggbElement:this.ggbElement.id}};GM_GGB_SI_Line_Link=function(e,t,n,i,o){this.id=gmath.uid();this.ggb_ic=e;this.ggb_2nd=t;this.ggb_obj=n;this.model=i.model;this.row=i;this.ggb_panel=o;this.model.events.on("change."+this.id,this.onAMChange.bind(this))};GM_GGB_SI_Line_Link.prototype.onAMChange=function(e){if(e.old_model!==this.model)throw"wrong old_model";if(e.new_model!==e.old_model){this.model.events.on("change."+this.id,null);this.model=e.new_model;this.model.events.on("change."+this.id,this.onAMChange.bind(this))}if(e.sender===this.id)return;var t=e.old_model_ascii||e.old_model.to_ascii();var n=this.ggb_panel.matchSILine(new gmath.AlgebraModel(t));var i=this.ggb_panel.matchSILine(this.model);var o=this.ggb_2nd.x,a=this.ggb_2nd.y,s=i.m_val;if(n.b_val!==i.b_val){a=s*o+i.b_val;this.ggb_panel.ggbApplet.setCoords(this.ggb_ic.name,0,i.b_val);this.ggb_panel.ggbApplet.setCoords(this.ggb_2nd.name,o,a)}else{var r=a-i.b_val,l=Math.sqrt(o*o+r*r),p=Math.atan2(o>=0?s:-s,o>0?1:-1);o=l*Math.cos(p);a=l*Math.sin(p)+i.b_val;this.ggb_panel.ggbApplet.setCoords(this.ggb_2nd.name,o,a)}};GM_GGB_SI_Line_Link.prototype.onGGBChange=function(e){if(this.dont_update)return;if(e===this.ggb_ic.name){var t=this.ggb_panel.matchSILine(this.model);if(!t.b_node){this.model.replace_with("y="+(t.m_node?t.m_val:"")+"x+0",this.id);t=this.ggb_panel.matchSILine(this.model)}this.model.numeric_value(t.b_node,this.ggb_ic.y,this.id);this.dont_update=true;this.ggb_panel.ggbApplet.setCoords(this.ggb_2nd.name,this.ggb_2nd.x,this.ggb_ic.y+t.m_val*(this.ggb_2nd.x-this.ggb_ic.x));this.dont_update=false}else if(e===this.ggb_2nd.name){var t=this.ggb_panel.matchSILine(this.model);if(!t.m_node){if(!t.b_node)this.model.replace_with("y=1x",this.id);else this.model.replace_with("y=1x"+(t.b_val<0?"-":"+")+t.b_val,this.id);t=this.ggb_panel.matchSILine(this.model)}this.model.numeric_value(t.m_node,(this.ggb_2nd.y-this.ggb_ic.y)/(this.ggb_2nd.x-this.ggb_ic.x),this.id)}};GM_GGB_SI_Line_Link.prototype.unlink=function(){this.model.events.on("change."+this.id,null);this.model.events.on("end-of-interaction."+this.id,null)};var t=function(e,t,n){this.id=gmath.uid();this.ggb_obj=e;this.row=t;this.model=t.model;this.ggb_panel=n;if(e.type==="segment")this.onGGBChange(e.name);this.model.events.on("change."+this.id,this.onAMChange.bind(this));this.model.events.on("end-of-interaction."+this.id,this.onAMeoi.bind(this))};t.prototype.onAMeoi=function(e){this.onGGBChange(this.ggb_obj.name)};t.prototype.onAMChange=function(e){if(e.old_model!==this.model)throw"wrong old_model";if(e.new_model!==e.old_model){this.model.events.on("change."+this.id,null);this.model.events.on("end-of-interaction."+this.id,null);this.model=e.new_model;this.model.events.on("change."+this.id,this.onAMChange.bind(this));this.model.events.on("end-of-interaction."+this.id,this.onAMeoi.bind(this))}var t=this.ggb_obj.name;if(e.sender===t)return;this.dont_update=true;if(!this.ggb_obj.movable)this.ggb_panel.ggbApplet.setFixed(t,false);if(!this.handleAMPointChange()){if(!this.ggb_obj.movable)this.ggb_panel.ggbApplet.setFixed(t,false);this.ggb_panel.ggbApplet.evalCommand(t+": "+e.new_model.to_ascii())}if(this.ggb_obj.movable&&this.model.options.locked)this.ggb_panel.ggbApplet.setFixed(t,true);this.dont_update=false};t.prototype.handleAMPointChange=function(){if(this.ggb_obj.type!=="point")return false;var e=this.ggb_obj.name;var t=this.ggb_panel.matchPoint(this.model);if(t){var n=t.x.get_signed_value(),i=t.y.get_signed_value();this.ggb_panel.ggbApplet.setCoords(e,n,i)}else{if(this.model.children[0].is_group("equals")){this.ggb_panel.ggbApplet.evalCommand(this.model.to_ascii())}else{this.ggb_panel.ggbApplet.evalCommand(e+": "+this.model.to_ascii())}}return true};t.prototype.onGGBChange=function(e){if(this.dont_update)return;if(e!==this.ggb_obj.name)return;var t=this.ggb_obj.value_str.substring(this.ggb_obj.value_str.indexOf(":")+1);if(this.ggb_obj.type==="point"){var n=this.ggb_panel.matchPoint(this.model);if(!n)return;var i=this.ggb_panel.matchPointString(t);this.model.numeric_value(n.x,+i[1],e);this.model.numeric_value(n.y,+i[2],e)}else if(this.ggb_obj.type==="segment"){var n=this.ggb_panel.matchSegment(this.model);this.model.numeric_value(n.val,+this.ggb_obj.value,e)}else{this.model.replace_with(t,e)}};t.prototype.unlink=function(){this.model.events.on("change."+this.id,null);this.model.events.on("end-of-interaction."+this.id,null)};return e}();gmath.ui.addInsertButton=function(){var e=[{label:"select one and click on the canvas",header:true},{label:"Math Expression",value:"derivation",icon:"imgs/menu-icons/sqrt-x.png"},{label:"Text",value:"textbox",icon:"imgs/menu-icons/text.png"},{label:"Graph",value:"ggb",icon:"imgs/menu-icons/geogebra.svg"}];var t;function n(e){t=e;btn=t.appendButtonGroup([{type:"dropdown",label:"insert",icon:"glyphicon glyphicon-plus-sign",html_fn:o}],null,true);$(btn.node()).on("show.bs.dropdown",i)}function i(){t.controller.cancelInsertElementOnNextClick()}function o(t,n){var i=d3.select(t).append("ul");var o=i.selectAll("li").data(e).enter();var s=o.append("li");var r=s.filter(function(e){return e.header});var l=s.filter(function(e){return!e.header});r.classed("dropdown-header",true).text(function(e){return e.label});var p=l.append("a").attr("href","#").style("padding","10px 20px").on("click",function(e){d3.event.preventDefault();a(e)});var h={"vertical-align":"bottom",position:"relative",height:"1.8em",left:"-0.5em",top:"0.15em"};p.filter(function(e){return e.icon}).append("img").style(h).style("opacity",.5).attr("src",function(e){return gmath.ui.resource_path+e.icon});p.filter(function(e){return!e.icon}).append("span").style(h).style("width","1.8em").style("display","inline-block");p.append("span").text(function(e){return e.label});return i.node()}function a(e){t.controller.insertElementOnNextClick(e.value)}return n}();gmath.ui.addMacroButton=function(){var e=[{title:"Quadratic Formula",math:"ax^2+bx+c=0  =>  x=(-b±sqrt{b^2-4*a*c})/(2*a)"}];var t,n;function i(e){t=e;t.appendButtonGroup([{type:"dropdown",label:"formulas",data_toggle:"dropdown",pull_right:true,icon:"glyphicon glyphicon-book",html_fn:o}])}function o(t,n){a(e);var i={cols:2,mar:5,w:200,h:180};var o=s(t,i),l=r(o,i);$(t).on("shown.bs.dropdown",function(){y()});$(t).on("hide.bs.dropdown",function(){g(null,l)});return o.node()}function a(e){e.forEach(function(e){e.dl=new gmath.DerivationList(null,null,{eq:e.math.replace("=>","\\\\"),visualized:false})})}function s(e,t){dropdown=d3.select(e).append("div");dropdown.on("click",function(){d3.event.stopPropagation()});dropdown.style("width",t.cols*t.w+2*t.cols*t.mar+2*t.mar+2+"px");dropdown.style("padding",t.mar+"px");dropdown.append("p").text("click to apply or drag to copy a formula").style({color:"gray","font-style":"italic","text-align":"center"});return dropdown}function r(t,n){var i=t.selectAll(".formulas").data(e);var o=i.enter().append("div").style({width:n.w+"px",height:n.h+"px",margin:n.mar+"px",display:"inline-block","vertical-align":"top",border:"1px solid silver","border-radius":"2px",padding:"5px","text-align":"center",position:"relative",cursor:"pointer"}).on("mousedown",function(e){l(e,i);h(e)}).on("click",function(e){p(e,i);h(e)});o.append("h2").text(function(e){return e.title}).style({"font-size":"1em",margin:"5px 0 10px 0"});o.append("p").style("margin-bottom","0px").append(function(e){var t=document.createElement("div");e.expression1_container=d3.select(t);return t});o.append("div").style("clear","both");o.append("p").style("margin-bottom","0px").append(function(e){var t=document.createElement("div");e.expression2_container=d3.select(t);return t});o.append("div").style({position:"absolute",top:0,bottom:0,left:0,right:0});return i}function l(e,t){u(e,t);e.allow_copy=true;c(e,t)}function p(e,t){e.allow_copy=false}function h(e){if(e.selected)f(e);else d()}function u(t,n){e.forEach(function(e){e.selected=t&&e===t?!t.selected:false;e.allow_copy=e===t});n.style("background",function(e){return e.selected?"#FFDF00":null})}function d(e){if(!e)e=[];t.model.dls().forEach(function(e){e.getLastRow().view.interaction_handler.highlight_nodes([])});e.forEach(function(e){e.getLastView().interaction_handler.highlight_nodes(e.getLastModel().children)})}function c(e,i){if(t.model.foreground_event_layer_visible()==="none"){t.model.foreground_event_layer_visible(true);var o=t.model.foreground_event_layer();if(!n){n=mtouch_events().frame(o.node()).on("tap",function(){var t={x:d3.event.finger.pos[0],y:d3.event.finger.pos[1]};e.actions.forEach(function(e){if(e.target_dl.hitTest(t))e.target_row.model.performAction(e.action)});g(e,i)});o.call(n)}}}function f(e){e.actions=[];var n=[e.dl.rows[0].model,e.dl.getLastModel()];t.model.dls().forEach(function(t){var i=t.getLastRow(),o=gmath.actions.ApplyMacroAction.getAllAvailableActions(n,i.model);e.actions=e.actions.concat(o.map(function(e){return{action:e,target_dl:t,target_row:i}}))});d(e.actions.map(function(e){return e.target_dl}))}function m(e,n){t.model.createDL({eq:e.dl.rows[0].model.to_ascii(),pos:{x:n.layerX,y:n.layerY}})}function g(e,n){if(t.model.foreground_event_layer_visible()){t.model.foreground_event_layer().on("click.macro-menu",null);t.model.foreground_event_layer_visible(false)}u(e,n);d()}function y(){e.forEach(function(e){if(!e.initialized){b(e.expression1_container,e.dl.rows[0].model.to_ascii());b(e.expression2_container,e.dl.getLastModel().to_ascii())}e.initialized=true})}function b(e,t,n){var i=32;var o=e.append("svg").style("width","100%").style("overflow","visible").style("margin-left","0.5em").style("display","inline-block").style("visibility","hidden");var a=new gmath.AlgebraModel(t);var s=new gmath.AlgebraView(a,o,{interactive:false,inactive_color:"#000000",font_size:i,v_align:"alphabetic",h_align:"left"});var r=function(){var t=s.getBBox();o.style("height",t.height).style("width",t.width);s.main.attr("transform","translate("+[0,t.height]+")");if(n){e.style("margin-bottom",t.height-a.children[0].ascent+"px")}else{o.style("margin-bottom",t.height-a.children[0].ascent+"px")}};s.init(function(){r();var e=s.getBBox();setTimeout(function(){var t=o.node().parentNode.clientWidth,n=e.width;if(n>.9*t){s.options.font_size*=.9*t/n;s.update_all(true);r()}o.style("visibility",null)},1)})}return i}();gmath.ui.addHomeworkButton=function(){var e=[{title:"Chapter 1 Fundamental Concepts of Algebra",subchapters:[{title:"1.1 Real Numbers",problems:[{num:1,text:"If <i>x</i> < 0 and <i>y</i> > 0, determine the sign of the real number.",alignment:"row",parts:[{type:"derivation",options:{eq:"xy"},label:true},{type:"derivation",options:{eq:"x^2y"},label:true},{type:"derivation",options:{eq:"x/y+x"},label:true},{type:"derivation",options:{eq:"y-x"},label:true}]},{num:"3, 5",text:"We're not yet supporting these problems. Please see p. 13 in the textbook.",alignment:null,parts:[]},{num:7,text:"Express the statement as an inequality.",alignment:"column",parts:[{type:"textbox",options:{text:"<i>x</i> is negative."},label:true},{type:"textbox",options:{text:"<i>y</i> is nonnegative."},label:true},{type:"textbox",options:{text:"<i>q</i> is less than or equal to <i>π</i>."},label:true},{type:"textbox",options:{text:"<i>d</i> is between 4 and 2."},label:true},{type:"textbox",options:{text:"<i>t</i> is not less than 5."},label:true}]},{num:9,text:"Rewrite the number without using the absolute value symbol, and simplify the result.",alignment:"row",parts:[{type:"derivation",options:{eq:"|-3-2|"},label:true},{type:"derivation",options:{eq:"|-5|-|2|"},label:true},{type:"derivation",options:{eq:"|7|+|-4|"},label:true}]},{num:11,text:"Rewrite the number without using the absolute value symbol, and simplify the result.",alignment:"row",parts:[{type:"derivation",options:{eq:"(-5)*|3-6|"},label:true},{type:"derivation",options:{eq:"|-6|/(-2)"},label:true},{type:"derivation",options:{eq:"|-7|+|4|"},label:true}]},{num:13,text:"Rewrite the number without using the absolute value symbol, and simplify the result.",alignment:"row",parts:[{type:"derivation",options:{eq:"|4-π|"},label:true},{type:"derivation",options:{eq:"|π-4|"},label:true},{type:"derivation",options:{eq:"|sqrt2-1.5|"},label:true}]},{num:15,text:"We're not yet supporting this problem. Please see p. 14 in the textbook.",alignment:null,parts:[]},{num:19,text:"The two given numbers are coordinates of points <i>A</i> and <i>B</i>, respectively, on a coordinate line. Express the indicated statement as an inequality involving the absolute value symbol.",alignment:"row",parts:[{type:"derivation",options:{eq:"x"},label:false},{type:"derivation",options:{eq:"7"},label:false},{type:"textbox",options:{text:"<i>d</i>(<i>A</i>, <i>B</i>) is less than 5"},label:false}]},{num:23,text:"The two given numbers are coordinates of points <i>A</i> and <i>B</i>, respectively, on a coordinate line. Express the indicated statement as an inequality involving the absolute value symbol.",alignment:"row",parts:[{type:"derivation",options:{eq:"4"},label:false},{type:"derivation",options:{eq:"x"},label:false},{type:"textbox",options:{text:"<i>d</i>(<i>A</i>, <i>B</i>) is not greater than 3"},label:false}]},{num:25,text:"Rewrite the expression without using absolute the value symbol, and simplify the result.",alignment:"row",parts:[{type:"derivation",options:{eq:"|3+x|"},label:false},{type:"textbox",options:{text:"if <i>x</i> < -3"},label:false}]},{num:27,text:"Rewrite the expression without using the absolute value symbol, and simplify the result.",alignment:"row",parts:[{type:"derivation",options:{eq:"|2-x|"},label:false},{type:"textbox",options:{text:"if <i>x</i> < 2"},label:false}]},{num:29,text:"Rewrite the expression without using the absolute value symbol, and simplify the result.",alignment:"row",parts:[{type:"derivation",options:{eq:"|a-b|"},label:false},{type:"textbox",options:{text:"if <i>a</i> < b"},label:false}]},{num:31,text:"Rewrite the expression without using the absolute value symbol, and simplify the result.",alignment:"row",parts:[{type:"derivation",options:{eq:"|x^2+4|"},label:false}]},{num:"33-53",text:"We're not yet supporting these problems. Please see p. 14 in the textbook.",alignment:null,parts:[]},{num:57,text:"Avogadro's number",alignment:null,parts:[{type:"textbox",options:{text:"The number of hydrogen atoms in a mole is Avogadro's number, 6.02 x 10<sup>23</sup>. If one mole of the gas has a mass of 1.01 grams, estimate the mass of a hydrogen atom."},label:false}]},{num:59,text:"Frames in a movie film",alignment:null,parts:[{type:"textbox",options:{text:"One of the longest movies ever made is a 1970 British film that runs for 48 hours. Assuming that the film speed is 24 frames per second, approximate the total number of frames in this film. Express your answer in scientific form."},label:false}]},{num:61,text:"Tornado pressure",alignment:"column",parts:[{type:"textbox",options:{text:"When a tornado passes near a building, there is a rapid drop in the outdoor pressure and the indoor pressure does not have time to change. The resulting difference is capable of causing an outward pressure of 1.4 lb/in<sup>2</sup> on the walls and ceiling of the building."},label:false},{type:"textbox",options:{text:"Calculate the force in pounds exerted on 1 square foot of a wall."},label:true},{type:"textbox",options:{text:"Estimate the tons of force exerted on a wall that is 8 feet high and 40 feet wide."},label:true}]}]},{title:"1.2 Exponents and Radicals",problems:[{num:3,text:"Express the number in the form <i>a</i>/<i>b</i>, where <i>a</i> and <i>b</i> are integers.",alignment:null,parts:[{type:"derivation",options:{eq:"2^-3/3^-2"},label:false}]},{num:5,text:"Express the number in the form <i>a</i>/<i>b</i>, where <i>a</i> and <i>b</i> are integers.",alignment:null,
parts:[{type:"derivation",options:{eq:"-2^4+3^-1"},label:false}]},{num:7,text:"Express the number in the form <i>a</i>/<i>b</i>, where <i>a</i> and <i>b</i> are integers.",alignment:null,parts:[{type:"derivation",options:{eq:"16^(-3/4)"},label:false}]},{num:9,text:"Express the number in the form <i>a</i>/<i>b</i>, where <i>a</i> and <i>b</i> are integers.",alignment:null,parts:[{type:"derivation",options:{eq:"(-0.008)^(2/3)"},label:false}]},{num:13,text:"Simplify.",alignment:null,parts:[{type:"derivation",options:{eq:"((2x^3)(3x^2))/(x^2)^3"},label:false}]},{num:15,text:"Simplify.",alignment:null,parts:[{type:"derivation",options:{eq:"(1/6a^5)(-3a^2)(4a^7)"},label:false}]},{num:21,text:"Simplify.",alignment:null,parts:[{type:"derivation",options:{eq:"(8x^4y^-3)(1/2x^-5y^2)"},label:false}]},{num:25,text:"Simplify.",alignment:null,parts:[{type:"derivation",options:{eq:"(3y^3)^4(4y^2)^-3"},label:false}]},{num:29,text:"Simplify.",alignment:null,parts:[{type:"derivation",options:{eq:"(5x^2y^-3)(4x^-5y^4)"},label:false}]},{num:31,text:"Simplify.",alignment:null,parts:[{type:"derivation",options:{eq:"((3x^5y^4)/(x^0y^-3))^2"},label:false}]},{num:35,text:"Simplify.",alignment:null,parts:[{type:"derivation",options:{eq:"(3x^(5/6))(8x^(2/3))"},label:false}]},{num:39,text:"Simplify.",alignment:null,parts:[{type:"derivation",options:{eq:"(8x^(-2/3))x^(1/6)"},label:false}]},{num:41,text:"Simplify.",alignment:null,parts:[{type:"derivation",options:{eq:"((-8x^3)/y^-6)^(2/3)"},label:false}]},{num:43,text:"Simplify.",alignment:null,parts:[{type:"derivation",options:{eq:"(x^6/(9y^-4))^(-1/2)"},label:false}]},{num:45,text:"Simplify.",alignment:null,parts:[{type:"derivation",options:{eq:"(x^6y^3)^(-1/3)/(x^4y^2)^(-1/2)"},label:false}]},{num:49,text:"Rewrite the expression using rational exponents.",alignment:null,parts:[{type:"derivation",options:{eq:"sqrt[3]{(a+b)^2}"},label:false}]},{num:51,text:"Rewrite the expression using rational exponents.",alignment:null,parts:[{type:"derivation",options:{eq:"sqrt{x^2+y^2}"},label:false}]},{num:53,text:"Rewrite the expression using a radical.",alignment:"row",parts:[{type:"derivation",options:{eq:"4x^(2/3)"},label:true},{type:"derivation",options:{eq:"(4x)^(3/2)"},label:true}]},{num:55,text:"Rewrite the expression using a radical.",alignment:"row",parts:[{type:"derivation",options:{eq:"8-y^(1/3)"},label:true},{type:"derivation",options:{eq:"(8-y)^(1/3)"},label:true}]},{num:65,text:"Simplify the expression, and rationalize the denominator when appropriate.",alignment:null,parts:[{type:"derivation",options:{eq:"sqrt[3]{8a^6b^-3}"},label:false}]},{num:67,text:"Simplify the expression, and rationalize the denominator when appropriate.",alignment:null,parts:[{type:"derivation",options:{eq:"sqrt{(3x)/(2y^3)}"},label:false}]},{num:69,text:"Simplify the expression, and rationalize the denominator when appropriate.",alignment:null,parts:[{type:"derivation",options:{eq:"sqrt[3]{(2x^4y^4)/(9x)}"},label:false}]},{num:71,text:"Simplify the expression, and rationalize the denominator when appropriate.",alignment:null,parts:[{type:"derivation",options:{eq:"sqrt[4]{(5x^8y^3)/(27x^2)}"},label:false}]},{num:73,text:"Simplify the expression, and rationalize the denominator when appropriate.",alignment:null,parts:[{type:"derivation",options:{eq:"sqrt[5]{(5x^7y^2)/(8x^3)}"},label:false}]},{num:77,text:"Simplify the expression, and rationalize the denominator when appropriate.",alignment:null,parts:[{type:"derivation",options:{eq:"sqrt[5]{(8x^3)/y^4}*sqrt[5]{(4x^4)/y^2}"},label:false}]},{num:79,text:"Simplify the expression, and rationalize the denominator when appropriate.",alignment:null,parts:[{type:"derivation",options:{eq:"sqrt[3]{3t^4v^2}*sqrt[3]{-9t^-1v^4}"},label:false}]},{num:81,text:"Simplify the expression, assuming <i>x</i> and <i>y</i> may be negative.",alignment:null,parts:[{type:"derivation",options:{eq:"sqrt{x^6y^4}"},label:false}]},{num:83,text:"Simplify the expression, assuming <i>x</i> and <i>y</i> may be negative.",alignment:null,parts:[{type:"derivation",options:{eq:"sqrt[4]{x^8(y-1)^12}"},label:false}]},{num:"85-93",text:"We're not yet supporting these problems. Please see p. 26 in the textbook.",alignment:null,parts:[]},{num:95,text:"Savings account",alignment:null,parts:[{type:"textbox",options:{text:"One of the oldest banks in the United States is the Bank of America, founded in 1812. If $200 had been deposited at that time into an account that paid 4% annual interest, then 180 years later the amount would have grown to 200(1.04)<sup>180</sup> dollars. Approximate this amount to the nearest cent."},label:false}]},{num:"97-99",text:"We're not yet supporting this problem. Please see p. 26 in the textbook.",alignment:null,parts:[]}]},{title:"1.3 Algebraic Expressions",problems:[{num:3,text:"Express as a polynomial.",alignment:null,parts:[{type:"derivation",options:{eq:"(4x^3+5x-3)-(3x^3+2x^2+5x-7)"},label:false}]},{num:9,text:"Express as a polynomial.",alignment:null,parts:[{type:"derivation",options:{eq:"(2u+3)(u-4)+4u(u-2)"},label:false}]},{num:11,text:"Express as a polynomial.",alignment:null,parts:[{type:"derivation",options:{eq:"(3x+5)(2x^2+9x-5)"},label:false}]},{num:13,text:"Express as a polynomial.",alignment:null,parts:[{type:"derivation",options:{eq:"(t^2+2t-5)(3t^2-t+2)"},label:false}]},{num:15,text:"Express as a polynomial.",alignment:null,parts:[{type:"derivation",options:{eq:"(x+1)(2x^2-2)(x^3+5)"},label:false}]},{num:19,text:"Express as a polynomial.",alignment:null,parts:[{type:"derivation",options:{eq:"(3u^3v^4-2u^5v^2+(u^2v^2)^2)/(u^3v^2)"},label:false}]},{num:25,text:"Express as a polynomial.",alignment:null,parts:[{type:"derivation",options:{eq:"(x^2+9)(x^2-4)"},label:false}]},{num:29,text:"Express as a polynomial.",alignment:null,parts:[{type:"derivation",options:{eq:"(x^2-3y^2)^2"},label:false}]},{num:37,text:"Express as a polynomial.",alignment:null,parts:[{type:"derivation",options:{eq:"(x-2y)^3"},label:false}]},{num:39,text:"Express as a polynomial.",alignment:null,parts:[{type:"derivation",options:{eq:"(2x+3y)^3"},label:false}]},{num:43,text:"Express as a polynomial.",alignment:null,parts:[{type:"derivation",options:{eq:"(2x+y-3z)^2"},label:false}]},{num:51,text:"Factor the polynomial.",alignment:null,parts:[{type:"derivation",options:{eq:"15x^3y^5-25x^4y^2+10x^6y^4"},label:false}]},{num:57,text:"Factor the polynomial.",alignment:null,parts:[{type:"derivation",options:{eq:"6x^2+7x-20"},label:false}]},{num:65,text:"Factor the polynomial.",alignment:null,parts:[{type:"derivation",options:{eq:"45x^2+38xy+8y^2"},label:false}]},{num:69,text:"Factor the polynomial.",alignment:null,parts:[{type:"derivation",options:{eq:"z^4-64w^2"},label:false}]},{num:73,text:"Factor the polynomial.",alignment:null,parts:[{type:"derivation",options:{eq:"x^2+25"},label:false}]},{num:77,text:"Factor the polynomial.",alignment:null,parts:[{type:"derivation",options:{eq:"64x^3+27"},label:false}]},{num:79,text:"Factor the polynomial.",alignment:null,parts:[{type:"derivation",options:{eq:"64x^3-y^6"},label:false}]},{num:81,text:"Factor the polynomial.",alignment:null,parts:[{type:"derivation",options:{eq:"343x^3+y^9"},label:false}]},{num:83,text:"Factor the polynomial.",alignment:null,parts:[{type:"derivation",options:{eq:"125-27x^3"},label:false}]},{num:85,text:"Factor the polynomial.",alignment:null,parts:[{type:"derivation",options:{eq:"2ax-6bx+ay-3by"},label:false}]},{num:87,text:"Factor the polynomial.",alignment:null,parts:[{type:"derivation",options:{eq:"3x^3+3x^2-27x-27"},label:false}]},{num:89,text:"Factor the polynomial.",alignment:null,parts:[{type:"derivation",options:{eq:"x^4+2x^3-x-2"},label:false}]},{num:91,text:"Factor the polynomial.",alignment:null,parts:[{type:"derivation",options:{eq:"a^3-a^2b+ab^2-b^3"},label:false}]},{num:93,text:"Factor the polynomial.",alignment:null,parts:[{type:"derivation",options:{eq:"a^6-b^6"},label:false}]},{num:95,text:"Factor the polynomial.",alignment:null,parts:[{type:"derivation",options:{eq:"x^2+4x+4-9y^2"},label:false}]},{num:97,text:"Factor the polynomial.",alignment:null,parts:[{type:"derivation",options:{eq:"y^2-x^2+8y+16"},label:false}]},{num:99,text:"Factor the polynomial.",alignment:null,parts:[{type:"derivation",options:{eq:"y^6+7y^3-8"},label:false}]},{num:101,text:"Factor the polynomial.",alignment:null,parts:[{type:"derivation",options:{eq:"x^16-1"},label:false}]}]},{title:"1.4 Fractional Expressions",problems:[{num:3,text:"Write the expression as a simplified rational number.",alignment:null,parts:[{type:"derivation",options:{eq:"5/24-3/20"},label:false}]},{num:13,text:"Simplify the expression.",alignment:null,parts:[{type:"derivation",options:{eq:"(5a^2+12a+4)/(a^4-16)/(25a^2+20a+4)/(a^2-2a)"},label:false}]},{num:21,text:"Simplify the expression.",alignment:null,parts:[{type:"derivation",options:{eq:"(3t)/(t+2)+(5t)/(t-2)-40/(t^2-4)"},label:false}]},{num:25,text:"Simplify the expression.",alignment:null,parts:[{type:"derivation",options:{eq:"(2x)/(x+2)-8/(x^2+2x)+3/x"},label:false}]},{num:31,text:"Simplify the expression.",alignment:null,parts:[{type:"derivation",options:{eq:"((2x+1)/(x^2+4x+4))-((6x)/(x^2-4))+3/(x-2)"},label:false}]},{num:33,text:"Simplify the expression.",alignment:null,parts:[{type:"derivation",options:{eq:"(b/a-a/b)/(1/a-1/b)"},label:false}]},{num:35,text:"Simplify the expression.",alignment:null,parts:[{type:"derivation",options:{eq:"(x/y^2-y/x^2)/(1/y^2-1/x^2)"},label:false}]},{num:37,text:"Simplify the expression.",alignment:null,parts:[{type:"derivation",options:{eq:"(y^-1+x^-1)/(xy)^-1"},label:false}]},{num:39,text:"Simplify the expression.",alignment:null,parts:[{type:"derivation",options:{eq:"(5/(x+1)+(2x)/(x+3))/(x/(x+1)+7/(x+3))"},label:false}]},{num:41,text:"Simplify the expression.",alignment:null,parts:[{type:"derivation",options:{eq:"(3/(x-1)-3/(a-1))/(x-a)"},label:false}]},{num:43,text:"Simplify the expression.",alignment:null,parts:[{type:"derivation",options:{eq:"((x+h)^2-3(x+h)-(x^2-3x))/h"},label:false}]},{num:45,text:"Simplify the expression.",alignment:null,parts:[{type:"derivation",options:{eq:"(1/(x+h)^3-1/x^3)/h"},label:false}]},{num:47,text:"Simplify the expression.",alignment:null,parts:[{type:"derivation",options:{eq:"(4/(3x+3h-1)-4/(3x-1))/h"},label:false}]},{num:51,text:"Rationalize the denominator.",alignment:null,parts:[{type:"derivation",options:{eq:"(81x^2-16y^2)/(3sqrtx-2sqrty)"},label:false}]},{num:55,text:"Rationalize the numerator.",alignment:null,parts:[{type:"derivation",options:{eq:"(sqrta-sqrtb)/(a^2-b^2)"},label:false}]},{num:57,text:"Rationalize the numerator.",alignment:null,parts:[{type:"derivation",options:{eq:"(sqrt{2(x+h)+1}-sqrt{2x+1})/h"},label:false}]},{num:63,text:"Express as a sum of terms of the form <i>ax<sup>r</sup></i>, where <i>r</i> is a rational number.",alignment:null,parts:[{type:"derivation",options:{eq:"(x^2+2)^2/x^5"},label:false}]},{num:67,text:"Express as a quotient.",alignment:null,parts:[{type:"derivation",options:{eq:"x^(-1/2)-x^(3/2)"},label:false}]},{num:69,text:"Simplify the expression.",alignment:null,parts:[{type:"derivation",options:{eq:"(2x^2-3x+1)(4)(3x+2)^3(3)+(3x+2)^4(4x-3)"},label:false}]},{num:71,text:"Simplify the expression.",alignment:null,parts:[{type:"derivation",options:{eq:"(x^2-4)^(1/2)(3)(2x+1)^2(2)+(2x+1)^3(1/2)(x^2-4)^(-1/2)(2x)"},label:false}]},{num:73,text:"Simplify the expression.",alignment:null,parts:[{type:"derivation",options:{eq:"(3x+1)^6(1/2)(2x-5)^(-1/2)(2)+(2x-5)^(1/2)(6)(3x+1)^5(3)"},label:false}]},{num:75,text:"Simplify the expression.",alignment:null,parts:[{type:"derivation",options:{eq:"((6x+1)^3(27x^2+2)-(9x^3+2x)(3)(6x+1)^2(6))/(6x+1)^6"},label:false}]},{num:77,text:"Simplify the expression.",alignment:null,parts:[{type:"derivation",options:{eq:"((x^2+2)^3(2x)-x^2(3)(x^2+2)^2(2x))/[(x^2+2)^3]^2"},label:false}]},{num:79,text:"Simplify the expression.",alignment:null,parts:[{type:"derivation",options:{eq:"((x^2+4)^(1/3)(3)-(3x)(1/3)(x^2+4)^(-2/3)(2x))/[(x^2+4)^(1/3)]^2"},label:false}]},{num:81,text:"Simplify the expression.",alignment:null,parts:[{type:"derivation",options:{eq:"((4x^2+9)^(1/2)(2)-(2x+3)(1/2)(4x^2+9)^(-1/2)(8x))/[(4x^2+9)^(1/2)]^2"},label:false}]}]}]},{title:"Chapter 2 Equations and Inequalities",subchapters:[{title:"2.1 Equations",problems:[{num:7,text:"Solve the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"1/5x+2=3-2/7x"},label:false}]},{num:9,text:"Solve the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"0.3(3+2x)+1.2x=3.2"},label:false}]},{num:13,text:"Solve the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"(13+2x)/(4x+1)=3/4"},label:false}]},{num:15,text:"Solve the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"8-5/x=2+3/x"},label:false}]},{num:17,text:"Solve the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"(3x-2)^2=(x-5)(9x+4)"},label:false}]},{num:21,text:"Solve the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"(3x+1)/(6x-2)=(2x+5)/(4x-13)"},label:false}]},{num:23,text:"Solve the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"2/5+4/(10x+5)=7/(2x+1)"},label:false}]},{num:27,text:"Solve the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"2-5/(3x-7)=2"},label:false}]},{num:31,text:"Solve the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"7/(y^2-4)-4/(y+2)=5/(y-2)"},label:false}]},{num:33,text:"Solve the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"(x+3)^3-(3x-1)^2=x^3+4"},label:false}]},{num:35,text:"Solve the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"(9x)/(3x-1)=2+3/(3x-1)"},label:false}]},{num:37,text:"Solve the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"1/(x+4)+3/(x-4)=(3x+8)/(x^2-16)"},label:false}]},{num:39,text:"Solve the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"4/(x+2)+1/(x-2)=(5x-6)/(x^2-4)"},label:false}]},{num:41,text:"Solve the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"2/(2x+1)-3/(2x-1)=(-2x+7)/(4x^2-1)"},label:false}]},{num:43,text:"Solve the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"5/(2x+3)+4/(2x-3)=(14x+3)/(4x^2-9)"},label:false}]},{num:51,text:"For what value of <i>c</i> is the number <i>a</i> a solution of the equation?",alignment:null,parts:[{type:"derivation",options:{eq:"4x+1+2c=5c-3x+6"},label:false},{type:"derivation",options:{eq:"a=-2"},label:false}]},{num:55,text:"Determine values for <i>a</i> and <i>b</i> such that <sup>5</sup>&frasl;<sub>3</sub> is a solution of the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"ax+b=0"},label:false}]},{num:57,text:"Determine which equation is not equivalent to the equation preceding it.",alignment:null,parts:[{type:"derivation",options:{eq:"x^2-x-2=x^2-4"},label:false},{type:"derivation",options:{eq:"(x+1)(x-2)=(x+2)(x-2)"},label:false},{type:"derivation",options:{eq:"x+1=x+2"},label:false},{type:"derivation",options:{eq:"1=2"},label:false}]},{num:59,text:"Solve the formula for the specified variable.",alignment:"row",parts:[{type:"derivation",options:{eq:"EK+L=D-TK"},label:false},{type:"textbox",options:{text:"for <i>K</i>"},label:false}]},{num:61,text:"Solve the formula for the specified variable.",alignment:"row",parts:[{type:"derivation",options:{eq:"M=(Q+1)/Q"},label:false},{type:"textbox",options:{text:"for <i>Q</i>"},label:false}]},{num:67,text:"The formula occurs in the indicated application. Solve for the specified variable.",alignment:"row",parts:[{type:"derivation",options:{eq:"F=g(mM)/d^2"},label:false},{type:"textbox",options:{text:"for <i>m</i> (Newton's law of gravitation)"},label:false}]},{num:69,text:"The formula occurs in the indicated application. Solve for the specified variable.",alignment:"row",parts:[{type:"derivation",options:{eq:"P=2l+2w"},label:false},{type:"textbox",options:{text:"for <i>w</i> (perimeter of a rectangle)"},label:false}]},{num:71,text:"The formula occurs in the indicated application. Solve for the specified variable.",alignment:"row",parts:[{type:"derivation",options:{eq:"A=1/2(b_1+b_2)h"},label:false},{type:"textbox",options:{text:"for <i>b</i><sub>1</sub> (area of a trapezoid)"},label:false}]},{num:73,text:"The formula occurs in the indicated application. Solve for the specified variable.",alignment:"row",parts:[{type:"derivation",options:{eq:"S=p/(q+p(1-q))"},label:false},{type:"textbox",options:{text:"for <i>q</i> (Amdahl's law for supercomputers)"},label:false}]},{num:75,text:"The formula occurs in the indicated application. Solve for the specified variable.",alignment:"row",parts:[{type:"derivation",options:{eq:"1/f=1/p+1/q"},label:false},{type:"textbox",options:{text:"for <i>q</i> (lens equation)"},label:false}]}]},{title:"2.2 Applied Problems",problems:[{num:1,text:"Test scores",alignment:null,parts:[{type:"textbox",options:{text:"A student in an algebra course has test scores of 75, 82, 71, and 84. What score on the next test will raise the student's average to 80?"},label:false}]},{num:2,text:"Final class average",alignment:null,parts:[{type:"textbox",options:{text:"Before the final exam, a student has test scores of 72, 80, 65, 78, and 60. If the final exam counts as one-third of the final grade, what score must the student receive in order to have a final average of 76?"},label:false}]},{num:3,text:"Gross pay",alignment:null,parts:[{type:"textbox",options:{text:"A worker’s take-home pay is $492, after deductions totaling 40% of the gross pay have been subtracted. What is the gross pay?"},label:false}]},{num:4,text:"Cost of dining out",alignment:null,parts:[{type:"textbox",options:{text:"A couple does not wish to spend more than $70 for dinner at a restaurant. If a sales tax of 6% is added to the bill and they plan to tip 15% after the tax has been added, what is the most they can spend for the meal?"},label:false}]},{num:5,text:"Intelligence quotient",alignment:"column",parts:[{type:"textbox",options:{text:"A person's intelligence quotient (IQ) is determined by multiplying the quotient of his or her mental age and chonological age by 100."},label:false},{type:"textbox",options:{text:"Find the IQ of a 12-year-old child whose mental age is 15."},label:true},{type:"textbox",options:{text:"Find the mental age of a person 15 years old whose IQ is 140."},label:true}]},{num:7,text:"Cost of insulation",alignment:null,parts:[{type:"textbox",options:{text:"The cost of installing insulation in a particular two-bedroom home is $2400. Present monthly heating costs average $200, but the insulation is expected to reduce heating costs by 10%. How many months will it take to recover the cost of the insulation?"},label:false}]},{num:9,text:"Savings accounts",alignment:null,parts:[{type:"textbox",options:{text:"An algebra student has won $100,000 in a lottery and wishes to deposit it in savings accounts in two financial institutions. One account pays 8% simple interest, but deposits are insured only to $50,000. The second account pays 6.4% simple interest, and deposits are insured up to $100,000. Determine whether the money can be deposited so that it is fully insured and earns annual interest of $7500."},label:false}]},{num:11,text:"Movie attendance",alignment:null,parts:[{type:"textbox",options:{text:"Six hundred people attended the premiere of a motion picture. Adult tickets cost $9, and children were admitted for $6. If box office receipts totaled $4800, how many children attended the premiere?"},label:false}]},{num:13,text:"Preparing a glucose solution",alignment:null,parts:[{type:"textbox",options:{text:"In a certain medical test designed to measure carbohydrate tolerance, an adult drinks 7 ounces of a 30% glucose solution. When the test is administered to a child, the glucose concentration must be decreased to 20%. How much 30% glucose solution and how much water should be used to prepare 7 ounces of 20% glucose solution?"},label:false}]},{num:15,text:"Preparing an alloy",alignment:null,parts:[{type:"textbox",options:{text:"British sterling silver is a copper-silver alloy that is 7.5% copper by weight. How many grams of pure copper and how many grams of British sterling silver should be used to prepare 200 grams of a copper-silver alloy that is 10% copper by weight?"},label:false}]},{num:17,text:"Walking rates",alignment:"column",parts:[{type:"textbox",options:{text:"Two children, who are 224 meters apart, start walking toward each other at the same instant at rates of 1.5 m/sec and 2 m/sec, respectively (see the figure on p. 71)."},label:false},{type:"textbox",options:{text:"When will they meet?"},label:true},{type:"textbox",options:{text:"How far will each have walked?"},label:true}]},{num:19,text:"Snowplow speed",alignment:null,parts:[{type:"textbox",options:{text:"At 6 A.M. a snowplow, traveling at a constant speed, begins to clear a highway leading out of town. At 8 A.M. an automobile begins traveling the highway at a speed of 30 and reaches the plow 30 minutes later. Find the speed of the snowplow."},label:false}]},{num:21,text:"Rowing rate",alignment:"column",parts:[{type:"textbox",options:{text:"A boy can row a boat at a constant rate of 5 mi/hr in still water, as indicated in the figure (p. 71). He rows upstream for 15 minutes and then rows downstream, returning to his starting point in another 12 minutes."},label:false},{type:"textbox",options:{text:"Find the rate of the current."},label:true},{type:"textbox",options:{text:"Find the total distance traveled."},label:true}]},{num:23,text:"Distance to a target",alignment:null,parts:[{type:"textbox",options:{text:"A bullet is fired horizontally at a target, and the sound of its impact is heard 1.5 seconds later. If the speed of the bullet is 3300 ft/sec and the speed of sound is 1100 ft/sec, how far away is the target?"},label:false}]},{num:25,text:"Fencing a region",alignment:null,parts:[{type:"textbox",options:{text:"A farmer plans to use 180 feet of fencing to enclose a rectangular region, using part of a straight river bank instead of fencing as one side of the rectangle, as shown in the figure on the next page (p. 72). Find the area of the region if the length of the side parallel to the river bank is"},label:false},{type:"textbox",options:{text:"twice the length of an adjacent side."},label:true},{type:"textbox",options:{text:"one-half the length of an adjacent side."},label:true},{type:"textbox",options:{text:"the same as the length of an adjacent side."},label:true}]},{num:29,text:"Constructing a silo",alignment:null,parts:[{type:"textbox",options:{text:"A large grain silo is to be constructed in the shape of a circular cylinder with a hemisphere attached to the top (see the figure on p. 72). The diameter of the silo is to be 30 feet, but the height is yet to be determined. Find the height <i>h</i> of the silo that will result in a capacity of 11,250<i>π</i> ft<sup>3</i>."},label:false}]},{num:31,text:"Lawn mowing rates",alignment:null,parts:[{type:"textbox",options:{text:"It takes a boy 90 minutes to mow the lawn, but his sister can mow it in 60 minutes. How long would it take them to mow the lawn if they worked together, using two lawn mowers?"},label:false}]},{num:33,text:"Delivering newspapers",alignment:null,parts:[{type:"textbox",options:{text:"It takes a girl 45 minutes to deliver the newspapers on her route; however, if her brother helps, it takes them only 20 minutes. How long would it take her brother to deliver the newspapers by himself?"},label:false}]},{num:35,text:"Grade point average (GPA)",alignment:null,parts:[{type:"textbox",options:{text:"A college student has finished 48 credit hours with a GPA of 2.75. To get into the program she wishes to enter, she must have a GPA of 3.2. How many additional credit hours of 4.0 work will raise her GPA to 3.2?"},label:false}]},{num:37,text:"Air temperature",alignment:"column",parts:[{type:"textbox",options:{text:"Below the cloud base, the air temperature <i>T</i> (in °F) at height <i>h</i> (in feet) can be approximated by the equation <i>T</i> = <i>T</i><sub>0</sub> - (<sup>5.5</sup>&frasl;<sub>1000</sub>)<i>h</i>, where <i>T</i><sub>0</sub> is the temperature at ground level."},label:false},{type:"textbox",options:{text:"Determine the air temperature at a height of 1 mile if the ground temperature is 70°F."},label:true},{type:"textbox",options:{text:"At what altitude is the temperature freezing?"},label:true}]},{num:39,text:"A cloud's temperature",alignment:null,parts:[{type:"textbox",options:{text:"The temperature <i>T</i> within a cloud at height <i>h</i> (in feet) above the cloud base can be approximated using the equation <i>T</i> = <i>B</i> - (<sup>3</sup>&frasl;<sub>1000</sub>)<i>h</i>, where <i>B</i> is the temperature of the cloud at its base. Determine the temperature at 10,000 feet in a cloud with a base temperature of 55°F and a base height of 4000 feet. <b>Note:</b> For an interesting application involving the three preceding exercises, see Exercise 6 in the Discussion Exercises at the end of the chapter."},label:false}]}]},{title:"2.3 Quadratic Equations",problems:[{num:9,text:"Solve the equation by factoring.",alignment:null,parts:[{type:"derivation",options:{eq:"12x^2+60x+75=0"},label:false}]},{num:13,text:"Solve the equation by factoring.",alignment:null,parts:[{type:"derivation",options:{eq:"(5x)/(x-3)+4/(x+3)=90/(x^2-9)"},label:false}]},{num:15,text:"Determine whether the two equations are equivalent.",alignment:"row",parts:[{type:"derivation",options:{eq:"x^2=16"},label:true},{type:"derivation",options:{eq:"x=4"},label:false},{type:"derivation",options:{eq:"x=sqrt9"},label:true},{type:"derivation",options:{eq:"x=3"},label:false}]},{num:21,text:"Solve the equation by using the special quadratic equation on page 75.",alignment:null,parts:[{type:"derivation",options:{eq:"(x-3)^2=17"},label:false}]},{num:23,text:"Solve the equation by using the special quadratic equation on page 75.",alignment:null,parts:[{type:"derivation",options:{eq:"4(x+2)^2=11"},label:false}]},{num:25,text:"Determine the value or values of <i>d</i> that complete the square for the expression.",alignment:"column",parts:[{type:"derivation",options:{eq:"x^2+9x+d"},label:true},{type:"derivation",options:{eq:"x^2-8x+d"},label:true},{type:"derivation",options:{eq:"x^2+dx+36"},label:true},{type:"derivation",options:{eq:"x^2+dx+49/4"},label:true}]},{num:29,text:"Solve by completing the square. (<i>Note:</i> See the discussion after Example 5 for help in solving Exercises 29 and 30.)",alignment:null,parts:[{type:"derivation",options:{eq:"4x^2-12x-11=0"},label:false}]},{num:37,text:"Solve by using the quadratic formula.",alignment:null,parts:[{type:"derivation",options:{eq:"3/2z^2-4z-1=0"},label:false}]},{num:39,text:"Solve by using the quadratic formula.",alignment:null,parts:[{type:"derivation",options:{eq:"5/(w^2)-10/w+2=0"},label:false}]},{num:41,text:"Solve by using the quadratic formula.",alignment:null,parts:[{type:"derivation",options:{eq:"4x^2+81=36x"},label:false}]},{num:43,text:"Solve by using the quadratic formula.",alignment:null,parts:[{type:"derivation",options:{eq:"(5x)/(x^2+9)=-1"},label:false}]},{num:45,text:"Use the quadratic formula to factor the expressions.",alignment:null,parts:[{type:"derivation",options:{eq:"x^2+x-30"},label:false}]},{num:47,text:"Use the quadratic formula to factor the expressions.",alignment:null,parts:[{type:"derivation",options:{eq:"12x^2-16x-3"},label:false}]},{num:49,text:"Use the quadratic formula to solve the equation for (a) <i>x</i> in terms of <i>y</i> and (b) <i>y</i> in terms of <i>x</i>.",alignment:null,parts:[{type:"derivation",options:{eq:"4x^2-4xy+1-y^2=0"},label:false}]},{num:51,text:"Solve for the specified variable.",alignment:"row",parts:[{type:"derivation",options:{eq:"K=1/2mv^2"},label:false},{type:"textbox",options:{text:"for <i>v</i> (kinetic energy)"},label:false}]},{num:53,text:"Solve for the specified variable.",alignment:"row",parts:[{type:"derivation",options:{eq:"A=2πr(r+h)"},label:false},{type:"textbox",options:{text:"for <i>r</i> (surface area of a closed cylinder)"},label:false}]},{num:59,text:"Baseball toss",alignment:null,parts:[{type:"textbox",options:{text:"A baseball is thrown straight upward with an initial speed of 64 ft/sec. The number of feet <i>s</i> above the ground after <i>t</i> seconds is given by the equation <i>s</i> = -16<i>t</i><sup>2</sup> + 64<i>t</i>."},label:false},{type:"textbox",options:{text:"When will the baseball be 48 feet above the ground?"},label:true},{type:"textbox",options:{text:"When will it hit the ground?"},label:true}]},{num:60,text:"Breaking distance",alignment:"column",parts:[{type:"textbox",options:{text:"The distance that a car travels between the time the driver makes the decision to hit the brakes and the time the car actually stops is called the braking distance. For a certain car traveling <i>v</i> mi/hr, the braking distance <i>d</i> (in feet) is given by <i>d</i> = <i>v</i> + (<i>v</i><sup>2</sup>/20)."},label:false},{type:"textbox",options:{text:"Find the braking distance when <i>v</i> is 55 mi/hr."},label:true},{type:"textbox",options:{text:"If a driver decides to brake 120 feet from a stop sign, how fast can the car be going and still stop by the time it reaches the sign?"},label:true}]},{num:65,text:"Fencing a garden",alignment:null,parts:[{type:"textbox",options:{text:"A square vegetable garden is to be tilled and then enclosed with a fence. If the fence costs $1 per foot and the cost of preparing the soil is $0.50 per ft<sup>2</sup>, determine the size of the garden that can be enclosed for $120."},label:false}]},{num:66,text:"Fencing a region",alignment:null,parts:[{type:"textbox",options:{text:"A farmer plans to enclose a rectangular region, using part of his barn for one side and fencing for the other three sides. If the side parallel to the barn is to be twice the length of an adjacent side, and the area of the region is to be 128 ft<sup>2</sup>, how many feet of fencing should be purchased?"},label:false}]},{num:69,text:"Distance between airplanes",alignment:"column",parts:[{type:"textbox",options:{text:"An airplane flying north at 200 mi/hr passed over a point on the ground at 2:00 P.M. Another airplane at the same altitude passed over the point at 2:30 P.M., flying east at 400 mi/hr (see the figure on p. 86)."},label:false},{type:"textbox",options:{text:"If <i>t</i> denotes the time in hours after 2:30 P.M., express the distance <i>d</i> between the airplanes in terms of <i>t</i>."},label:true},{type:"textbox",options:{text:"At what time after 2:30 P.M. were the airplanes 500 miles apart?"},label:true}]},{num:70,text:"Two-way radio range",alignment:null,parts:[{type:"textbox",options:{text:"Two surveyors with two-way radios leave the same point at 9:00 A.M., one walking due south at 4 mi/hr and the other due west at 3 mi/hr. How long can they communicate with one another if each radio has a maximum range of 2 miles?"},label:false}]},{num:71,text:"Constructing a pizza box",alignment:null,parts:[{type:"textbox",options:{text:"A pizza box with a square base is to be made from a rectangular sheet of cardboard by cutting six 1-inch squares from the corners and the middle sections and folding up the sides (see the figure on p. 86). If the area of the base is to be 144 in<sup>2</sup>, what size piece of cardboard should be used?"},label:false}]}]},{title:"2.4 Complex Numbers",problems:[{num:3,text:"Write the expression in the form <i>a</i> + <i>bi</i>, where <i>a</i> and <i>b</i> are real numbers.",alignment:null,parts:[{type:"derivation",options:{eq:"(7-6i)-(-11-3i)"},label:false}]},{num:7,text:"Write the expression in the form <i>a</i> + <i>bi</i>, where <i>a</i> and <i>b</i> are real numbers.",alignment:null,parts:[{type:"derivation",options:{eq:"(1-3i)(2+5i)"},label:false}]},{num:9,text:"Write the expression in the form <i>a</i> + <i>bi</i>, where <i>a</i> and <i>b</i> are real numbers.",alignment:null,parts:[{
type:"derivation",options:{eq:"(5-2i)^2"},label:false}]},{num:17,text:"Write the expression in the form <i>a</i> + <i>bi</i>, where <i>a</i> and <i>b</i> are real numbers.",alignment:"row",parts:[{type:"derivation",options:{eq:"i^73"},label:true},{type:"derivation",options:{eq:"i^-46"},label:true},{type:"derivation",options:{eq:"i^66"},label:true},{type:"derivation",options:{eq:"i^-55"},label:true}]},{num:19,text:"Write the expression in the form <i>a</i> + <i>bi</i>, where <i>a</i> and <i>b</i> are real numbers.",alignment:null,parts:[{type:"derivation",options:{eq:"3/(2+4i)"},label:false}]},{num:21,text:"Write the expression in the form <i>a</i> + <i>bi</i>, where <i>a</i> and <i>b</i> are real numbers.",alignment:null,parts:[{type:"derivation",options:{eq:"(1-7i)/(6-2i)"},label:false}]},{num:23,text:"Write the expression in the form <i>a</i> + <i>bi</i>, where <i>a</i> and <i>b</i> are real numbers.",alignment:null,parts:[{type:"derivation",options:{eq:"(-4+6i)/(2+7i)"},label:false}]},{num:25,text:"Write the expression in the form <i>a</i> + <i>bi</i>, where <i>a</i> and <i>b</i> are real numbers.",alignment:null,parts:[{type:"derivation",options:{eq:"(4-2i)/(-5i)"},label:false}]},{num:27,text:"Write the expression in the form <i>a</i> + <i>bi</i>, where <i>a</i> and <i>b</i> are real numbers.",alignment:null,parts:[{type:"derivation",options:{eq:"(2+5i)^3"},label:false}]},{num:29,text:"Write the expression in the form <i>a</i> + <i>bi</i>, where <i>a</i> and <i>b</i> are real numbers.",alignment:null,parts:[{type:"derivation",options:{eq:"(2-sqrt-4)(3-sqrt-16)"},label:false}]},{num:31,text:"Write the expression in the form <i>a</i> + <i>bi</i>, where <i>a</i> and <i>b</i> are real numbers.",alignment:null,parts:[{type:"derivation",options:{eq:"(4+sqrt-81)/(7-sqrt-64)"},label:false}]},{num:35,text:"Find the values of <i>x</i> and <i>y</i>, where <i>x</i> and <i>y</i> are real numbers.",alignment:null,parts:[{type:"derivation",options:{eq:"4+(x+2y)i=x+2i"},label:false}]},{num:37,text:"Find the values of <i>x</i> and <i>y</i>, where <i>x</i> and <i>y</i> are real numbers.",alignment:null,parts:[{type:"derivation",options:{eq:"(2x-y)-16i=10+4yi"},label:false}]},{num:39,text:"Find the solutions of the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"x^2-6x+13=0"},label:false}]},{num:41,text:"Find the solutions of the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"x^2+4x+13=0"},label:false}]},{num:43,text:"Find the solutions of the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"x^2-5x+20=0"},label:false}]},{num:45,text:"Find the solutions of the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"4x^2+x+3=0"},label:false}]},{num:47,text:"Find the solutions of the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"x^3+125=0"},label:false}]},{num:48,text:"Find the solutions of the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"x^3-27=0"},label:false}]},{num:49,text:"Find the solutions of the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"27x^3=(x+5)^3"},label:false}]},{num:50,text:"Find the solutions of the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"16x^4=(x-4)^4"},label:false}]},{num:51,text:"Find the solutions of the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"x^4=256"},label:false}]},{num:53,text:"Find the solutions of the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"4x^4+25x^2+36=0"},label:false}]},{num:54,text:"Find the solutions of the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"27x^4+21x^2+4=0"},label:false}]},{num:55,text:"Find the solutions of the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"x^3+3x^2+4x=0"},label:false}]},{num:57,text:"This problem is currently unavailable. Please see p. 94 in the textbook.",alignment:null,parts:[]}]},{title:"2.5 Other Types of Equations",problems:[{num:3,text:"Solve the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"|3x-2|+3=7"},label:false}]},{num:5,text:"Solve the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"3*|x+1|-2=-11"},label:false}]},{num:8,text:"Solve the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"3x^3-4x^2-27x+36=0"},label:false}]},{num:9,text:"Solve the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"4x^4+10x^3=6x^2+15x"},label:false}]},{num:11,text:"Solve the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"y^(3/2)=5y"},label:false}]},{num:17,text:"Solve the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"sqrt[5]{2x^2+1}-2=0"},label:false}]},{num:19,text:"Solve the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"sqrt{7-x}=x-5"},label:false}]},{num:21,text:"Solve the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"3sqrt{2x-3}+2sqrt{7-x}=11"},label:false}]},{num:23,text:"Solve the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"x=4+sqrt{4x-19}"},label:false}]},{num:25,text:"Solve the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"x+sqrt{5x+19}=-1"},label:false}]},{num:27,text:"Solve the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"sqrt{7-2x}-sqrt{5+x}=sqrt{4+3x}"},label:false}]},{num:29,text:"Solve the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"sqrt{11+8x}+1=sqrt{9+4x}"},label:false}]},{num:33,text:"Solve the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"sqrt{1+4sqrtx}=sqrtx+1"},label:false}]},{num:37,text:"Solve the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"5y^4-7y^2+1=0"},label:false}]},{num:39,text:"Solve the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"36x^-4-13x^-2+1=0"},label:false}]},{num:41,text:"Solve the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"3x^(2/3)+4x^(1/3)-4=0"},label:false}]},{num:43,text:"Solve the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"6w+7w^(1/2)-20=0"},label:false}]},{num:44,text:"Solve the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"8t-22t^(1/2)-21=0"},label:false}]},{num:45,text:"Solve the equation.",alignment:null,parts:[{type:"derivation",options:{eq:"2x^(-2/3)-7x^(-1/3)-15=0"},label:false}]},{num:49,text:"Solve the equation.",alignment:"row",parts:[{type:"derivation",options:{eq:"sqrt[3]{x}=2sqrt[4]{x}"},label:false},{type:"textbox",options:{text:"(<i>Hint:</i> Raise both sides to the least common multiple of 3 and 4.)"},label:false}]},{num:51,text:"Find the real solutions of the equation.",alignment:"column",parts:[{type:"derivation",options:{eq:"x^(5/3)=32"},label:true},{type:"derivation",options:{eq:"x^(4/3)=16"},label:true},{type:"derivation",options:{eq:"x^(2/3)=-36"},label:true},{type:"derivation",options:{eq:"x^(3/4)=125"},label:true},{type:"derivation",options:{eq:"x^(3/2)=-27"},label:true}]},{num:53,text:"Solve for the specified variable.",alignment:"row",parts:[{type:"derivation",options:{eq:"T=2πsqrt{l/g}"},label:false},{type:"textbox",options:{text:"for <i>l</i> (period of a pendulum)"},label:false}]},{num:55,text:"Solve for the specified variable.",alignment:"row",parts:[{type:"derivation",options:{eq:"S=πrsqrt{r^2+h^2}"},label:false},{type:"textbox",options:{text:"for <i>h</i> (surface area of a cone)"},label:false}]},{num:57,text:"Ladder height",alignment:null,parts:[{type:"textbox",options:{text:"The recommended distance <i>d</i> that a ladder should be placed away from a vertical wall is 25% of its length <i>L</i>. Approximate the height <i>h</i> that can be reached by relating <i>h</i> as a percentage of <i>L</i> (see figure on p. 101)."},label:false}]},{num:59,text:"Windmill power",alignment:null,parts:[{type:"textbox",options:{text:"The power <i>P</i> (in watts) generated by a windmill that has efficiency <i>E</i> is given by the formula <i>P</i> = 0.31<i>ED</i><sup>2</sup><i>V</i><sup>3</sup>, where <i>D</i> is the diameter (in feet) of the windmill blades and <i>V</i> is the wind velocity (in ft/sec). Approximate the wind velocity necessary to generate 10,000 watts if <i>E</i> = 42% and <i>D</i> = 10."},label:false}]},{num:61,text:"The effect of price on demand",alignment:null,parts:[{type:"textbox",options:{text:"The demand for a commodity usually depends on its price. If other factors do not affect the demand, then the quantity <i>Q</i> purchased at price <i>P</i> (in cents) is given by <i>Q</i> = <i>kP</i><sup>-<i>c</i></sup>, where <i>k</i> and <i>c</i> are positive constants. If <i>k</i> = 10<sup>5</sup> and <i>c</i> = <sup>1</sup>&frasl;<sub>2</sub>, find the price that will result in the purchase of 5000 items."},label:false}]},{num:62,text:"The urban heat island",alignment:null,parts:[{type:"textbox",options:{text:"Urban areas have higher average air temperatures than rural areas, as a result of the presence of buildings, asphalt, and concrete. This phenomenon has become known as the <i>urban heat island</i>. The temperature difference <i>T</i> (in °C) between urban and rural areas near Montreal, with a population <i>P</i> between 1000 and 1,000,000, can be described the by the formula <i>T</i> = 0.25<i>P</i><sup><sup>1</sup>&frasl;<sub>4</sub></sup>/√<i>v</i>, where <i>v</i> is the average wind speed (in mi/hr) and <i>v</i> ≥ 1. If <i>T</i> = 3 and <i>v</i> = 5, find <i>P</i>."},label:false}]},{num:67,text:"Installing a power line",alignment:null,parts:[{type:"textbox",options:{text:"A power line is to be installed across a river that is 1 mile wide to a town that is 5 miles downstream (see the figure on p. 102). It costs $7500 per mile to lay the cable underwater and $6000 per mile to lay it overland. Determine how the cable should be installed if $35,000 has been allocated for this project."},label:false}]}]},{title:"2.6 Inequalities",problems:[{num:3,text:"Express the inequality as an interval, and sketch its graph.",alignment:null,parts:[{type:"derivation",options:{eq:"x<-2"},label:false}]},{num:5,text:"Express the inequality as an interval, and sketch its graph.",alignment:null,parts:[{type:"derivation",options:{eq:"x≥4"},label:false}]},{num:"7-19",text:"We're not yet supporting these problems. Please see pp. 109 and 110 in the textbook.",alignment:null,parts:[]},{num:27,text:"Solve the inequality, and express the solutions in terms of intervals whenever possible.",alignment:null,parts:[{type:"derivation",options:{eq:"9+1/3x≥4-1/2x"},label:false}]},{num:"31-35",text:"We're not yet supporting these problems. Please see p. 110 in the textbook.",alignment:null,parts:[]},{num:39,text:"Solve the inequality, and express the solutions in terms of intervals whenever possible.",alignment:null,parts:[{type:"derivation",options:{eq:"(x-4)^2>x(x+12)"},label:false}]},{num:41,text:"Solve the inequality, and express the solutions in terms of intervals whenever possible.",alignment:null,parts:[{type:"derivation",options:{eq:"4/(3x+2)≥0"},label:false}]},{num:43,text:"Solve the inequality, and express the solutions in terms of intervals whenever possible.",alignment:null,parts:[{type:"derivation",options:{eq:"-2/(4-3x)>0"},label:false}]},{num:45,text:"Solve the inequality, and express the solutions in terms of intervals whenever possible.",alignment:null,parts:[{type:"derivation",options:{eq:"2/((1-x)^2)>0"},label:false}]},{num:47,text:"Solve the inequality, and express the solutions in terms of intervals whenever possible.",alignment:null,parts:[{type:"derivation",options:{eq:"|x|<3"},label:false}]},{num:49,text:"Solve the inequality, and express the solutions in terms of intervals whenever possible.",alignment:null,parts:[{type:"derivation",options:{eq:"|x|≥5"},label:false}]},{num:53,text:"Solve the inequality, and express the solutions in terms of intervals whenever possible.",alignment:null,parts:[{type:"derivation",options:{eq:"|x+2|+0.1≥0.2"},label:false}]},{num:57,text:"Solve the inequality, and express the solutions in terms of intervals whenever possible.",alignment:null,parts:[{type:"derivation",options:{eq:"-1/3*|6-5x|+2≥1"},label:false}]},{num:59,text:"Solve the inequality, and express the solutions in terms of intervals whenever possible.",alignment:null,parts:[{type:"derivation",options:{eq:"|7x+2|>-2"},label:false}]},{num:63,text:"Solve the inequality, and express the solutions in terms of intervals whenever possible.",alignment:null,parts:[{type:"derivation",options:{eq:"|(2-3x)/5|≥2"},label:false}]},{num:65,text:"Solve the inequality, and express the solutions in terms of intervals whenever possible.",alignment:null,parts:[{type:"derivation",options:{eq:"3/|5-2x|<2"},label:false}]},{num:"67-77",text:"We're not yet supporting these problems. Please see p. 110 in the textbook.",alignment:null,parts:[]},{num:80,text:"Electrical resistance",alignment:null,parts:[{type:"textbox",options:{text:"If two resistors <i>R</i><sub>1</sub> and <i>R</i><sub>2</sub> are connected in parallel in an electrical circuit, the net resistance <i>R</i> is given by<p style='text-align:center; margin: 10px;'><sup>1</sup>&frasl;<sub><i>R</i></sub> = <sup>1</sup>&frasl;<sub><i>R</i><sub>1</sub></sub> + <sup>1</sup>&frasl;<sub><i>R</i><sub>2</sub></sub>.</p>If <i>R</i><sub>1</sub> = 10 ohms, what values of <i>R</i><sub>2</sub> will result in a net resistance of less than 5 ohms?"},label:false}]},{num:85,text:"Decreasing height",alignment:"column",parts:[{type:"textbox",options:{text:"A person's height will typically decrease by 0.024 inch each year after age 30."},label:false},{type:"textbox",options:{text:"If a woman was 5 feet 9 inches tall at age 30, predict her height at age 70."},label:true},{type:"textbox",options:{text:"A 50-year-old man is 5 feet 6 inches tall. Determine an inequality for the range of heights (in inches) that this man will experience between the ages of 30 and 70."},label:true}]}]},{title:"2.7 More on Inequalities",problems:[{num:7,text:"Solve the inequality, and express the solutions in terms of intervals whenever possible.",alignment:null,parts:[{type:"derivation",options:{eq:"x^2-2x-5>3"},label:false}]},{num:9,text:"Solve the inequality, and express the solutions in terms of intervals whenever possible.",alignment:null,parts:[{type:"derivation",options:{eq:"x(2x+3)≥5"},label:false}]},{num:11,text:"Solve the inequality, and express the solutions in terms of intervals whenever possible.",alignment:null,parts:[{type:"derivation",options:{eq:"6x-8>x^2"},label:false}]},{num:17,text:"Solve the inequality, and express the solutions in terms of intervals whenever possible.",alignment:null,parts:[{type:"derivation",options:{eq:"16x^2≥9x"},label:false}]},{num:19,text:"Solve the inequality, and express the solutions in terms of intervals whenever possible.",alignment:null,parts:[{type:"derivation",options:{eq:"x^4+5x^2≥36"},label:false}]},{num:21,text:"Solve the inequality, and express the solutions in terms of intervals whenever possible.",alignment:null,parts:[{type:"derivation",options:{eq:"x^3+2x^2-4x-8≥0"},label:false}]},{num:23,text:"Solve the inequality, and express the solutions in terms of intervals whenever possible.",alignment:null,parts:[{type:"derivation",options:{eq:"(x^2(x+2))/((x+2)(x+1))≤0"},label:false}]},{num:25,text:"Solve the inequality, and express the solutions in terms of intervals whenever possible.",alignment:null,parts:[{type:"derivation",options:{eq:"(x^2-x)/(x^2+2x)≤0"},label:false}]},{num:27,text:"Solve the inequality, and express the solutions in terms of intervals whenever possible.",alignment:null,parts:[{type:"derivation",options:{eq:"(x-2)/(x^2-3x-10)≥0"},label:false}]},{num:29,text:"Solve the inequality, and express the solutions in terms of intervals whenever possible.",alignment:null,parts:[{type:"derivation",options:{eq:"(-3x)/(x^2-9)>0"},label:false}]},{num:31,text:"Solve the inequality, and express the solutions in terms of intervals whenever possible.",alignment:null,parts:[{type:"derivation",options:{eq:"(x+1)/(2x-3)>2"},label:false}]},{num:33,text:"Solve the inequality, and express the solutions in terms of intervals whenever possible.",alignment:null,parts:[{type:"derivation",options:{eq:"1/(x-2)≥3/(x+1)"},label:false}]},{num:35,text:"Solve the inequality, and express the solutions in terms of intervals whenever possible.",alignment:null,parts:[{type:"derivation",options:{eq:"4/(3x-2)≤2/(x+1)"},label:false}]},{num:37,text:"Solve the inequality, and express the solutions in terms of intervals whenever possible.",alignment:null,parts:[{type:"derivation",options:{eq:"x/(3x-5)≤2/(x-1)"},label:false}]},{num:39,text:"Solve the inequality, and express the solutions in terms of intervals whenever possible.",alignment:null,parts:[{type:"derivation",options:{eq:"x^3>x"},label:false}]},{num:41,text:"As a particle moves along a straight path, its speed <i>v</i> (in cm/sec) at time <i>t</i> (in seconds) is given by the equation. For what subintervals of the given time interval [<i>a</i>, <i>b</i>] will its speed be at least <i>k</i> cm/sec?",alignment:"row",parts:[{type:"derivation",options:{eq:"v=t^3-3t^2-4t+20"},label:false},{type:"derivation",options:{eq:"[0,5]"},label:false},{type:"derivation",options:{eq:"k=8"},label:false}]},{num:43,text:"Vertical leap record",alignment:null,parts:[{type:"textbox",options:{text:"<i>Guinness Book of World Records</i> reports that German shepherds can make vertical leaps of over 10 feet when scaling walls. If the distance <i>s</i> (in feet) off the ground after <i>t</i> seconds is given by the equation <i>s</i> = -16<i>t</i><sup>2</sup> + 24<i>t</i> + 1, for how many seconds is the dog more than 9 feet off the ground?"},label:false}]},{num:44,text:"Height of a projected object",alignment:null,parts:[{type:"textbox",options:{text:"If an object is projected vertically upward from ground level with an initial velocity of 320 ft/sec, then its distance <i>s</i> above the ground after <i>t</i> seconds is given by <i>s</i> = -16<i>t</i><sup>2</sup> + 320<i>t</i>. For what values of <i>t</i> will the object be more than 1536 feet above the ground?"},label:false}]},{num:45,text:"Braking distance",alignment:null,parts:[{type:"textbox",options:{text:"The braking distance <i>d</i> (in feet) of a certain car traveling <i>v</i> mi/hr is given by the equation <i>d</i> = <i>v</i> + (<i>v</i><sup>2</sup>/20). Determine the velocities that result in braking distances of less than 75 feet."},label:false}]},{num:49,text:"Weight in space",alignment:null,parts:[{type:"textbox",options:{text:"After an astronaut is launched into space, the astronaut's weight decreases until a state of weightlessness is achieved. The weight of a 125-pound astronaut at an altitude of <i>x</i> kilometers above sea level is given by<p style='text-align:center; margin: 10px;'><i>W</i> = 125(<sup>6400</sup>&frasl;<sub>6400 + <i>x</i></sub>)<sup>2</sup>.</p>At what altitudes is the astronaut's weight less than 5 pounds?"},label:false}]},{num:51,text:"Aircraft's landing speed",alignment:null,parts:[{type:"textbox",options:{text:"In the design of certain small turbo-prop aircraft, the landing speed <i>V</i> (in ft/sec) is determined by the formula <i>W</i> = 0.00334<i>V</i><sup>2</sup><i>S</i>, where <i>W</i> is the gross weight (in pounds) of the aircraft and <i>S</i> is the surface area (in ft<sup>2</sup>) of the wings. If the gross weight of the aircraft is between 7500 pounds and 10,000 pounds and <i>S</i> = 210 ft<sup>2</sup>, determine the range of the landing speeds in miles per hour."},label:false}]}]}]}];function t(t){for(var n=0;n<e.length;n++){var i=e[n];for(var o=0;o<i.subchapters.length;o++){var a=i.subchapters[o];if(a.problems.indexOf(t)!==-1){return{chapter:i,subchapter:a}}}}return null}var n=null,i=null,o=null,a=function(e){return String.fromCharCode(97+e)},s="column";var r=0;var l=null;e.forEach(function(e){e.subchapters.forEach(function(e){e.problems.forEach(function(e){e.parts.forEach(function(e){if(e.type=="textbox"){e.options.uneditable=true}});r++})})});console.log("# of textbook problems: "+r);function p(e){n=e;n.appendButtonGroup([{type:"dropdown",label:"problems",data_toggle:"dropdown",pull_right:true,icon:"glyphicon glyphicon-book",html_fn:h}])}function h(e,t){l=e;var n={col1:380,row1:40,col2:580,height:360};var a=u(l,n);d(a,n);$(l).on("shown.bs.dropdown",function(){i()});$(l).on("hide.bs.dropdown",function(){o()});return a.node()}function u(e,t){var n=22;var i=d3.select(e).append("div").style("width",t.col1+t.col2+n+"px").style("padding","5px").on("click",function(){d3.event.stopPropagation()});i.append("p").text("click on a problem, then on the canvas").style("color","gray").style("font-style","italic").style("text-align","center");return i}function d(t,n){var r=t.append("div").style("width",n.col1+n.col2+2+"px").style("height",n.height+2+"px").style("margin","5px").style("border","1px solid silver");var l=r.append("div").classed("panel",true).style("width",n.col1+"px");var p=r.append("div").classed("panel",true).style("width",n.col2+"px");t.selectAll(".panel").style("height",n.height+"px").style("border","none").style("margin","0px").style("display","inline-block").style("overflow-y","scroll").style("overflow-x","hidden");var h=l.selectAll(".chapter").data(e);var u=h.enter().append("div").classed("chapter",true);u.append("div").style("width",n.col1+"px").style("height",n.row1+"px").style("background-color","#e6e6e6").style({"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none"}).style("overflow","hidden").style("padding-left","5px").style("line-height",n.row1+"px").append("p").html(function(e){return e.title}).style("font-weight","bold").style("pointer-events","none");var d=h.selectAll(".subchapter").data(function(e){return e.subchapters});var m=d.enter().append("div").classed("subchapter",true);m.append("div").style("width",n.col1+"px").style("height",n.row1+"px").style({"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none"}).style("overflow","hidden").style("padding-left","5px").style("line-height",n.row1+"px").style("cursor","pointer").on("click",g).append("p").html(function(e){return e.title}).style("pointer-events","none");function g(e){m.style("background-color",function(t,n){return t==e?"#e7f5fe":n%2==0?"whitesmoke":"white"});p.selectAll(".problem").remove();var t=p.selectAll(".problem").data(e.problems);var i=t.enter().append("div").classed("problem",true).style("position","relative").style("width",n.col2+"px").style("background-color",function(e,t){if(e.parts.length==0)return"#e6e6e6";return t%2==0?"whitesmoke":"white"}).style({"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none"}).style("cursor",function(e){return e.parts.length==0?"default":"pointer"}).each(function(e,t){if(!e.alignment)e.alignment=s;var i=d3.select(this),o=0,r=0,l=0,p=0;var h=i.append("div").style("position","relative").style("width",n.col2+"px").style("pointer-events","none");var u=h.append("p").html(e.num).style("left","5px").style("width","30px").style("text-align","right");var d=h.append("p").html(e.text).style("left","45px").style("width",n.col2-18-90+"px");h.selectAll("p").style("position","absolute").style("margin","0px").style("top","15px").style("font-weight","bold").style("color","lightskyblue").style("pointer-events","none");var c=parseFloat(d.style("height"))+15;if(e.parts.length==0)c+=15;h.style("height",c+"px");r+=c;if(e.alignment=="row"){i=i.append("div").style("position","absolute").style("left","50%").style("transform","translateX(-50%)")}var f=i.selectAll(".part").data(e.parts);var m=f.enter().append("div").classed("part","true").style("position","relative").style("pointer-events","none").each(function(t){var i=d3.select(this),s=0,h=0;if(t.type=="derivation"){var u=i.append("svg").style("pointer-events","none");var d=new gmath.AlgebraModel(t.options.eq),c={font_size:20,v_align:"center",fixed:true},f=new gmath.AlgebraView(d,u,c);f.init(function(){var t=f.getBBox();h=t.height+30;if(e.alignment=="row"){s=t.width+80;o+=s;u.style("position","absolute").style("top","50%").style("transform","translateY(-50%)")}else if(e.alignment=="column"){s=n.col2-18}i.style("width",s+"px");u.style("width",s+"px").style("height",h+"px");f.main.attr("transform","translate("+[s/2,h/2].join(",")+")")})}else if(t.type=="textbox"){var m=i.append("p").html(t.options.text).style("margin","0px").style("pointer-events","none");if(e.alignment=="row"){s=m.node().clientWidth+40;o+=s;m.style("position","absolute").style("top","50%").style("transform","translateY(-50%)").style("text-align","center")}else if(e.alignment=="column"){s=n.col2-18-90;m.style("position","absolute").style("left","45px").style("top","10px")}i.style("width",s+"px");m.style("width",s+"px");h=m.node().clientHeight;t.options.size={width:s,height:h};t.options.font_size=parseFloat(m.style("font-size"));h+=20}if(e.alignment=="row"){if(h>l)l=h;i.style("display","inline-block").style("height","100%")}else if(e.alignment=="column"){r+=h;i.style("height",h+"px")}if(t.label){var g=i.append("p").html(a(p)).style("position","absolute").style("color","lightskyblue").style("pointer-events","none");if(e.alignment=="row"){g.style("top","50%").style("transform","translateY(-50%)")}else if(e.alignment=="column"){g.style("left","5px").style("top","10px").style("width","30px").style("text-align","right")}p++}});if(e.alignment=="row"){i.style("width",o+"px").style("height",l+"px");r+=l;d3.select(i.node().parentNode).style("height",r+"px")}else if(e.alignment=="column"){i.style("height",r+"px")}}).on("click",function(e,t){if(e.parts.length==0)return;i.filter(function(t){return t==e}).transition().duration(150).style("background-color","#e7f5fe").transition().duration(150).style("background-color",t%2==0?"whitesmoke":"white").each("end",c);f(e)})}i=function(){g(e[0].subchapters[0])};o=function(){p.selectAll(".problem").remove()}}function c(){$("body").trigger("click")}function f(e){var i=t(e);n.logger.logCustomInteraction("homework-menu",{action:"select",problem:e.num,chapter:i.chapter.title,subchapter:i.subchapter.title});var o=20,a=0;n.model.elements().forEach(function(e){var t=e.pos.y+e.size.height;if(t>a)a=t});a+=20;n.model.createTextBox({pos:{x:o,y:a},size:{width:472},text:e.text},function(t){n.model.setActive();a+=t.size.height+20;n.controller.simulateStartOfInteraction();function i(t){if(e.parts.length>t){n.controller.simulateEndOfInteraction();function s(n){if(n.type==="derivation")n.applyViewAlignment();if(e.alignment=="row")o+=n.size.width+20;else if(e.alignment=="column")a+=n.size.height+20;i(t+1)}e.parts[t].options.pos={x:o,y:a};e.parts[t].options.v_align="top";switch(e.parts[t].type){case"derivation":n.model.createDL(e.parts[t].options,s,"homework-menu");break;case"textbox":n.model.createTextBox(e.parts[t].options,s,"homework-menu");break}n.controller.simulateEndOfInteraction()}}i(0)})}return p}();gmath.ui.addHelpButton=function(){var e=[{title:"Math Gesture Tutorials",url:"https://graspablemath.com/mac/tutorial/index.html"},{title:"Homework Videos",url:"https://www.youtube.com/channel/UCgj6gNKkDgAMUtTcY70OJ2Q"},{title:"Live GM Chat",url:"https://gitter.im/graspablemath/Lobby"}];var t=null;function n(e){t=e;t.appendButtonGroup([{type:"dropdown",label:"help",data_toggle:"dropdown",pull_right:true,icon:"glyphicon glyphicon-question-sign",html_fn:i}])}function i(e,t){var n={width:240,row_height:40};var i=o(e,n);a(i,n);return i.node()}function o(e,t){var n=22;var i=d3.select(e).append("div").style("width",t.width+n+"px").style("padding","5px").on("click",function(){d3.event.stopPropagation()});return i}function a(t,n){var i=t.append("div").classed("panel",true).style("width",n.width+2+"px").style("height",n.row_height*e.length+2+"px").style("margin","5px").style("border","1px solid silver");var o=i.selectAll(".link").data(e);var a=o.enter().append("div").classed("link",true).html(function(e){return e.title}).style("width",n.width+"px").style("height",n.row_height+"px").style("padding-left","5px").style("line-height",n.row_height+"px").style("font-weight","bold").style("text-decoration","none").style("color","steelblue").style("background-color",function(e,t){return t%2==0?"whitesmoke":"white"}).style("cursor","pointer").on("click",function(e){var t=window.open(e.url,"_blank");if(t){t.focus()}else{alert("Please allow popups for Graspable Math.")}})}return n}();IdentificationModal=function(e){this.modal=null;this.init();this.events=d3.dispatch("identified");this.max_idle_time=e;this.timer_id=null;this.resetTimer()};IdentificationModal.prototype.resetTimer=function(){this.showGlassPane(false);if(this.timer_id)clearTimeout(this.timer_id);this.timer_id=setTimeout(this.showGlassPane.bind(this,true),this.max_idle_time)};IdentificationModal.prototype.showGlassPane=function(e){this.glass_pane.style("display",e?null:"none")};IdentificationModal.prototype.init=function(){if(this.glass_pane)this.glass_pane.remove();this.glass_pane=d3.select("body").append("div").style({position:"fixed",top:0,right:0,bottom:0,left:0,"z-index":1e4,display:"none"}).on("click",this.show.bind(this));if(this.modal)this.modal.remove();this.modal=d3.select("body").append("div").attr("class","modal fade").attr("tabindex",-1).attr("role","dialog");var e=this.modal.append("div").attr("class","modal-dialog modal-sm").attr("role","document").append("div").attr("class","modal-content");var t=e.append("div").classed("modal-header",true);t.append("h4").classed("modal-title",true).text("Please tell us who you are!");var n=e.append("div").classed("modal-body",true);var i=n.append("div");this.type_div=i.append("div").classed("form-group",true).style("margin-bottom",0);this.type_div.append("label").attr({"for":"user-id","class":"control-label"}).text("I'm a...");var o={width:"40%",height:"60px"};var a=this.type_div.append("div");a.append("button").attr({type:"button","class":"btn btn-default"}).style(o).text("Student").on("click",this.on_choice.bind(this,"student"));a.append("button").attr({type:"button","class":"btn btn-default"}).style(o).style("float","right").text("Tutor").on("click",this.show_id_input.bind(this,true));this.id_div=i.append("div").classed("form-group",true);this.id_div.append("label").attr({"for":"user-id","class":"control-label"}).text("My initials & day of birth");var s=this.id_div.append("div").classed("input-group",true);s.append("input").attr({type:"text","class":"form-control",id:"user-id"}).attr({placeholder:"EM28"}).on("keyup",function(){if(d3.event.keyCode===13){d3.event.preventDefault();this.on_choice("tutor")}}.bind(this));s.append("span").classed("input-group-btn",true).append("button").attr({type:"button","class":"btn btn-default"}).text("OK").on("click",this.on_choice.bind(this,"tutor"));$(this.modal.node()).modal({backdrop:"static",keyboard:false,show:false})};IdentificationModal.prototype.show_id_input=function(e){this.type_div.style("display",e?"none":null);this.id_div.style("display",e?null:"none");if(e)this.modal.select("#user-id").node().focus()};IdentificationModal.prototype.reset=function(){this.modal.select("#user-id").node().value=null;this.show_id_input(false);this.showGlassPane(false)};IdentificationModal.prototype.on_choice=function(e){var t=this.modal.select("#user-id").node().value;var n=e==="tutor"&&(!t||!/^[a-zA-Z]{2,3}[0-9]{1,2}$/.test(t));this.id_div.classed("has-error",n);if(n)return;this.events.identified({type:e,id:t});$(this.modal.node()).modal("hide");this.resetTimer()};IdentificationModal.prototype.show=function(){this.reset();$(this.modal.node()).modal("show")};gmath.ui=gmath.ui||{};gmath.ui.CanvasImage=function(){var e=function(e,t,n,i){CanvasElement.call(this,e,t,n);this.type="image";this.initCanvasImageOptions(n);this.initCanvasImageProperties(n);this.initCanvasImage();this.initPosition();if(i)this.callback(this)};gmath.inherit(CanvasElement,e);gmath.ui.CanvasImageClass=e;e.defaultOptions={min_size:{width:50},size:{width:200}};e.prototype.initCanvasImageOptions=function(t){
var t=t||{};var n=gmath.deepCopy(e.defaultOptions);var i=gmath.object.extendExisting(n,t);if(t.image_data)i.image_data=t.image_data;if(t.drop_evt){i.drop_evt=t.drop_evt;i.url=this.tryGetUrl(t.drop_evt)}if(t.url)i.url=t.url;this.options=gmath.extend(this.options,i)};e.prototype.initCanvasImageProperties=function(e){this.size=this.options.size};e.prototype.initCanvasImage=function(){if(this.options.image_data||this.options.url)this.loadImage();else this.getDataFromFile(this.options.drop_evt)};e.prototype.tryGetUrl=function(e){if(!e)return;if(typeof e==="string")return e;if(e.dataTransfer!==undefined){var t=e.dataTransfer.getData("text/plain");if(t.slice(0,4)==="http"){return t}else{var n=e.dataTransfer.getData("text/html");var i=$("<div>").append(n);var o=$(i).find("img").attr("src");if(typeof o!=="undefined")return o}}return null};e.prototype.getDataFromFile=function(e){if(typeof this.options.image_data!=="undefined")return;if(e===null)return;if(typeof e.dataTransfer==="undefined")return;var t=new FileReader;t.onload=function(e){this.canvas_image.options.image_data=e.target.result;this.canvas_image.loadImage()};t.onerror=function(e){console.error("error: "+e.target.error)};t.canvas_image=this;t.readAsDataURL(e.dataTransfer.files[0])};e.prototype.loadImage=function(){this.image_for_aspect_ratio=new Image;this.image_for_aspect_ratio.src=this.options.url||this.options.image_data;this.image=document.createElementNS("http://www.w3.org/2000/svg","image");this.image.addEventListener("load",this.waitForAspectRatio())};e.prototype.waitForAspectRatio=function(){if(this.image_for_aspect_ratio.complete){this.imageLoaded()}else{var e=setTimeout(n,100);var t=this;function n(){if(t.image_for_aspect_ratio.complete){t.imageLoaded()}else{var e=setTimeout(n,100)}}}};e.prototype.imageLoaded=function(){this.aspect_ratio=this.image_for_aspect_ratio.height/this.image_for_aspect_ratio.width;var e=this.size.width*this.aspect_ratio;this.options.min_size.height=this.options.min_size.width*this.aspect_ratio;if(isNaN(this.aspect_ratio))return;var t=this.options.url===null?this.options.image_data:this.options.url;this.image=this.element_div.append("img").property("src",t).attr({width:this.size.width-4,height:e-4}).style({"pointer-events":"none"});this.resizeElement({width:this.size.width,height:e})};e.prototype.resize=function(e){var t=Math.max(this.options.min_size.width,e.width);t=Math.min(t,t-(e.width+this.pos.x-this.container_size.width));h=t*this.aspect_ratio;this.resizeElement({width:t,height:h})};e.prototype.subTypeResize=function(e){this.image.attr({width:this.size.width-4,height:this.size.height-4})};e.prototype.toJSON=function(){var e={type:"CanvasImage",id:this.id,pos:gmath.deepCopy(this.pos),size:gmath.deepCopy(this.size),url:this.options.url||this.options.image_data};return e};return e}();gmath.ui=gmath.ui||{};gmath.ui.Keyboard=function(){var e=null;var t=function(){var e=function(){var e="m -5.708,-15.7 20.344,0 c 3.669696,0 6.624,2.954304 6.624,6.624 l 0,17.752 c 0,3.669696 -2.954304,6.624 -6.624,6.624 l -20.488,0 -15.408,-15.48 zM -2.18,-6.948 11.716,6.948M -2.18,6.948 11.716,-6.948";var t="M 13.7,16.5 -13.7,16.5 0,-16.5 z";var n=d3.dispatch("done","cancel","change"),i="",o=false,a,s,r=null,l=null,p=null,h=null,u="darkorange",d=900,c,f,m,g,y,b,v,x=false,w,_,A="center",k=null,q=true;var E=function(){T();w=mtouch_events().on("touch",P).on("release",R).on("hold",W).hold_time(750);z();F();if(i!="")a.mathquill("write",i);return this};function C(e){n[e](a.mathquill("latex"))}E.width=function(e){if(arguments.length==0)return d;d=e;if(r)F();return this};E.latex=function(e){if(arguments.length==0){if(a)i=a.mathquill("latex");return i}else{i=e;if(a)a.mathquill("latex",e);return this}};E.visible=function(e){if(arguments.length==0)return o;if(o==e)return this;o=e;if(!r)return this;if(o){r.style("display","block");s.focus();if(q)E.scale_to_fit()}else r.style("display","none");return this};E.scale_to_fit=function(){if(!r)return;var e=document.body.getBoundingClientRect().width;if(e<d){var t=e/d;r.style("transform","scale("+t+")").style("-webkit-transform","scale("+t+")").style("transform-origin",A+" bottom").style("-webkit-transform-origin",A+" bottom")}else{r.style("transform",null).style("-webkit-transform",null)}};E.position=function(e){if(arguments.length==0)return A;if(A==e)return this;A=e;if(!r)return this;r.call(X,A);return this};E.caption=function(e,t){if(arguments.length===0)return k;k=e;if(!p)return this;if(!k)p.style("display","none");else{h.text(e);p.style("display",null)}h.style("color",t?t:null);return this};E.warning=function(e){return E.caption(e,u)};var S=function(){var e=[],t=[];y.forEach(function(n){t.push(n.row);e.push(n.col)});b=Math.max.apply(null,e);v=Math.max.apply(null,t);var n=(b+1)*130+b*10+2*10+2*10,i=(v+1)*110+10+10*(v-1)+2*10+2*10,o=d/n;f=130*o;g=10*o;m=110*o;c=i*o};var T=function(){y=[];y.keyboard="num";y.formula={type:"formula",col:2,row:0,cols:6};y.push({name:"Cancel",type:"event",event:"cancel",col:0,row:0,cols:2});y.push({type:"backspace",col:8,row:0});y.push({name:"Done",type:"event",event:"done",col:9,row:0,cols:2});y.push({name:"7",type:"key",col:0,row:1});y.push({name:"8",type:"key",col:1,row:1});y.push({name:"9",type:"key",col:2,row:1});y.push({name:"4",type:"key",col:0,row:2});y.push({name:"5",type:"key",col:1,row:2});y.push({name:"6",type:"key",col:2,row:2});y.push({name:"1",type:"key",col:0,row:3});y.push({name:"2",type:"key",col:1,row:3});y.push({name:"3",type:"key",col:2,row:3});y.push({name:"0",type:"key",col:3,row:3});y.push({name:"1aα",type:"next_kbd",col:11,row:0});y.push({type:"arrow",dir:"left",col:9,row:3,cols:1,rows:.5});y.push({type:"arrow",dir:"up",col:10,row:2.5,cols:1,rows:.5});y.push({type:"arrow",dir:"down",col:10,row:3,cols:1,rows:.5});y.push({type:"arrow",dir:"right",col:11,row:3,cols:1,rows:.5});y.push({name:"+",alts:["±"],type:"key",col:4.5,row:1,id:"plus-key"});y.push({name:"−",type:"key",val:"-",col:5.5,row:1});y.push({name:"*",type:"key",val:"*",col:4.5,row:2,dy:"0.3em"});y.push({name:"÷",type:"key",val:"/",col:5.5,row:2});y.push({name:"(",type:"key",col:4.5,row:3});y.push({name:")",type:"key",col:5.5,row:3});y.push({name:"^",type:"key",col:8,row:1});y.push({name:"=",alts:["<",">","≤","≥"],type:"key",col:8,row:3,id:"equal-key"});y.push({name:",",type:"key",col:7,row:1});y.push({name:".",type:"key",col:3,row:2});y.push({name:"x",type:"key",col:7,row:2});y.push({name:"y",type:"key",col:8,row:2});y.push({name:"_",type:"key",col:7,row:3});y.push({name:"log",alts:["ln"],type:"key",col:9,row:1,id:"log-key"});y.push({name:"√",alts:["√",{name:"ⁿ√",cmd:"\\nthroot"}],type:"key",col:10,row:1,id:"root-key"})};var B=function(){y=[];y.keyboard="alpha";y.formula={type:"formula",col:2,row:0,cols:6};y.push({name:"Cancel",type:"event",event:"cancel",col:0,row:0,cols:2});y.push({type:"backspace",col:8,row:0});y.push({name:"Done",type:"event",event:"done",col:9,row:0,cols:2});y.push({name:"q",type:"key",col:0,row:1});y.push({name:"w",type:"key",col:1,row:1});y.push({name:"e",type:"key",col:2,row:1});y.push({name:"r",type:"key",col:3,row:1});y.push({name:"t",type:"key",col:4,row:1});y.push({name:"y",type:"key",col:5,row:1});y.push({name:"u",type:"key",col:6,row:1});y.push({name:"i",type:"key",col:7,row:1});y.push({name:"o",type:"key",col:8,row:1});y.push({name:"p",type:"key",col:9,row:1});y.push({name:"a",type:"key",col:.3,row:2});y.push({name:"s",type:"key",col:1.3,row:2});y.push({name:"d",type:"key",col:2.3,row:2});y.push({name:"f",type:"key",col:3.3,row:2});y.push({name:"g",type:"key",col:4.3,row:2});y.push({name:"h",type:"key",col:5.3,row:2});y.push({name:"j",type:"key",col:6.3,row:2});y.push({name:"k",type:"key",col:7.3,row:2});y.push({name:"l",type:"key",col:8.3,row:2});y.push({name:"z",type:"key",col:.6,row:3});y.push({name:"x",type:"key",col:1.6,row:3});y.push({name:"c",type:"key",col:2.6,row:3});y.push({name:"v",type:"key",col:3.6,row:3});y.push({name:"b",type:"key",col:4.6,row:3});y.push({name:"n",type:"key",col:5.6,row:3});y.push({name:"m",type:"key",col:6.6,row:3});y.push({name:"^",type:"key",col:9.4,row:2,cols:.6});y.push({name:"1aα",type:"next_kbd",col:11,row:0});y.push({name:"+",alts:["±"],type:"key",col:10,row:1,id:"plus-key"});y.push({name:"-",type:"key",col:11,row:1});y.push({name:"*",type:"key",col:10,row:2,val:"*",dy:"0.3em"});y.push({name:"/",type:"key",col:11,row:2});y.push({name:"=",alts:["<",">","≤","≥"],type:"key",col:11,row:3,id:"equal-key"});y.push({name:"(",type:"key",col:9,row:3});y.push({name:")",type:"key",col:10,row:3});y.push({name:"_",type:"key",col:0,row:3,cols:.6});y.push({name:"shift",type:"shift",col:7.6,row:3,cols:1.25})};var I=function(){y=[];y.keyboard="function";y.formula={type:"formula",col:2,row:0,cols:6};y.push({name:"Cancel",type:"event",event:"cancel",col:0,row:0,cols:2});y.push({type:"backspace",col:8,row:0});y.push({name:"Done",type:"event",event:"done",col:9,row:0,cols:2});y.push({name:"",type:"key",col:0,row:1});y.push({name:"",type:"key",col:1,row:1});y.push({name:"",type:"key",col:2,row:1});y.push({name:"",type:"key",col:3,row:1});y.push({name:"",type:"key",col:4,row:1});y.push({name:"",type:"key",col:5,row:1});y.push({name:"",type:"key",col:6,row:1});y.push({name:"",type:"key",col:7,row:1});y.push({name:"",type:"key",col:8,row:1});y.push({name:"",type:"key",col:0,row:2});y.push({name:"",type:"key",col:1,row:2});y.push({name:"",type:"key",col:2,row:2});y.push({name:"",type:"key",col:3,row:2});y.push({name:"shift",type:"shift",col:9,row:1,cols:1.5});y.push({name:"",type:"key",val:"-",col:5,row:2});y.push({name:"",type:"key",val:"/",col:6,row:2});y.push({name:"",type:"key",col:7,row:2});y.push({type:"arrow",dir:"left",col:8,row:2,cols:1,rows:.5});y.push({type:"arrow",dir:"up",col:9,row:1.5,cols:1,rows:.5});y.push({type:"arrow",dir:"down",col:9,row:2,cols:1,rows:.5});y.push({type:"arrow",dir:"right",col:10,row:2,cols:1,rows:.5});y.push({name:"1aα",type:"next_kbd",col:11,row:0})};var M=function(){y=[];y.keyboard="greek";y.formula={type:"formula",col:2,row:0,cols:6};y.push({name:"Cancel",type:"event",event:"cancel",col:0,row:0,cols:2});y.push({type:"backspace",col:8,row:0});y.push({name:"Done",type:"event",event:"done",col:9,row:0,cols:2});y.push({name:"ς",type:"key",col:1,row:1});y.push({name:"ε",type:"key",col:2,row:1});y.push({name:"ρ",type:"key",col:3,row:1});y.push({name:"τ",type:"key",col:4,row:1});y.push({name:"υ",type:"key",col:5,row:1});y.push({name:"θ",type:"key",col:6,row:1});y.push({name:"ι",type:"key",col:7,row:1});y.push({name:"ο",type:"key",col:8,row:1});y.push({name:"π",type:"key",col:9,row:1});y.push({name:"α",type:"key",col:.3,row:2});y.push({name:"σ",type:"key",col:1.3,row:2});y.push({name:"δ",type:"key",col:2.3,row:2});y.push({name:"φ",type:"key",col:3.3,row:2});y.push({name:"γ",type:"key",col:4.3,row:2});y.push({name:"η",type:"key",col:5.3,row:2});y.push({name:"ξ",type:"key",col:6.3,row:2});y.push({name:"κ",type:"key",col:7.3,row:2});y.push({name:"λ",type:"key",col:8.3,row:2});y.push({name:"ζ",type:"key",col:.6,row:3});y.push({name:"χ",type:"key",col:1.6,row:3});y.push({name:"ψ",type:"key",col:2.6,row:3});y.push({name:"ω",type:"key",col:3.6,row:3});y.push({name:"β",type:"key",col:4.6,row:3});y.push({name:"ν",type:"key",col:5.6,row:3});y.push({name:"μ",type:"key",col:6.6,row:3});y.push({name:"^",type:"key",col:9.4,row:2,cols:.6});y.push({name:"shift",type:"shift",col:7.6,row:3,cols:1.25});y.push({name:"+",alts:["±"],type:"key",col:10,row:1,id:"plus-key"});y.push({name:"-",type:"key",col:11,row:1});y.push({name:"*",type:"key",col:10,row:2,val:"*",dy:"0.3em"});y.push({name:"/",type:"key",col:11,row:2});y.push({name:"=",alts:["<",">","≤","≥"],type:"key",col:11,row:3,id:"equal-key"});y.push({name:"(",type:"key",col:9,row:3});y.push({name:")",type:"key",col:10,row:3});y.push({name:"1aα",type:"next_kbd",col:11,row:0})};var z=function(){r=d3.select("body").append("div").style({position:"fixed",bottom:0,"z-index":1e4}).style("display",o?"block":"none");p=r.append("div").attr("id","caption");h=p.append("span").text(k);p.append("span").text("x").style({position:"absolute",right:"5px",top:"-3px",color:"silver",cursor:"pointer"}).on("click",function(){E.caption(false)});l=r.append("div").classed("keyboard",true);a=l.append("div").attr("id","formula").datum(y.formula).append("div").attr("id","mq_div").append("span").attr("id","mq_span");a=$(a.node()).mathquill("editable");s=a.find("textarea");if(o)s.focus();d3.select(s[0]).on("keyup",function(){if(d3.event.keyCode===13)C("done");else if(d3.event.keyCode===27)C("cancel");else setTimeout(function(){C("change")},1)});D();G(l)};var L=function(){l.selectAll(".key").remove();l.select("#formula").datum(y.formula);G(l)};function G(e){var t=e.selectAll(".key").data(y).enter().append("div").classed("key",true).call(w);t.filter(function(e){return e.type=="backspace"}).classed("backspace-key",true).append("svg").style({width:"100%",height:"100%"}).append("path");t.filter(function(e){return e.type=="arrow"}).classed("arrow-key",true).append("svg").style({width:"100%",height:"100%"}).append("path");t.filter(function(e){return e.name}).classed("normal-key",true).append("span").classed("keylabel",true);t.filter(function(e){return e.alts}).append("span").classed("dots",true);t.filter(function(e){return e.alts}).attr("id",function(e){return e.id}).each(function(e){$(this).popover({html:true,content:function(){return"<div id="+e.id+"-content><div>"+n(e.alts)+"</div></div>"},title:function(){return null},trigger:"manual",placement:"top"});$(this).on("shown.bs.popover",function(){var t=d3.select("#"+e.id+"-content").select("div");var n=t.selectAll("div").data(e.alts);n.classed("key",true).on("mouseenter",U).on("mouseleave",Q)})});function n(e){var t="";e.forEach(function(e){t+="<div style='display:inline-block;padding:10px 5px 10px 5px'>"+(e.name||e)+"</div>"});return t}}var F=function(){S();r.call(X,A);l.style("height",c+"px").style("width",d+"px").style({bottom:0,background:"#DDD",padding:0,"text-align":"center",border:"1px solid silver","border-radius":g*1.5+"px "+g*1.5+"px 0 0","border-bottom":"none"}).select("#formula").style("border",g+"px solid #DDD").style("border-radius",g+"px").call(H,g).select("#mq_div").style("border-radius",g+"px").style("width",function(e){return(e.cols||1)*f+((e.cols||1)-1)*g+"px"}).call(N).select("#mq_span").style("box-shadow","none").style("-webkit-box-shadow","none").style("-moz-box-shadow","none").style("margin-top",g).style("font-size",m/2+m/10+"px").style("padding-top",3*g-2+"px").style("padding-bottom",2*g+"px").style("border","none").style("min-height",function(e){return(e.rows||1)*m+((e.rows||1)-1)*g-5*g+"px"}).style("width","100%");l.selectAll(".key").call(H).call(V).call(N);l.selectAll(".backspace-key path").attr("d",e).style("stroke","black").style("stroke-width","1.2").style("fill","none").attr("transform","translate("+f/2+","+m/2+")scale("+.12*g+")");l.selectAll(".arrow-key path").attr("d",t).style("stroke","black").style("stroke-linejoin","round").style("stroke-width",3).style("fill","none").attr("transform",function(e){var t={left:-90,up:0,right:90,down:180}[e.dir];return"translate("+f/2+","+m/4+")scale("+.05*g+")rotate("+t+")"});l.selectAll(".normal-key span.keylabel").text(function(e){return e.name}).style("line-height",m+"px").filter(function(e){return e.dy}).style("display","inline-block").style("margin-top",function(e){return e.dy});l.selectAll(".normal-key span.dots").text("…").style({position:"absolute",bottom:"2px",right:"5px","font-size":"0.6em","font-family":'"Helvetica Neue", Arial, Helvetica, sans-serif',"font-weight":400,color:"silver"});p.style({position:"relative",background:"rgb(244, 244, 244)",padding:"12px","padding-bottom":"8px",border:"1px solid silver","border-radius":"7.6px 7.6px 0 0","border-bottom":"none",width:4*f+3*g+"px","margin-left":8*f+10*g+"px","font-family":"HelveticaNeue-Light",color:"#666","font-size":"17px","text-align":"center",display:k?null:"none"})};var D=function(){if(/iPhone|iPod|iPad|Android|BlackBerry/.test(navigator.userAgent))l.select(".textarea textarea").attr("readonly","readonly")};var P=function(e){d3.select(this).style("background","gray");if(e.type==="formula")return;s.focus();if(e.type==="next_kbd"){j()}else if(e.type==="shift"){O(e)}else if(e.type==="key"&&!e.alts){Z(e)}else if(e.type==="backspace"){s.trigger($.Event("keydown",{which:8}));C("change")}else if(e.type==="event"){C(e.event)}else if(e.type==="arrow"){var t={left:37,up:38,right:39,down:40}[e.dir];s.trigger($.Event("keydown",{which:t}));C("change")}};var j=function(){x=false;if(y.keyboard==="num"){B()}else if(y.keyboard==="alpha"){M()}else if(y.keyboard==="greek"){T()}L();F()};var O=function(e){x=!x;l.selectAll(".key span.keylabel").text(function(e){if(e.type==="key"){if(x)return e.name.toUpperCase();else return e.name.toLowerCase()}else{return e.name}})};var R=function(e){if(e.type==="key"&&e.alts){Z(_?_:e);_=null;$(this).popover("hide")}if(e.type!=="shift"||!x)d3.select(this).style("background",e.type=="key"||e.type=="formula"?"white":"silver")};var U=function(e){_=e;d3.select(this).style("background","gray")};var Q=function(e){d3.select(this).style("background","white")};function Z(e){if(e.cmd){a.mathquill("cmd",e.cmd);s.focus()}else{var t=e.val||e.name||e;if(x)t=t.toUpperCase();var n=t.charCodeAt(0);s.val(t);if(n!==46)s.trigger($.Event("keydown",{which:n}));s.trigger($.Event("keypress",{which:n}))}C("change")}var W=function(e){if(e.type!=="backspace"&&!e.alts)return;if(e.alts){_=e.name;$("#"+e.id).popover("toggle")}if(e.type==="backspace"){a.mathquill("latex","");s.focus()}};var H=function(e,t){t=t||0;e.style("position","absolute").style("left",function(e){return e.col*(f+g)+2*g-t+"px"}).style("bottom",function(e){return(v-e.row)*(m+g)+(e.row==0?0:0)+2*g-t+"px"})};var V=function(e,t,n){t=t||0;n=n||0;e.style("width",function(e){return(e.cols||1)*f+((e.cols||1)-1)*g-2*t+"px"}).style("height",function(e){return(e.rows||1)*m+((e.rows||1)-1)*g-2*n+"px"})};var N=function(e){e.style("border-radius",g+"px").style("font-size",m/2+"px").style("background",function(e){return e.type=="key"||e.type=="formula"?"white":"silver"}).style("box-shadow","#888 0px 1px 0px").style("font-family","'HelveticaNeue-UltraLight', 'Helvetica Neue UltraLight', 'Helvetica Neue', Arial, Helvetica, sans-serif").style("font-weight",100).style("border","none").style("padding",0).style("-webkit-user-select","none").style("-khtml-user-select","none").style("-moz-user-select","none").style("-ms-user-select","none").style("user-select","none").style("cursor","pointer")};var X=function(e,t){if(t==="center"){e.style("margin-left",-d/2+"px");e.style("left","50%");e.style("right",null)}else if(t==="left"){e.style("margin-left",0);e.style("left",0);e.style("right",null)}else if(t==="right"){e.style("margin-left",0);e.style("left",null);e.style("right",0)}else{e.style("margin-left",-d/2+"px");e.style("left",t);e.style("right",null)}};return d3.rebind(E,n,"on")};return e};return function(){return e||(e=t()())}}();gmath.ui=gmath.ui||{};gmath.ui.TutorialPair=function(){var e=function(e,t){this.events=d3.dispatch("done","retry","next");this.id=gmath.uid();this.title=t.title;this.text=t.text;if("gestureData"in t){this.gesture_data=t.gestureData;this.gesture_data.options.show_drag_indicator=false;this.gesture_data.options.show_bg=false}this.initial_expressions=function n(e,t){if(!e)return[];if(!t)return[e];return[e].concat(t.map(function(e){return e.expression}))}.call(this,t.eq,t.extraExamples);this.correct_answers=function i(e,t){if(!e)return[];if(!t)return[e.map(this.parsedAscii)];return[e.map(this.parsedAscii)].concat(t.map(function(e){return e.correctAnswers.map(this.parsedAscii)},this))}.call(this,t.correctAnswers,t.extraExamples);this.current_example=0;this.start_wiggle=t.startWiggle;this.encourage=true;this.container=d3.select(e);this.dl_div=null;this.dl=null;this.play_btn=gmath.svg_play_button();this.player=null;this.practice_problem=t.practice_problem;this.allow_restart_after_done="allow_restart_after_done"in t?t.allow_restart_after_done:true;this.answered=false;this.log_mouse_trajectories=t.log_mouse_trajectories;this.task_name=t.task_name;this.init()};e.prototype.parsedAscii=function(e){return new gmath.AlgebraModel(e).to_ascii()};e.prototype.replay=function(){this.play_btn.hidden(true);this.player.replay(500,function e(){setTimeout(function e(){this.play_btn.hidden(false);if(!this.answered){if(this.encourage){this.dl_div.append("span").text("Try it!").classed("tryit",true);if(this.start_wiggle)this.dl.startWiggle(this.start_wiggle)}this.dl_div.on("mousedown",function e(){var e=new Date;this.startTime=e.getTime();this.dl_div.select("span.tryit").remove();this.dl_div.on("mousedown",null)}.bind(this))}}.bind(this),1e3)}.bind(this))};e.prototype.init=function(){this.container.append("h2").text(this.title);this.container.append("p").attr("class","tutorial-instructions").text(this.text);var e=this.container.append("div").classed("tutorial",true);var t=e.append("div").classed("choice",true).classed("large-choice",this.practice_problem);this.gesture_data.options.pos={x:"center",y:"center"};this.gesture_data.options.hold_time=1e6;this.gesture_data.options.draggable=false;this.gesture_data.options.collapsed_mode=true;this.gesture_data.options.no_history=false;this.gesture_data.options.no_handles=true;this.gesture_data.options.edit_mode_drag_box_width="0px";this.gesture_data.options.row_padding={left:0,right:0,top:7,bottom:3};this.gesture_data.options.padding={left:0,right:0,top:0,bottom:0};this.gesture_data.options.replace_value_on=false;var n=t.append("div").style({position:"absolute",left:0,right:0,top:0,bottom:0});this.player=new gmath.EventRecorder(this.gesture_data,n.node());this.player.showPreview();t.append("div").classed("animation",true).call(this.play_btn.on("click",this.replay.bind(this)));if(this.initial_expressions.length){this.dl_div=e.append("div").classed("choice",true).classed("large-choice",this.practice_problem);var i=new gmath.ui.CanvasFactory(this.dl_div.node(),{vertical_scroll:false,use_toolbar:false,use_keyboard:false,use_hold_menu:false,svg_height:"100%",log_mouse_trajectories:this.log_mouse_trajectories,ask_confirmation_on_closing:false,overflow_visible:true});this.logger=i.logger;this.model=i.model;this.setDLToExpression(this.initial_expressions[this.current_example]);this.startTime=-1}};e.prototype.chainTransition=function(e,t){if(e.node().__transition__&&e.id&&e.node().__transition__[e.id]){var n=e.node().__transition__[e.id];console.log("extra delay",n.delay+n.duration);t+=n.delay+n.duration}return e.transition().delay(t)};e.prototype.neutralTransition=function(e,t,n,i){e.selectAll("button").remove();e.select("span.feedback").remove();var o=this.chainTransition(e,t).duration(n||500);if(i)o.styleTween("background",function(){return d3.interpolate(i,"#EEEEEE")});else o.style("background","#eee");return o};e.prototype.wrongTransition=function(e,t,n,i){var o=d3.select(e.node());o.append("span").attr("class","feedback").style({opacity:1e-5}).text("✗");var a=this.chainTransition(e,t).duration(n||500);if(i)a.styleTween("background",function(){return d3.interpolate(i,"#E0A8A8")});else a.style("background","#E0A8A8");a.select(".feedback").style("opacity",1);return a};e.prototype.correctTransition=function(e,t,n,i){var o=d3.select(e.node());o.append("span").attr("class","feedback").style({opacity:1e-5}).text("✓");this.initDoItAgainBtn(o);if(this.initial_expressions.length>1)this.initTryAnotherBtn(o);var a=this.chainTransition(e,t).duration(n||500);if(i)a.styleTween("background",function(){return d3.interpolate(i,"#A8E0B3")});else a.style("background","#A8E0B3");a.select(".feedback").style("opacity",1);a.selectAll("button").style("opacity",1);return a};e.prototype.initDoItAgainBtn=function(e){e.append("button").text("do it again").style({top:"10px",opacity:1e-5}).on("click",function t(){this.logger.logCustomInteraction("tutorial-reset",{task_name:this.task_name,eq_start:this.dl.rows[0].model.to_ascii(),eq_end:this.dl.getLastModel().to_ascii()});if(this.allow_restart_after_done)this.retry()}.bind(this))};e.prototype.initTryAnotherBtn=function(e){e.append("button").text("try another").style({top:"62px",opacity:1e-5}).on("click",function t(){this.logger.logCustomInteraction("tutorial-alternative-example",{task_name:this.task_name,eq_start:this.dl.rows[0].model.to_ascii()});if(this.initial_expressions.length>1)this.loadNextExample();else this.retry()}.bind(this))};e.prototype.checkAnswer=function(){var e=400;setTimeout(function t(){this.dl.getLastView().interactive(false);var e=this.dl.getLastModel().to_ascii();var t=new Date;var n=-1;var i=-1;if(this.startTime!==-1)n=t.getTime()-this.startTime;if(this.parsedAscii(this.initial_expressions[this.current_example])===this.dl.getLastModel().to_ascii()){this.dl.getLastView().interactive(true);i="initial state"}else if(this.answerIsCorrect(e)){i="correct";this.answered=true;this.logger.logCustomInteraction("tutorial-success",{task_name:this.task_name,eq_start:this.dl.rows[0].model.to_ascii(),eq_end:this.dl.getLastModel().to_ascii()});if(this.dl_div.selectAll("div").size()===2)return;this.correctTransition(this.dl_div,200,null,"#EEEEEE").each("end",this.events.done)}else if(!this.practice_problem){i="wrong";this.logger.logCustomInteraction("tutorial-fail",{task_name:this.task_name,eq_start:this.dl.rows[0].model.to_ascii(),eq_end:this.dl.getLastModel().to_ascii()});this.wrongTransition(this.dl_div,200,null,"#EEEEEE").transition().duration(500).each("end",this.retry.bind(this));this.encourage=true}else{i="intermediate state";this.dl.getLastView().interactive(true)}if(gmath.log_ga)gmath.log_ga.trackEvent("tutorial",i,this.eq,n)}.bind(this),e)};e.prototype.answerIsCorrect=function(e){return this.correct_answers[this.current_example].indexOf(e)!==-1};e.prototype.loadNextExample=function(){var e=this.dl.rows[0].model.to_ascii();this.neutralTransition(this.dl_div,0,1).each("end",function t(){this.current_example++;if(this.current_example===this.initial_expressions.length)this.current_example=0;this.setDLToExpression(this.initial_expressions[this.current_example]);if(this.current_example===0)this.encourage=true;else this.encourage=false;this.events.next()}.bind(this))};e.prototype.retry=function(){this.neutralTransition(this.dl_div,0,1).each("end",function e(){this.setDLToExpression(this.initial_expressions[this.current_example]);this.events.retry()}.bind(this));this.answered=false;this.encourage=true};e.prototype.setDLToExpression=function(e){var t=gmath.deepCopy(this.gesture_data.options);t.eq=e;t.inactive_color=gmath.AlgebraView.defaultOptions.inactive_color;t.color=gmath.AlgebraView.defaultOptions.color;t.h_align="center";t.edit_mode_drag_box_width="0px";t.show_drag_indicator=gmath.AlgebraView.defaultOptions.show_drag_indicator;this.logger.listen(false);if(this.dl)this.model.removeElement(this.dl);this.dl=this.model.createDL(t);this.logger.listen(true);this.dl.getLastRow().view.interaction_handler.events.on("touch",function(){this.encourage=false}.bind(this));this.dl.getLastView().interactive(true);this.dl.events.on("end-of-interaction."+this.id,this.checkAnswer.bind(this))};e.prototype.stop=function(){this.player.stop_animation()};return e}();var Timeline={};Timeline.entryTypes={};Timeline.entry=function(e,t){e=e[0];for(var n in Timeline.entryTypes){var i=Timeline.entryTypes[n];if(i.prototype.match(e))return new i(e,t)}return null};var EntryType=function(e){this.type=e};EntryType.prototype.match=function(e){return this.type===e.subtype};var AlgebraEntry=function(e,t){EntryType.call(this,e.subtype);this.summary=e;this.object=t.getElementByID(this.summary.el_id)};gmath.inherit(EntryType,AlgebraEntry);AlgebraEntry.prototype.type="rewrite";Timeline.entryTypes.AlgebraEntry=AlgebraEntry;AlgebraEntry.prototype.undo=function(e){this.rows=[];this.packState=this.object.rows.map(function(e){return e.hidden?true:false});while(this.object.getLastRow().idx!==this.summary.el_subid){this.rows.push(this.object.undo())}};AlgebraEntry.prototype.redo=function(e){for(var t=this.rows.length-1;t>=0;t--){this.object.redo(this.rows[t])}for(var t=0;t<this.object.rows.length;t++){var n=this.object.rows[t];if(this.packState[t]&&!n.hidden)n.hide();else if(!this.packState[t]&&n.hidden)n.unhide()}this.object.layoutRows()};var CreateEntry=function(e,t){EntryType.call(this,e.subtype);this.summary=e;this.objects=[];this.objects.push(t.getElementByID(this.summary.el_id))};gmath.inherit(EntryType,CreateEntry);CreateEntry.prototype.type="create";Timeline.entryTypes.CreateEntry=CreateEntry;CreateEntry.prototype.match=function(e){return this.type===e.subtype&&(e.el_type==="derivation"||e.el_type==="textbox"||e.el_type==="image")};CreateEntry.prototype.undo=function(e){for(var t=0;t<this.objects.length;t++){e.removeElement(this.objects[t])}};CreateEntry.prototype.redo=function(e){for(var t=0;t<this.objects.length;t++){e.addElement(this.objects[t])}};var DeleteEntry=function(e,t){EntryType.call(this,e.subtype);this.summary=e;this.object=t.getDeletedElementByID(this.summary.el_id)};gmath.inherit(EntryType,DeleteEntry);DeleteEntry.prototype.type="delete";Timeline.entryTypes.Entry=DeleteEntry;DeleteEntry.prototype.match=function(e){return this.type===e.subtype&&(e.el_type==="derivation"||e.el_type==="textbox"||e.el_type==="image")};DeleteEntry.prototype.undo=function(e){e.addElement(this.object)};DeleteEntry.prototype.redo=function(e){e.removeElement(this.object)};var DrawEntry=function(e,t){EntryType.call(this,e.subtype);this.summary=e;this.object=t.getElementByID(this.summary.el_id)};gmath.inherit(EntryType,DrawEntry);DrawEntry.prototype.type="draw";Timeline.entryTypes.DrawEntry=DrawEntry;DrawEntry.prototype.undo=function(e){e.removePath(this.object)};DrawEntry.prototype.redo=function(e){e.addPath(this.object)};var EraseEntry=function(e){EntryType.call(this,e.subtype);this.summary=e};gmath.inherit(EntryType,EraseEntry);EraseEntry.prototype.type="erase";Timeline.entryTypes.EraseEntry=EraseEntry;EraseEntry.prototype.undo=function(e){if(!this.modification){console.warn("erase modification was not set");return}this.modification.removed.forEach(function(t){e.addPath(t)});this.modification.added.forEach(function(t){e.removePath(t)});this.modification.modified.forEach(function(t){t.path.points=t.points_before;e.updatePath(t.path)})};EraseEntry.prototype.redo=function(e){this.modification.removed.forEach(function(t){e.removePath(t)});this.modification.modified.forEach(function(t){t.path.points=t.points_after;e.updatePath(t.path)});this.modification.added.forEach(function(t){e.addPath(t)})};var MoveEntry=function(e,t){EntryType.call(this,e.subtype);this.summary=e;this.object=t.getElementByID(this.summary.el_id)};gmath.inherit(EntryType,MoveEntry);MoveEntry.prototype.type="move";Timeline.entryTypes.MoveEntry=MoveEntry;MoveEntry.prototype.match=function(e){return this.type===e.subtype&&(e.el_type==="derivation"||e.el_type==="textbox"||e.el_type==="image")};MoveEntry.prototype.undo=function(e){this.object.translateElement(JSON.parse(this.summary.old_state))};MoveEntry.prototype.redo=function(e){this.object.translateElement(JSON.parse(this.summary.new_state))};var PackEntry=function(e,t){EntryType.call(this,e.subtype);this.summary=e;this.object=t.getElementByID(this.summary.el_id)};gmath.inherit(EntryType,PackEntry);PackEntry.prototype.type="pack";Timeline.entryTypes.PackEntry=PackEntry;PackEntry.prototype.match=function(e){return this.type===e.subtype&&!this.startingAndEndingPackStateAreTheSame(e)};PackEntry.prototype.startingAndEndingPackStateAreTheSame=function(e){var t=e.old_state,n=e.new_state;for(var i=0;i<t.length;i++){if(t[i]!==n[i])return false}return true};PackEntry.prototype.undo=function(e){var t=this.object.rows,n=this.summary.old_state;for(var i=0;i<t.length;i++){if(t[i].hidden&&!n[i])t[i].unhide();else if(!t[i].hidden&&n[i])t[i].hide()}this.object.layoutRows()};PackEntry.prototype.redo=function(e){var t=this.object.rows,n=this.summary.new_state;for(var i=0;i<t.length;i++){
if(t[i].hidden&&!n[i])t[i].unhide();else if(!t[i].hidden&&n[i])t[i].hide()}this.object.layoutRows()};var CloneEntry=function(e,t){EntryType.call(this,e.subtype);this.summary=e;this.object=t.getElementByID(this.summary.target_id)};gmath.inherit(EntryType,CloneEntry);CloneEntry.prototype.type="clone";Timeline.entryTypes.CloneEntry=CloneEntry;CloneEntry.prototype.undo=function(e){this.links=e.removeElement(this.object)};CloneEntry.prototype.redo=function(e){e.addDL(this.object);gmath.LinkCoordinator.addLinks(this.links)};var ScrubEntry=function(e,t){EntryType.call(this,e.subtype);this.summary=e;this.object=t.getElementByID(this.summary.el_id)};gmath.inherit(EntryType,ScrubEntry);ScrubEntry.prototype.type="scrub";Timeline.entryTypes.ScrubEntry=ScrubEntry;ScrubEntry.prototype.undo=function(e){var t=this.object.rows[0].model;var n=t.replace_with(new gmath.AlgebraModel(this.summary.old_state,t.options));this.object.rows[0].updateDimensionAfterInteraction();this.object.updateDims();this.object.rows[0].view.update_existing()};ScrubEntry.prototype.redo=function(e){var t=this.object.rows[0].model;var n=t.replace_with(new gmath.AlgebraModel(this.summary.new_state,t.options));this.object.rows[0].updateDimensionAfterInteraction();this.object.updateDims();this.object.rows[0].view.update_existing()};var TextEditEntry=function(e,t){EntryType.call(this,e.subtype);this.summary=e;this.textbox=t.getElementByID(this.summary.el_id)};gmath.inherit(EntryType,TextEditEntry);TextEditEntry.prototype.type="edit";Timeline.entryTypes.TextEditEntry=TextEditEntry;TextEditEntry.prototype.match=function(e){return this.type===e.subtype&&e.el_type==="textbox"};TextEditEntry.prototype.undo=function(e){this.textbox.setText(this.summary.old_state)};TextEditEntry.prototype.redo=function(e){this.textbox.setText(this.summary.new_state)};var ResizeEntry=function(e,t){EntryType.call(this,e.subtype);this.summary=e;this.canvasElement=t.getElementByID(this.summary.el_id)};gmath.inherit(EntryType,ResizeEntry);ResizeEntry.prototype.type="resize";Timeline.entryTypes.ResizeEntry=ResizeEntry;ResizeEntry.prototype.match=function(e){return this.type===e.subtype};ResizeEntry.prototype.undo=function(e){this.canvasElement.resizeElement(JSON.parse(this.summary.old_state))};ResizeEntry.prototype.redo=function(e){this.canvasElement.resizeElement(JSON.parse(this.summary.new_state))};gmath.gmifyPage=function(e,t){t=t||{};coordinator=new DLCoordinator;var n=e?d3.select(e):d3.select("body");var i=n.size()>0&&n.classed("gmify-canvas")?n:n.selectAll(".gmify-canvas");i.each(function(){var e=d3.select(this);var t=e.text().split(";");try{t.forEach(gmath.AlgebraModel.getDefaultParser().parse);e.classed("gmify-canvas",false).classed("gmified-canvas",true);e.classed("bootstrap-styles",true);e.select("*").remove();var n=new gmath.ui.CanvasFactory(this,{height:"500px"});fixAggressiveAssistmentsStyles(e);var i={pos:["auto",20],v_align:"top"};n.model.createDLs(t,i)}catch(o){console.log('could not parse "'+t+'". Error:',o)}});i=n.size()>0&&n.classed("gmify-minimal")?n:n.selectAll(".gmify-minimal");i.each(function(){var e=d3.select(this);var t=e.text();try{gmath.AlgebraModel.getDefaultParser().parse(t);e.classed("gmify-minimal",false).classed("gmified-minimal",true);e.classed("bootstrap-styles",true);e.select("*").remove();e.text("");var n=e.insert("svg").style({overflow:"visible",display:"block",width:"100%"});gmath.DerivationList.createFixedSingleLineDL(n.node(),{eq:t})}catch(i){console.log('could not parse "'+t+'". Error:',i)}});i=n.size()>0&&n.classed("gmify")?n:n.selectAll(".gmify");i.each(function(e,n){var i=d3.select(this),o=i.text();try{gmath.AlgebraModel.getDefaultParser().parse(o);i.classed("gmify",false).classed("gmified",true);i.classed("bootstrap-styles",true);i.select("*").remove();i.text("");var a=i.insert("div").style({overflow:"visible",display:"block","margin-top":"30px"});var s=new gmath.ui.CanvasFactory(a.node(),{minimal:true,logo_src:t.logo_src}),r=s.model.createDL({eq:o,pos:{x:0,y:0},cloning_on:false,normal_font:{family:"Kalam"},italic_font:{family:"Kalam"},font_baseline_shift:.4,font_ascent:.9,font_descent:.2,slanted_div_bar:true,div_bar_height:1/14,font_size:"45",row_border_color:"#ddd",handle_stroke_color:"#d8d8d8",keep_in_container:true});fixAggressiveAssistmentsStyles(i);coordinator.subscribeToCanvasModel(s.model);coordinator.addDL(r);s.model.focusOnDL(r);s.controller.clearInteractionTimeline()}catch(l){console.log('could not parse "'+o+'". Error:',l)}})};fixAggressiveAssistmentsStyles=function(e){e.selectAll(".btn-toolbar button span").style("font-size","12px");e.selectAll(".btn-toolbar button br").style("font-size","12px")};
